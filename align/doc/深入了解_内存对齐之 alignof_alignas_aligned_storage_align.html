<!DOCTYPE html>
<!-- saved from url=(0038)https://zhuanlan.zhihu.com/p/417061548 -->
<html lang="zh" data-hairline="true" data-theme="light" data-rh="data-theme"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>深入了解 | 内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析 - 知乎</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg"><meta data-rh="true" name="keywords" content="C++,内存管理,C++11"><meta data-rh="true" name="description" content="本文首发于个人技术号： 深入了解C++(15) | 内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析关于内存对齐，有诸多好处，因此常常在分配内存时也会将内存对齐这一因素纳入考量。 这一节，来讲下内…"><meta data-rh="true" property="og:title" content="深入了解 | 内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析"><meta data-rh="true" property="og:url" content="https://zhuanlan.zhihu.com/p/417061548"><meta data-rh="true" property="og:description" content="本文首发于个人技术号： 深入了解C++(15) | 内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析关于内存对齐，有诸多好处，因此常常在分配内存时也会将内存对齐这一因素纳入考量。 这一节，来讲下内…"><meta data-rh="true" property="og:image" content=""><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="og:site_name" content="知乎专栏"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png" sizes="152x152"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-120.bbce8f18.png" sizes="120x120"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-76.cbade8f9.png" sizes="76x76"><link data-rh="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-60.8f6c52aa.png" sizes="60x60"><link crossorigin="" rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/heifetz/favicon.ico"><link crossorigin="" rel="search" type="application/opensearchdescription+xml" href="https://static.zhihu.com/heifetz/search.xml" title="知乎"><link rel="dns-prefetch" href="https://static.zhimg.com/"><link rel="dns-prefetch" href="https://pica.zhimg.com/"><link rel="dns-prefetch" href="https://pic1.zhimg.com/"><link rel="dns-prefetch" href="https://pic2.zhimg.com/"><link rel="dns-prefetch" href="https://pic3.zhimg.com/"><link rel="dns-prefetch" href="https://pic4.zhimg.com/"><link rel="dns-prefetch" href="https://static.zhihu.com/"><style data-emotion-css="1m4merm">.u-safeAreaInset-top{height:constant(safe-area-inset-top) !important;height:env(safe-area-inset-top) !important;}.u-safeAreaInset-bottom{height:constant(safe-area-inset-bottom) !important;height:env(safe-area-inset-bottom) !important;}</style><link href="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.app.216a26f4.971dc24cbc4728e4a7c8.css" crossorigin="" rel="stylesheet"><script nonce="">!function(){"use strict";!function(e,n){var r=[];function t(e){return function(){r.push([e,arguments])}}n.Raven={captureException:t("captureException"),captureMessage:t("captureMessage"),captureBreadcrumb:t("captureBreadcrumb")};var a,o,c,i,s,u="undefined"!=typeof DOMError;function d(e){var n=e instanceof Error||e instanceof ErrorEvent||u&&e instanceof DOMError||e instanceof DOMException;Raven.captureException(n?e:new Error(e.message||e.reason))}n.addEventListener("unhandledrejection",d),n.addEventListener("error",d,!0),a=e.src,o=e,c=function(){r.forEach(function(e){var n;(n=Raven)[e[0]].apply(n,e[1])}),n.removeEventListener("unhandledrejection",d),n.removeEventListener("error",d,!0)},i=document.head||document.getElementsByTagName("head")[0],(s=document.createElement("script")).crossOrigin=o.crossOrigin,s.dataset.sentryConfig=o["data-sentry-config"],s.onload=c,s.src=a,i.appendChild(s)}({"defer":true,"crossOrigin":"anonymous","src":"https://unpkg.zhimg.com/@cfe/sentry-script@1.3.1/dist/init.js","data-sentry-config":"{\"dsn\":\"https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224\",\"sampleRate\":0.1,\"release\":\"4405-a147f3dd\",\"ignoreErrorNames\":[\"NetworkError\",\"SecurityError\"],\"ignoreErrorsPreset\":\"ReactApp\",\"tags\":{\"app_name\":\"heifetz\"}}"},window)}();
</script><script crossorigin="anonymous" data-sentry-config="{&quot;dsn&quot;:&quot;https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224&quot;,&quot;sampleRate&quot;:0.1,&quot;release&quot;:&quot;4405-a147f3dd&quot;,&quot;ignoreErrorNames&quot;:[&quot;NetworkError&quot;,&quot;SecurityError&quot;],&quot;ignoreErrorsPreset&quot;:&quot;ReactApp&quot;,&quot;tags&quot;:{&quot;app_name&quot;:&quot;heifetz&quot;}}" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/init.js"></script><style data-emotion-css="1l12z7y">.css-1l12z7y{box-shadow:0px 16px 32px rgba(0,0,0,0.04);}</style><style data-emotion-css="1hlrcxk">.css-1hlrcxk{-webkit-transition-property:fill;transition-property:fill;-webkit-transition-duration:0.25s;transition-duration:0.25s;-webkit-transition-timing-function:ease-in;transition-timing-function:ease-in;}</style><style data-emotion-css="1cd9gw4">.css-1cd9gw4{margin-left:.3em;}</style><style data-emotion-css="n99yhz">.css-n99yhz{box-sizing:border-box;margin:0;min-width:0;color:#175199;display:inline-block;margin-left:.3em;}</style><style data-emotion-css="18biwo">.css-18biwo{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="1ifz0go">.css-1ifz0go{overflow:visible!important;}</style><style data-emotion-css="1yuhvjn">.css-1yuhvjn{margin-top:16px;}</style><style data-emotion-css="3jt6os">.css-3jt6os .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-3jt6os .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-3jt6os .FileLinkCard-info{margin-left:12px;}.css-3jt6os .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-3jt6os .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-3jt6os .FileLinkCard-source{white-space:pre;}</style><style data-emotion-css="1wr1m8">.css-1wr1m8 .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-1wr1m8 .LinkCard.new,.css-1wr1m8 .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1wr1m8 .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-1wr1m8 .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-1wr1m8 .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-1wr1m8 .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-1wr1m8 .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-1wr1m8 .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-1wr1m8 .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-1wr1m8 .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-1wr1m8 .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-1wr1m8 .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-1wr1m8 .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-1wr1m8 .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-1wr1m8 .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-1wr1m8 .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-1wr1m8 .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-1wr1m8 .LinkCard.old,.css-1wr1m8 .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1wr1m8 .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}</style><style data-emotion-css="hypxot">.css-hypxot .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-hypxot .LinkCard.old,.css-hypxot .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-hypxot .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-hypxot .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-hypxot .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-hypxot .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-hypxot .LinkCard.new,.css-hypxot .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-hypxot .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-hypxot .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-hypxot .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-hypxot .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-hypxot .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-hypxot .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-hypxot .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-hypxot .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-hypxot .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-hypxot .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-hypxot .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-hypxot .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-hypxot .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-hypxot .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-hypxot .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-hypxot .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-hypxot .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-hypxot .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-hypxot .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-hypxot .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-hypxot .FileLinkCard-info{margin-left:12px;}.css-hypxot .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-hypxot .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-hypxot .FileLinkCard-source{white-space:pre;}</style><style data-emotion-css="9scqi7 animation-1sh55c5">.css-9scqi7{word-break:break-word;line-height:1.6;}.css-9scqi7 a.UserLink-link{color:#175199;}.css-9scqi7 a.UserLink-link:hover{border-bottom:1px solid #175199;}.css-9scqi7 lazy[data-lazy-status]{background-color:#F6F6F6;}.css-9scqi7 lazy[data-lazy-status="ok"]{background-color:transparent;-webkit-animation:animation-1sh55c5 0.5s ease-in;animation:animation-1sh55c5 0.5s ease-in;}.css-9scqi7 > [data-first-child]{margin-top:0;}.css-9scqi7 > :last-child{margin-bottom:0;}.css-9scqi7 h1,.css-9scqi7 h2{clear:left;margin-top:calc((1.4em * 2) / 1.2);margin-bottom:calc(1.4em / 1.2);font-size:1.2em;line-height:1.5;font-weight:600;}.css-9scqi7 h3,.css-9scqi7 h4,.css-9scqi7 h5,.css-9scqi7 h6{clear:left;margin-top:calc((1.4em * 1.5) / 1.1);margin-bottom:calc(1.4em / 1.1);font-size:1.1em;line-height:1.5;font-weight:600;}.css-9scqi7 u{-webkit-text-decoration:none;text-decoration:none;border-bottom:1px solid #444444;}.css-9scqi7 b{font-weight:600;}.css-9scqi7 sup{font-size:0.8em;}.css-9scqi7 sup[data-draft-type='reference']{color:#175199;}.css-9scqi7 a:focus{outline:none;-webkit-transition:box-shadow 0.3s;transition:box-shadow 0.3s;}html[data-focus-visible] .css-9scqi7 a:focus{box-shadow:0 0 0 2px #FFFFFF,0 0 0 4px rgba(0,102,255,0.3);}.css-9scqi7 a.ztext-link,.css-9scqi7 a.internal,.css-9scqi7 a.external{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;border-bottom:1px solid #808080;}.css-9scqi7 a.ztext-link:hover,.css-9scqi7 a.internal:hover,.css-9scqi7 a.external:hover{color:#175199;border-bottom:1px solid #175199;}.css-9scqi7 a.ztext-link > .ellipsis::after,.css-9scqi7 a.internal > .ellipsis::after,.css-9scqi7 a.external > .ellipsis::after{content:'...';}.css-9scqi7 a.ztext-link > .invisible,.css-9scqi7 a.internal > .invisible,.css-9scqi7 a.external > .invisible{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;}.css-9scqi7 a.ztext-link u,.css-9scqi7 a.internal u,.css-9scqi7 a.external u{border:none;}.css-9scqi7 a.member_mention{color:#175199;}.css-9scqi7 a.member_mention:hover{border-bottom:1px solid #175199;}.css-9scqi7 p{margin:1.4em 0;}.css-9scqi7 p.ztext-empty-paragraph{margin:calc((2.8em- (1.4em * 2 + 1.6em)) / 2) 0;}.css-9scqi7 p.ztext-empty-paragraph + .ztext-empty-paragraph{margin:1.4em 0;}.css-9scqi7 hr{margin:4em auto;width:240px;max-width:100%;border:none;border-top:1px solid #D3D3D3;}.css-9scqi7 img[eeimg]{max-width:100%;vertical-align:middle;}.css-9scqi7 img[eeimg="1"]{margin:0 3px;max-width:calc(100% - 6px);display:inline-block;}.css-9scqi7 img[eeimg="2"]{margin:1.4em auto;display:block;}.css-9scqi7 blockquote{margin:1.4em 0;padding-left:1em;color:#646464;border-left:3px solid #D3D3D3;}.css-9scqi7 ol,.css-9scqi7 ul{margin:1.4em 0;padding:0;}.css-9scqi7 ol ol,.css-9scqi7 ul ol,.css-9scqi7 ol ul,.css-9scqi7 ul ul{margin:0;}.css-9scqi7 ol > ol,.css-9scqi7 ul > ol,.css-9scqi7 ol > ul,.css-9scqi7 ul > ul{display:table-row;}.css-9scqi7 ol > ol::before,.css-9scqi7 ul > ol::before,.css-9scqi7 ol > ul::before,.css-9scqi7 ul > ul::before{display:table-cell;content:'';}.css-9scqi7 ul{display:table;}.css-9scqi7 ul>li{display:table-row;list-style:none;}.css-9scqi7 ul>li::before{display:table-cell;content:'•  ';white-space:pre;}.css-9scqi7 ol{display:table;counter-reset:ol;}.css-9scqi7 ol > li{display:table-row;list-style:none;}.css-9scqi7 ol > li::before{display:table-cell;text-align:right;counter-increment:ol;content:counter(ol) '. ';white-space:pre;}.css-9scqi7 ol ol{counter-reset:ol2;}.css-9scqi7 ol ol li::before{counter-increment:ol2;content:counter(ol2) '. ';}.css-9scqi7 ol ol ol{counter-reset:ol3;}.css-9scqi7 ol ol ol li::before{counter-increment:ol3;content:counter(ol3) '. ';}.css-9scqi7 ol ol ol ol{counter-reset:ol4;}.css-9scqi7 ol ol ol ol li::before{counter-increment:ol4;content:counter(ol4) '. ';}.css-9scqi7 figure{margin:1.4em 0;}.css-9scqi7 figure .content_image,.css-9scqi7 figure .origin_image{margin:0 auto;}.css-9scqi7 figure figcaption{margin-top:calc(0.6em / 0.9);padding:0 1em;font-size:0.9em;line-height:1.5;text-align:center;color:#999999;}.css-9scqi7 figure + figure{margin-top:calc(1.4em * 1.6);}.css-9scqi7 figure[data-size='small'],.css-9scqi7 figure:not([data-size]) > [data-size='small']{clear:both;}.css-9scqi7 figure[data-size='left'],.css-9scqi7 figure:not([data-size]) > [data-size='left']{float:left;margin:0 20px 20px 0;max-width:33%;}.css-9scqi7 figure[data-size='right'],.css-9scqi7 figure:not([data-size]) > [data-size='right']{float:right;margin:0 0 20px 20px;max-width:33%;}.css-9scqi7 figure[data-size='collapse']{margin-bottom:0;}.css-9scqi7 figure[data-size='collapse'] + figure{margin-top:0;}.css-9scqi7 .content_image,.css-9scqi7 .origin_image{display:block;max-width:100%;margin:1.4em auto;}.css-9scqi7 .content_image[data-size='small'],.css-9scqi7 .origin_image[data-size='small']{max-width:40%;}.css-9scqi7 .content_image.zh-lightbox-thumb,.css-9scqi7 .origin_image.zh-lightbox-thumb{cursor:-webkit-zoom-in;cursor:-moz-zoom-in;cursor:zoom-in;}.css-9scqi7 code{margin:0 2px;padding:3px 4px;border-radius:3px;font-size:0.9em;background-color:#F6F6F6;}.css-9scqi7 pre{margin:1.4em 0;padding:calc(0.8em / 0.9);font-size:0.9em;word-break:initial;word-wrap:initial;white-space:pre;overflow:auto;-webkit-overflow-scrolling:touch;background:#F6F6F6;border-radius:4px;}.css-9scqi7 pre code{margin:0;padding:0;font-size:inherit;border-radius:0;background-color:inherit;}.css-9scqi7 li pre{white-space:pre-wrap;}.css-9scqi7 table[data-draft-type='table']{border-collapse:collapse;font-size:15px;margin:1.4em auto;max-width:100%;table-layout:fixed;text-align:left;width:100%;}.css-9scqi7 table[data-draft-type='table'][data-size='small']{min-width:260px;width:40%;}.css-9scqi7 table[data-draft-type='table'][data-row-style='striped'] tr:nth-of-type(2n + 1){background:#F6F6F6;}.css-9scqi7 table[data-draft-type='table'] td,.css-9scqi7 table[data-draft-type='table'] th{border:1px solid #D3D3D3;line-height:24px;height:24px;padding:3px 12px;}.css-9scqi7 table[data-draft-type='table'] th{background:#EBEBEB;color:#121212;font-weight:500;}.css-9scqi7 .video-box,.css-9scqi7 .link-box{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:1.4em 0;overflow:auto;white-space:normal;cursor:pointer;border:solid 1px #EBEBEB;border-radius:4px;}.css-9scqi7 .highlight{margin:1em 0;}.css-9scqi7 .highlight pre{margin:0;}.css-9scqi7 .highlight .hll{background-color:#FDFDFD;}.css-9scqi7 .highlight .c{font-style:italic;color:#999999;}.css-9scqi7 .highlight .err{color:#F1403C;}.css-9scqi7 .highlight .k{font-weight:600;}.css-9scqi7 .highlight .o{font-weight:600;}.css-9scqi7 .highlight .cm{font-style:italic;color:#999999;}.css-9scqi7 .highlight .cp{font-weight:600;color:#999999;}.css-9scqi7 .highlight .c1{font-style:italic;color:#999999;}.css-9scqi7 .highlight .cs{font-style:italic;font-weight:600;color:#999999;}.css-9scqi7 .highlight .gd{color:#FF3366;}.css-9scqi7 .highlight .ge{font-style:italic;}.css-9scqi7 .highlight .gr{color:#F1403C;}.css-9scqi7 .highlight .gh{color:#999999;}.css-9scqi7 .highlight .gi{color:#12b370;}.css-9scqi7 .highlight .go{color:#808080;}.css-9scqi7 .highlight .gp{color:#646464;}.css-9scqi7 .highlight .gs{font-weight:600;}.css-9scqi7 .highlight .gu{color:#999999;}.css-9scqi7 .highlight .gt{color:#F1403C;}.css-9scqi7 .highlight .kc{font-weight:600;}.css-9scqi7 .highlight .kd{font-weight:600;}.css-9scqi7 .highlight .kn{font-weight:600;}.css-9scqi7 .highlight .kp{font-weight:600;}.css-9scqi7 .highlight .kr{font-weight:600;}.css-9scqi7 .highlight .kt{font-weight:600;color:#175199;}.css-9scqi7 .highlight .m{color:#0066FF;}.css-9scqi7 .highlight .s{color:#F1403C;}.css-9scqi7 .highlight .na{color:#0066FF;}.css-9scqi7 .highlight .nb{color:#0066FF;}.css-9scqi7 .highlight .nc{font-weight:600;color:#175199;}.css-9scqi7 .highlight .no{color:#0066FF;}.css-9scqi7 .highlight .ni{color:#5555DD;}.css-9scqi7 .highlight .ne{font-weight:600;color:#F1403C;}.css-9scqi7 .highlight .nf{font-weight:600;color:#F1403C;}.css-9scqi7 .highlight .nn{color:#646464;}.css-9scqi7 .highlight .nt{color:#175199;}.css-9scqi7 .highlight .nv{color:#0066FF;}.css-9scqi7 .highlight .ow{font-weight:600;}.css-9scqi7 .highlight .w{color:#BFBFBF;}.css-9scqi7 .highlight .mf{color:#0066FF;}.css-9scqi7 .highlight .mh{color:#0066FF;}.css-9scqi7 .highlight .mi{color:#0066FF;}.css-9scqi7 .highlight .mo{color:#0066FF;}.css-9scqi7 .highlight .sb{color:#F1403C;}.css-9scqi7 .highlight .sc{color:#F1403C;}.css-9scqi7 .highlight .sd{color:#F1403C;}.css-9scqi7 .highlight .s2{color:#F1403C;}.css-9scqi7 .highlight .se{color:#F1403C;}.css-9scqi7 .highlight .sh{color:#F1403C;}.css-9scqi7 .highlight .si{color:#F1403C;}.css-9scqi7 .highlight .sx{color:#F1403C;}.css-9scqi7 .highlight .sr{color:#A5542F;}.css-9scqi7 .highlight .s1{color:#F1403C;}.css-9scqi7 .highlight .ss{color:#F1403C;}.css-9scqi7 .highlight .bp{color:#999999;}.css-9scqi7 .highlight .vc{color:#0066FF;}.css-9scqi7 .highlight .vg{color:#0066FF;}.css-9scqi7 .highlight .vi{color:#0066FF;}.css-9scqi7 .highlight .il{color:#0066FF;}.css-9scqi7 .highlight::-webkit-scrollbar{width:6px;height:6px;}.css-9scqi7 .highlight::-webkit-scrollbar-thumb:horizontal{background-color:rgba(18,18,18,0.5);border-radius:6px;}.css-9scqi7 .highlight::-webkit-scrollbar-thumb:horizontal:hover{background-color:rgba(18,18,18,0.6);}.css-9scqi7 .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-9scqi7 .LinkCard.old,.css-9scqi7 .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-9scqi7 .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-9scqi7 .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-9scqi7 .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-9scqi7 .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-9scqi7 .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-9scqi7 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-9scqi7 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-9scqi7 .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-9scqi7 .LinkCard.new,.css-9scqi7 .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-9scqi7 .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-9scqi7 .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-9scqi7 .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-9scqi7 .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-9scqi7 .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-9scqi7 .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-9scqi7 .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-9scqi7 .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-9scqi7 .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-9scqi7 .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-9scqi7 .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-9scqi7 .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-9scqi7 .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-9scqi7 .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-9scqi7 .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-9scqi7 .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-9scqi7 .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-9scqi7 .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-9scqi7 .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-9scqi7 .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-9scqi7 .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-9scqi7 .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-9scqi7 .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-9scqi7 .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-9scqi7 .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-9scqi7 .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-9scqi7 .FileLinkCard-info{margin-left:12px;}.css-9scqi7 .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-9scqi7 .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-9scqi7 .FileLinkCard-source{white-space:pre;}@-webkit-keyframes animation-1sh55c5{from{opacity:0;}to{opacity:1;}}@keyframes animation-1sh55c5{from{opacity:0;}to{opacity:1;}}</style><style data-emotion-css="u1frr4">.css-u1frr4{width:724px;}.css-u1frr4 .Modal-content{margin:22px 0 5px;}.css-u1frr4 .Creator-QuestionShared-title{padding-right:65px;}</style><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.zswsdid.eb4510afa5df1adce572.js" crossorigin="anonymous"></script><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.shared_da7c8ae9ba4d3befc7c2f1c0b3e151cc8ee375ec.bc4cf3e57021cf662ef3.js" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.user-hover-card.216a26f4.1d944eae917fc580b5d6.css" crossorigin="anonymous"><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.user-hover-card.567e8be40df9ebb3d9b6.js" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.Labels.216a26f4.7d19d2afdc588e36471f.css" crossorigin="anonymous"><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.Labels.bb59bec6de46804aeb57.js" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.GoodsRecommendGoodsCardList.216a26f4.fa4bea774ed719d42a42.css" crossorigin="anonymous"><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.GoodsRecommendGoodsCardList.902763a51c08b0535078.js" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.modals.216a26f4.0624cc5b69ccfd737e7c.css" crossorigin="anonymous"><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.modals.934774e2eb8139995982.js" crossorigin="anonymous"></script><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.report_modals.a5f834c988770c6c88f6.js" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.comments-modals.216a26f4.f0a517f339d2b1cb1827.css" crossorigin="anonymous"><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.comments-modals.b8ad3adcc96ba975a16d.js" crossorigin="anonymous"></script><style data-emotion="css"></style><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.54.3466060adf86e45ed572.js" crossorigin="anonymous"></script><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.lib_9974496f.7bf521a4e5f2cb0c0a5c.js" crossorigin="anonymous"></script><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.shared_03103dc5b8182a3433c5ef33bacb88093fd08a38.321624ab69aa2b854b36.js" crossorigin="anonymous"></script><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.shared_889419e066c38251e2dcbb9a7c42dbfc379cadeb.bd236b339846c26d541e.js" crossorigin="anonymous"></script><link rel="stylesheet" type="text/css" href="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.richinputV2.216a26f4.a2296ab0d1ee09677a8e.css" crossorigin="anonymous"><script charset="utf-8" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.richinputV2.bc299d585105504f9253.js" crossorigin="anonymous"></script></head><body class="WhiteBg-body PostIndex-body" data-rh="class"><div id="root"><div class="App"><div class="LoadingBar"></div><div><span style="position:absolute;top:-10000px;left:-10000px" role="log" aria-live="assertive"></span></div><main role="main" class="App-main"><div class="Post-content" data-zop-usertoken="{&quot;userToken&quot;:&quot;hexu1985&quot;}" data-zop="{&quot;authorName&quot;:&quot;fibonaccii&quot;,&quot;itemId&quot;:417061548,&quot;title&quot;:&quot;深入了解 | 内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析&quot;,&quot;type&quot;:&quot;article&quot;}" data-za-detail-view-path-module="PostItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;token&quot;:&quot;417061548&quot;}}}"><div class="ColumnPageHeader-Wrapper"><div><div class="Sticky ColumnPageHeader is-fixed css-1l12z7y" style="width: 1905px; top: 0px; left: 0px;"><div class="ColumnPageHeader-content"><a href="https://www.zhihu.com/" aria-label="知乎"><svg viewBox="0 0 64 30" fill="#0066FF" width="64" height="30" class="css-1hlrcxk"><path d="M29.05 4.582H16.733V25.94h3.018l.403 2.572 4.081-2.572h4.815V4.582zm-5.207 18.69l-2.396 1.509-.235-1.508h-1.724V7.233h6.78v16.04h-2.425zM14.46 14.191H9.982c0-.471.033-.954.039-1.458v-5.5h5.106V5.935a1.352 1.352 0 0 0-.404-.957 1.378 1.378 0 0 0-.968-.396H5.783c.028-.088.056-.177.084-.255.274-.82 1.153-3.326 1.153-3.326a4.262 4.262 0 0 0-2.413.698c-.57.4-.912.682-1.371 1.946-.532 1.453-.997 2.856-1.31 3.693C1.444 8.674.28 11.025.28 11.025a5.85 5.85 0 0 0 2.52-.61c1.119-.593 1.679-1.502 2.054-2.883l.09-.3h2.334v5.5c0 .5-.045.982-.073 1.46h-4.12c-.71 0-1.39.278-1.893.775a2.638 2.638 0 0 0-.783 1.874h6.527a17.717 17.717 0 0 1-.778 3.649 16.796 16.796 0 0 1-3.012 5.273A33.104 33.104 0 0 1 0 28.74s3.13 1.175 5.425-.954c1.388-1.292 2.631-3.814 3.23-5.727a28.09 28.09 0 0 0 1.12-5.229h5.967v-1.37a1.254 1.254 0 0 0-.373-.899 1.279 1.279 0 0 0-.909-.37z"></path><path d="M11.27 19.675l-2.312 1.491 5.038 7.458a6.905 6.905 0 0 0 .672-2.218 3.15 3.15 0 0 0-.28-2.168l-3.118-4.563zM51.449 15.195V5.842c4.181-.205 7.988-.405 9.438-.483l.851-.05c.387-.399.885-2.395.689-3.021-.073-.25-.213-.666-.638-.555a33.279 33.279 0 0 1-4.277.727c-2.766.321-3.97.404-7.804.682-6.718.487-12.709.72-12.709.72a2.518 2.518 0 0 0 .788 1.834 2.567 2.567 0 0 0 1.883.706c2.278-.095 5.598-.25 8.996-.41v9.203h-12.78c0 .703.281 1.377.783 1.874a2.69 2.69 0 0 0 1.892.777h10.105v7.075c0 .887-.464 1.192-1.231 1.214h-3.92a4.15 4.15 0 0 0 .837 1.544 4.2 4.2 0 0 0 1.403 1.067 6.215 6.215 0 0 0 2.71.277c1.36-.066 2.967-.826 2.967-3.57v-7.607h11.28c.342 0 .67-.135.91-.374.242-.239.378-.563.378-.902v-1.375H51.449z"></path><path d="M42.614 8.873a2.304 2.304 0 0 0-1.508-.926 2.334 2.334 0 0 0-1.727.405l-.376.272 4.255 5.85 2.24-1.62-2.884-3.98zM57.35 8.68l-3.125 4.097 2.24 1.663 4.517-5.927-.375-.277a2.32 2.32 0 0 0-1.722-.452 2.327 2.327 0 0 0-1.536.896z"></path></svg></a><i class="ColumnPageHeader-Line"></i><div class="ColumnPageHeader-Title"><div class="ColumnPageHeader-TitleName"><span class="ColumnPageHeader-TitleMeta">首发于</span><a class="ColumnLink ColumnPageHeader-TitleColumn" href="https://www.zhihu.com/column/c_1344587700045914112">深入了解Modern C++</a></div></div><div class="ColumnPageHeader-Button"><div class="Popover"><button title="更多" id="Popover1-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover1-content" type="button" class="Button ColumnPageHeader-MenuToggler Button--plain"><svg width="24" height="24" viewBox="0 0 24 24" data-new-api="Dots24" data-old-api="Dots" class="Zi Zi--Dots" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0z"></path></svg></button></div><button type="button" class="Button ColumnPageHeader-WriteButton Button--blue"><svg width="24" height="24" viewBox="0 0 24 24" data-new-api="PencilPaper24" data-old-api="EditSurround" class="Zi Zi--EditSurround" fill="currentColor"><path d="M3.55 5.97a2.415 2.415 0 012.415-2.416h7.56a.75.75 0 010 1.5h-7.56a.915.915 0 00-.915.915v12.072c0 .505.41.915.915.915h12.074c.506 0 .915-.41.915-.915v-7.557a.75.75 0 011.5 0v7.557a2.415 2.415 0 01-2.415 2.415H5.965A2.415 2.415 0 013.55 18.04V5.969z" fill-rule="evenodd" clip-rule="evenodd"></path><path d="M20.239 3.77a.75.75 0 010 1.06l-8.206 8.206a.75.75 0 01-1.06-1.06l8.205-8.206a.75.75 0 011.06 0z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>写文章</button></div></div><div class="ColumnPageHeader-profile"><div class="Popover AppHeader-menu"><button id="Popover9-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover9-content" type="button" class="Button AppHeader-profileEntry Button--plain"><img class="Avatar AppHeader-profileAvatar" width="30" height="30" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-abed1a8c04700ba7d72b45195223e0ff_is.jpg" srcset="https://pic3.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_im.jpg?source=32738c0c 2x" alt="点击打开hexu1985的主页"></button></div><div class="Popover AppHeaderProfileMenu-creatorHintPopover"><div class="AppHeaderProfileMenu-creatorHintToggler" id="Popover10-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover10-content"></div></div></div></div><div class="Sticky--holder" style="position: relative; inset: 0px; display: block; float: none; margin: 0px; height: 52px;"></div></div></div><article class="Post-Main Post-NormalMain" tabindex="-1"><header class="Post-Header"><h1 class="Post-Title">深入了解 | 内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析</h1><div class="Post-Author"><div class="AuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><div class="AuthorInfo"><meta itemprop="name" content="fibonaccii"><meta itemprop="image" content="https://pica.zhimg.com/v2-a71366f3d114e7933a248784fce4ba9c_l.jpg?source=172ae18b"><meta itemprop="url" content="https://www.zhihu.com/people/wx8bf61dc609c0aa69"><meta itemprop="zhihu:followerCount"><span class="UserLink AuthorInfo-avatarWrapper"><div class="Popover"><div id="Popover11-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover11-content"><a href="https://www.zhihu.com/people/wx8bf61dc609c0aa69" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar Avatar--round AuthorInfo-avatar" width="38" height="38" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-a71366f3d114e7933a248784fce4ba9c_xs.jpg" srcset="https://pica.zhimg.com/v2-a71366f3d114e7933a248784fce4ba9c_l.jpg?source=172ae18b 2x" alt="fibonaccii"></a></div></div></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><div class="Popover"><div id="Popover12-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover12-content"><a href="https://www.zhihu.com/people/wx8bf61dc609c0aa69" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">fibonaccii</a></div></div><a href="https://www.zhihu.com/question/48510028" target="_blank" class="css-n99yhz" aria-label="百度 C++后端工程师" data-tooltip="百度 C++后端工程师"><span class="css-18biwo">​<svg viewBox="0 0 24 24" class="css-1ifz0go" width="18" height="18"><svg viewBox="0 0 24 24" x="-3" y="-3" fill="#FFFFFF" width="30" height="30"><path d="M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z"></path></svg><path d="M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z" fill="#0066FF"></path><svg class="Zi Zi--Check" fill="#fff" x="6" y="6" viewBox="0 0 24 24" width="12" height="12"><path d="M10.229 17.516c-.318.327-.75.484-1.199.484-.453 0-.884-.16-1.202-.488l-4.335-4.47a1.77 1.77 0 0 1 .007-2.459 1.663 1.663 0 0 1 2.397.01l3.137 3.246 9.072-9.329a1.662 1.662 0 0 1 2.397 0c.663.681.663 1.786 0 2.466L10.23 17.516z" fill-rule="evenodd"></path></svg></svg></span></a></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="ztext AuthorInfo-badgeText">百度 C++后端工程师</div></div></div></div></div></div><button type="button" class="Button FollowButton Button--primary Button--blue"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="PlusFill24" data-old-api="Plus" class="Zi Zi--Plus FollowButton-icon" fill="currentColor"><path d="M13.25 3.25a1.25 1.25 0 10-2.5 0v7.5h-7.5a1.25 1.25 0 100 2.5h7.5v7.5a1.25 1.25 0 102.5 0v-7.5h7.5a1.25 1.25 0 000-2.5h-7.5v-7.5z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>关注他</button></div><div class="LabelContainer-wrapper"></div><div role="button" tabindex="0"><span class="Voters"><button type="button" class="Button Button--plain">92 人<!-- -->赞同了该文章</button></span></div></header><div class="Post-RichTextContainer"><div class="css-1yuhvjn"><div class="RichText ztext Post-RichText css-9scqi7" options="[object Object]"><p data-first-child="" data-pid="X1LCxWD0">本文首发于个人技术号：</p><div class="RichText-LinkCardContainer"><a target="_blank" href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzkyMjIxMzIxNA%3D%3D%26mid%3D2247487875%26idx%3D1%26sn%3Dba5c5d9460c8601b9af9958a4de50a3d%26chksm%3Dc1f69fb2f68116a495efbd3d1b4e3cc0df36884e6c4917f0527ce0b4002ef84c1845548a7617%26token%3D448078940%26lang%3Dzh_CN%23rd" data-draft-node="block" data-draft-type="link-card" data-text="深入了解C++(15) |  内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析" class="LinkCard new css-1wr1m8" data-image="https://pic1.zhimg.com/v2-3b5c9593dccbf88852d6faf340d58bf0_180x120.jpg" data-image-width="1080" data-image-height="459" data-za-detail-view-id="172"><span class="LinkCard-contents"><span class="LinkCard-title two-line">深入了解C++(15) |  内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析</span><span class="LinkCard-desc"><span style="display: inline-flex; align-items: center;">​<svg width="14" height="14" viewBox="0 0 24 24" data-new-api="Link24" data-old-api="InsertLink" class="Zi Zi--InsertLink" fill="currentColor"><path d="M5.327 18.883a3.005 3.005 0 010-4.25l2.608-2.607a.75.75 0 10-1.06-1.06l-2.608 2.607a4.505 4.505 0 006.37 6.37l2.608-2.607a.75.75 0 00-1.06-1.06l-2.608 2.607a3.005 3.005 0 01-4.25 0zm5.428-11.799a.75.75 0 001.06 1.06L14.48 5.48a3.005 3.005 0 014.25 4.25l-2.665 2.665a.75.75 0 001.061 1.06l2.665-2.664a4.505 4.505 0 00-6.371-6.372l-2.665 2.665zm5.323 2.117a.75.75 0 10-1.06-1.06l-7.072 7.07a.75.75 0 001.061 1.06l7.071-7.07z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>mp.weixin.qq.com/s?__biz=MzkyMjIxMzIxNA==&amp;mid=2247487875&amp;idx=1&amp;sn=ba5c5d9460c8601b9af9958a4de50a3d&amp;chksm=c1f69fb2f68116a495efbd3d1b4e3cc0df36884e6c4917f0527ce0b4002ef84c1845548a7617&amp;token=448078940&amp;lang=zh_CN#rd</span></span><span class="LinkCard-image" style="height: 60px;"><img src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-3b5c9593dccbf88852d6faf340d58bf0_180x120.jpg" alt=""></span></a></div><hr><p data-pid="9p6rf6Gb">关于内存对齐，有诸多好处，因此常常在分配内存时也会将内存对齐这一因素纳入考量。</p><p data-pid="VcC8EOrv">这一节，来讲下内存对齐以及C++11中关于内存对齐引入的<code>alignof</code>、<code>alignas</code>、<code>std::aligned_storage</code>、<code>std::align</code> ，其中前两个为关键字，后两个分别为类和函数。</p><h2>alignment</h2><p data-pid="UtO5ADiC">我们知道，C++中的内置的基础类型，比如<code>char</code>、<code>int</code>、<code>float</code>、<code>double</code>，在内存布局上都是按照其 <code>sizeof</code> 大小进行对齐（alignment）。</p><p data-pid="CDm00foP">什么叫对齐？</p><p data-pid="lwcX6Ety">比如，<code>sizoef(int)</code> 值为 4，如果满足内存对齐要求，那么int类型变量<code>a</code>的地址<code>&amp;a</code>对4取余的结果应该是0。</p><p data-pid="tVv0qPDQ">下面提供一个编译期就能检测内存对齐的宏 <code>CHECK_ALIGN</code>：</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#define CHECK_ALIGN(ptr, alignment)                       \
</span><span class="cp">  do{                                                     \
</span><span class="cp">    constexpr size_t status                               \
</span><span class="cp">       = reinterpret_cast&lt;uintptr_t&gt;(ptr) % alignment;    \
</span><span class="cp">    static_assert(status == 0, "ptr must be aligned");    \
</span><span class="cp">  }while(0)                                               \
</span></code></pre></div><p data-pid="kLoI1djU">下面我们来校验内置类型的内存对齐大小确实等于其<code>sizoef(T)</code>值，demo如下。</p><div class="highlight"><pre><code class="language-cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">l</span> <span class="p">;</span>
  <span class="kt">float</span> <span class="n">f</span><span class="p">;</span>
  <span class="n">CHECK_ALIGN</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
  <span class="n">CHECK_ALIGN</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
  <span class="n">CHECK_ALIGN</span><span class="p">(</span><span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">l</span><span class="p">));</span>
  <span class="n">CHECK_ALIGN</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
  <span class="n">CHECK_ALIGN</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">l</span><span class="p">));</span> <span class="c1">// 编译错误
</span><span class="c1"></span>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="ugyy6wdT">上述demo中的 <code>CHECK_ALIGN(&amp;i, sizeof(l));</code> 会导致编译错误，因为<code>int</code>类型变量的内存对齐大小要求是4，而<code>long</code>在gcc下是8个字节，即<code>sizoef(l)</code>为8，故而编译失败。</p><p data-pid="AY8bvaMy">到此，我相信你应该明白何为「内存对齐」了。</p><h2>alignof</h2><p data-pid="_mZF20XU">C++11引入的关键字<code>alignof</code>，可直接获取类型<code>T</code>的内存对齐要求。<code>alignof</code>的返回值类型是<code>size_t</code>，用法类似于<code>sizeof</code>。</p><p data-pid="4tT7e1EZ">下面先来看看<code>alignof</code>的用法。</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#define SHOW_SIZEOF_AND_ALIGNOF(T)                                   \
</span><span class="cp">  do {                                                               \
</span><span class="cp">    std::cout &lt;&lt; "sizeof(" &lt;&lt; #T &lt;&lt; "):\t" &lt;&lt; sizeof(T) &lt;&lt; ",\t"     \
</span><span class="cp">              &lt;&lt; "alignof(" &lt;&lt; #T &lt;&lt; "):\t" &lt;&lt; alignof(T)            \
</span><span class="cp">              &lt;&lt; std::endl;                                          \
</span><span class="cp">  }while(0)
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="n">SHOW_SIZEOF_AND_ALIGNOF</span><span class="p">(</span><span class="kt">char</span><span class="p">);</span>
  <span class="n">SHOW_SIZEOF_AND_ALIGNOF</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
  <span class="n">SHOW_SIZEOF_AND_ALIGNOF</span><span class="p">(</span><span class="kt">long</span><span class="p">);</span>
  <span class="n">SHOW_SIZEOF_AND_ALIGNOF</span><span class="p">(</span><span class="kt">float</span><span class="p">);</span>
  <span class="n">SHOW_SIZEOF_AND_ALIGNOF</span><span class="p">(</span><span class="kt">double</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="FHo2gtPH">输出如下，这也是符合前文关于基础类型内存对齐的论述。</p><div class="highlight"><pre><code class="language-bash">$ g++ main.cc -o main <span class="o">&amp;&amp;</span> ./main
sizeof<span class="o">(</span>char<span class="o">)</span>:   1,      alignof<span class="o">(</span>char<span class="o">)</span>:  <span class="m">1</span>
sizeof<span class="o">(</span>int<span class="o">)</span>:    4,      alignof<span class="o">(</span>int<span class="o">)</span>:   <span class="m">4</span>
sizeof<span class="o">(</span>long<span class="o">)</span>:   8,      alignof<span class="o">(</span>long<span class="o">)</span>:  <span class="m">8</span>
sizeof<span class="o">(</span>float<span class="o">)</span>:  4,      alignof<span class="o">(</span>float<span class="o">)</span>: <span class="m">4</span>
sizeof<span class="o">(</span>double<span class="o">)</span>: 8,      alignof<span class="o">(</span>double<span class="o">)</span>:8</code></pre></div><p data-pid="-8Nd_F6r">好，到此我相信你已经对内存对齐和<code>alignof</code>有了基本了解。下面我们来看看类的内存对齐。</p><p data-pid="qWmh-fNK">现在有类<code>Foo</code>：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">struct</span> <span class="nc">Foo</span> <span class="p">{</span> 
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i1</span><span class="p">;</span> 
  <span class="kt">int</span> <span class="n">i2</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">l</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div><p data-pid="nkhP5FDC">考虑下<code>alignof(Foo)</code>和<code>sizeof(Foo)</code>分别会是多少，即下面的demo会输出？？？</p><div class="highlight"><pre><code class="language-cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="n">SHOW_SIZEOF_AND_ALIGNOF</span><span class="p">(</span><span class="n">Foo</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p data-pid="FNIjaCSW">Think Again~~~~</p><p data-pid="DuTNmqxz">3</p><p data-pid="d6jVH97P">2</p><p data-pid="3g_IYyU-">1</p><div class="highlight"><pre><code class="language-bash">$ g++ main.cc -o main <span class="o">&amp;&amp;</span> ./main
sizeof<span class="o">(</span>Foo<span class="o">)</span>:    24,     alignof<span class="o">(</span>Foo<span class="o">)</span>:   <span class="m">8</span></code></pre></div><p data-pid="7juMJNnG">嗯？怎么会是这个结果？</p><p data-pid="AjDHRisw">为了更好地解释这个结果，我准备借助<code>offsetof</code>函数，来获取成员变量距离类起始地址的偏移量，其函数原型如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="cm">/* Offset of member MEMBER in a struct of type TYPE. */</span>
<span class="cp">#define offsetof(OBJECT_TYPE, MEMBER) __builtin_offsetof (OBJECT_TYPE, MEMBER)
</span></code></pre></div><p data-pid="LPv5N8Qp">好，现在看下如下代码，并猜测下输出？</p><div class="highlight"><pre><code class="language-cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">offsetof</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>  <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span>
            <span class="o">&lt;&lt;</span> <span class="n">offsetof</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span> 
            <span class="o">&lt;&lt;</span> <span class="n">offsetof</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span>
            <span class="o">&lt;&lt;</span> <span class="n">offsetof</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>  <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre></div><p data-pid="UdKR15G4">输出如下：</p><div class="highlight"><pre><code class="language-bash">$ g++ main.cc -o main <span class="o">&amp;&amp;</span> ./main
<span class="m">0</span>   <span class="c1"># c 的偏移量为 0 </span>
<span class="m">4</span>   <span class="c1"># i1 的偏移量为 4， c  -&gt; i1 中间填充了 3个字节，才满足 4 字节的内存对齐要求</span>
<span class="m">8</span>   <span class="c1"># i2 的偏移量为 8,  i1 -&gt; i2 无填充</span>
<span class="m">16</span>  <span class="c1"># l 的偏移量为 16， i2 -&gt; l  中间填充了4个字节，才满足8字节的内存对齐要求</span></code></pre></div><p data-pid="DIYVEmrH">好，到此，我准备基于这个输出来解释<code>alignof</code>了。</p><p data-pid="9ANLWSn-">对于<code>Foo</code>而言，所谓内存对齐，即<code>Foo</code>中每个字段都要满足内存对齐。而内存对齐最严格（即对齐字节数最大）的字段满足了，其他的字段也就满足了。</p><p data-pid="PTnksHSP">假设现在有三个起始地址，分别是 0、1、4，我们来看看是否都能满足<code>Foo</code>中所有字段的内存对齐要求。</p><p data-pid="yPI1ortp">起始地址分别0、1、4，各个字段的地址如下三列。</p><div class="highlight"><pre><code class="language-cpp"><span class="k">struct</span> <span class="nc">Foo</span> <span class="p">{</span>   
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>     <span class="c1">// 0  |  1  |  4
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i1</span><span class="p">;</span>     <span class="c1">// 4  |  5  |  8
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i2</span><span class="p">;</span>     <span class="c1">// 8  |  9  |  12 
</span><span class="c1"></span>  <span class="kt">long</span> <span class="n">l</span><span class="p">;</span>     <span class="c1">// 16 |  17 |  20
</span><span class="c1"></span><span class="p">};</span>
</code></pre></div><p data-pid="ibAuynLd">从上面的右侧三列结果可以看出，只有起始地址为0（8的整倍数）的恰好能满足所有字段内存对齐的要求。因此，<code>alignof(Foo)</code>输出为8。</p><h2>alignas</h2><p data-pid="aTMe3nx0">上面讲述的内存对齐要求都是默认情况下的，有时候考虑到cacheline、以及向量化操作，可能会需要改变一个类的<code>alignof</code>值。</p><p data-pid="YLYgBlXm">怎么办？</p><p data-pid="dWRWu1B_">在C++11之前，需要依赖靠编译器的扩展指令，C++11之后可以借助<code>alignas</code>关键字。</p><blockquote data-pid="1Kl1E-L8"> 比如，在C++11之前，gcc实现 <code>alignas(alignment)</code> 效果的方式为  <code>__attribute__((__aligned__((alignment)))</code><br> </blockquote><p data-pid="1v2apwTu">仍然以上述的<code>Foo</code>为例子，不过此时你希望<code>Foo</code>对象的起始地址总是32的倍数，C++11之后借助<code>alignas</code>关键字，可以如下操作：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">struct</span> <span class="nf">alignas</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="n">Foo</span> <span class="p">{</span> 
  <span class="n">Foo</span><span class="p">()</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">this</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i1</span><span class="p">;</span> 
  <span class="kt">int</span> <span class="n">i2</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">l</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="n">Foo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">CHECK_ALIGN</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="p">,</span> <span class="k">alignof</span><span class="p">(</span><span class="n">foo</span><span class="p">));</span>
  <span class="n">SHOW_SIZEOF_AND_ALIGNOF</span><span class="p">(</span><span class="n">Foo</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="FHU_NF56">输出如下：</p><div class="highlight"><pre><code class="language-text">$ g++ main.cc -o main &amp;&amp; ./main
0x16d6f34e0
sizeof(Foo):    32,     alignof(Foo):   32</code></pre></div><p data-pid="OOw_rZE2">说完<code>alignas</code>的基础用法，下面说下使用<code>alignas</code>时的注意事项，即<code>alignas(alignment)</code>中的<code>alignment</code>也不是随意写的，对于类型<code>T</code>，需要满足如下两个条件。</p><h3>1. alignment &gt;= alignof(T)</h3><p data-pid="7dobj7dR">仍然以<code>Foo</code>为例，在没有<code>alignas</code>修饰时，默认的Foo的内存对齐要求<code>alignof(Foo)</code>为8，现在尝试使用<code>alignas</code>让<code>Foo</code>的对齐要求为4，操作如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">struct</span> <span class="nf">alignas</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">Foo</span> <span class="p">{</span> 
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i2</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">l</span><span class="p">;</span> 
<span class="p">};</span>
</code></pre></div><p data-pid="_pyMrTcO">此时 <code>SHOW_SIZEOF_AND_ALIGNOF(Foo);</code>的输出</p><div class="highlight"><pre><code class="language-bash">$ g++ main.cc -o main <span class="o">&amp;&amp;</span> ./main
sizeof<span class="o">(</span>Foo<span class="o">)</span>:    24,     alignof<span class="o">(</span>Foo<span class="o">)</span>:   <span class="m">8</span></code></pre></div><p data-pid="kPeTTx-S">可以看出，此时的<code>alignas</code>是失效的，在其他编译器下也许直接编译失败。</p><h3>2. alignment == pow(2, N)</h3><p data-pid="Zn7mUocZ">即<code>alignas</code> 指定的大小<code>alignment</code>必须是2的正数幂（<code>N&gt;0</code>），否则也是失效，在有些编译器下也许直接编译失败。</p><p data-pid="c4tMzBx3">仍然以<code>Foo</code>为例子，</p><div class="highlight"><pre><code class="language-cpp"><span class="k">struct</span> <span class="nf">alignas</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="n">Foo</span> <span class="p">{</span> 
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i2</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">l</span><span class="p">;</span> 
<span class="p">};</span>
</code></pre></div><p data-pid="_4A0tCBW">编译如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="err">$</span> <span class="n">g</span><span class="o">++</span> <span class="n">main</span><span class="p">.</span><span class="n">cc</span> <span class="o">-</span><span class="n">o</span> <span class="n">main</span> <span class="o">&amp;&amp;</span> <span class="p">.</span><span class="o">/</span><span class="n">main</span>
<span class="n">main</span><span class="p">.</span><span class="nl">cc</span><span class="p">:</span><span class="mi">20</span><span class="o">:</span><span class="mi">19</span><span class="o">:</span> <span class="nl">error</span><span class="p">:</span> <span class="n">requested</span> <span class="n">alignment</span> <span class="sc">'9'</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">positive</span> <span class="n">power</span> <span class="n">of</span> <span class="mi">2</span>
   <span class="mi">20</span> <span class="o">|</span> <span class="k">struct</span> <span class="nc">alignas</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="n">Foo</span> <span class="p">{</span>
      <span class="o">|</span>                   <span class="o">^~~</span>
</code></pre></div><p data-pid="XxBFPFAE">好，到此，我想你应该大致理解了<code>alignof</code>和<code>alignas</code>两个关键字，更多用法可以参`<a href="https://link.zhihu.com/?target=https%3A//zh.cppreference.com/w/%25E9%25A6%2596%25E9%25A1%25B5" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">cpprefernece</a>。</p><h2>std::aligned_storage</h2><p data-pid="9HpAonQu">在C++11中，也引入了一个满足内存对齐要求的静态内存分配类<code>std::aligned_storage</code>，其类模板原型如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="c1">// in &lt;type_traits&gt;
</span><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">Len</span><span class="p">,</span> 
          <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">Align</span> <span class="o">=</span> <span class="cm">/*default-alignment*/</span> <span class="o">&gt;</span>
<span class="k">struct</span> <span class="nc">aligned_storage</span><span class="p">;</span>
</code></pre></div><p data-pid="UwN3VpAY">类<code>std::aligned_storage</code>对象构造完成时，即分配了长度为<code>Len</code>个字节的内存，且该内存满足大小为 <code>Align</code> 的对齐要求。</p><p data-pid="FbTV-5BM">下面，我们先来看看 <a href="https://link.zhihu.com/?target=https%3A//zh.cppreference.com/w/%25E9%25A6%2596%25E9%25A1%25B5" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">cpprefernece</a> 给的一个demo，来熟悉下怎么使用<code>std::aligned_storage</code>。</p><p data-pid="SyCwsxie">类 <code>StaticVector</code> ，是一个满足内存对齐要求的静态数组，模板参数<code>T</code>是元素类型，<code>N</code>是数组元素个数。</p><div class="highlight"><pre><code class="language-cpp"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">N</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">StaticVector</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">StaticVector</span><span class="p">()</span> <span class="p">{</span> 
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">alignof</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"/"</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">idx</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">StaticVector</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="n">size_t</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">m_size</span><span class="p">;</span> <span class="o">++</span><span class="n">pos</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">T</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="n">pos</span><span class="p">)</span><span class="o">-&gt;~</span><span class="n">T</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="p">...</span><span class="n">Args</span><span class="o">&gt;</span> 
    <span class="kt">void</span> <span class="n">emplace_back</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">m_size</span> <span class="o">&gt;=</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">bad_alloc</span><span class="p">{};</span>
      <span class="p">}</span>
      <span class="k">new</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="n">m_size</span><span class="p">)</span> <span class="n">T</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...);</span>
      <span class="o">++</span><span class="n">m_size</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="n">size_t</span> <span class="n">pos</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">*</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">T</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">data</span><span class="o">+</span><span class="n">pos</span><span class="p">);</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
  <span class="c1">// std::aligned_storage&lt;sizeof(T), alignof(T)&gt;::type data[N]; // C++11
</span><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">aligned_storage_t</span><span class="o">&lt;</span><span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="k">alignof</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>        <span class="c1">// c++14
</span><span class="c1"></span>  <span class="n">size_t</span> <span class="n">m_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div><p data-pid="Og613tTY">类<code>StaticVector</code>的使用如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">struct</span> <span class="nf">alignas</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="n">Foo</span> <span class="p">{</span> 
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i1</span><span class="p">;</span> 
  <span class="kt">int</span> <span class="n">i2</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">l</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">StaticVector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="n">v1</span><span class="p">;</span>
    <span class="n">v1</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="sc">'*'</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>

    <span class="n">StaticVector</span><span class="o">&lt;</span><span class="n">Foo</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;</span><span class="n">v2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="062JaVT_">在输出前，我们预测下：</p><ul><li data-pid="V7CSGMgc"><code>std:::string</code> 的<code>alignof</code>值是8，那么<code>StaticVector</code>分配的两个<code>std::string</code>对象地址，都应该是8的倍数</li><li data-pid="bbPrrSMx"><code>Foo</code>的<code>alignof</code>值是32，那么<code>StaticVector</code>为<code>Foo</code> 分配的两个<code>Foo</code>对象地址，都是32的倍数，</li></ul><p data-pid="6aykO3p8">好，现在我们来看下输出：</p><div class="highlight"><pre><code class="language-bash">$ g++ align_stroe.cc -o as <span class="o">&amp;&amp;</span> ./as
8/32
0x16b5734c0
0x16b5734e0
*****
32/32
0x16b573470
0x16b573490</code></pre></div><p data-pid="AkKgOTFj">所以，到此，你也许理解了<code>std::aligned_storage</code> 中<code>aligned</code>的含义，即每个对象都是经过内存对齐的。</p><p data-pid="OikYMrR-">熟悉了<code>std::aligned_storage</code> 的用法，现在来看看他的实现叭，毕竟没人愿意只做个调包侠（滑稽脸）。</p><div class="highlight"><pre><code class="language-cpp"><span class="c1">// in std namespace;
</span><span class="c1"></span>  <span class="k">template</span> <span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">_Len</span><span class="o">&gt;</span>
  <span class="k">struct</span> <span class="nc">__aligned_storage_msa</span> <span class="p">{</span>
    <span class="k">union</span> <span class="nc">__type</span> <span class="p">{</span>
      <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">__data</span><span class="p">[</span><span class="n">_Len</span><span class="p">];</span>
      <span class="k">struct</span> <span class="nf">__attribute__</span><span class="p">((</span><span class="n">__aligned__</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span> <span class="n">__align</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">_Len</span><span class="p">,</span> 
                  <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">_Align</span> <span class="o">=</span> <span class="k">alignof</span><span class="p">(</span><span class="k">typename</span> <span class="n">__aligned_storage_msa</span><span class="o">&lt;</span><span class="n">_Len</span><span class="o">&gt;::</span><span class="n">__type</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="k">struct</span> <span class="nc">aligned_storage</span> <span class="p">{</span>
    <span class="k">union</span> <span class="nc">type</span> <span class="p">{</span>
      <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">__data</span><span class="p">[</span><span class="n">_Len</span><span class="p">];</span>
      <span class="k">struct</span> <span class="nf">alignas</span><span class="p">(</span><span class="n">_Align</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="n">__align</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
</code></pre></div><p data-pid="tFObfg31">在 <code>std::aligned_storage</code> 内部，是通过一个<code>union</code>来实现的：</p><ul><li data-pid="oVj1Du6T"><code>unsigned char __data[_Len];</code>：这一行保证了分配的内存大小是<code>_Len</code>个字节</li><li data-pid="XSaW9XB5"><code>struct alignas(_Align) { } __align;</code> ：这一行保证了分配的内存是按照<code>Align</code> 大小进行对齐的。</li></ul><p data-pid="op3SpWDO">其中，第二点很好理解：</p><div class="highlight"><pre><code class="language-cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="k">alignas</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="kt">char</span> <span class="n">aligned_data</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"unaligned: "</span><span class="o">&lt;&lt;</span> <span class="k">alignof</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">", aligned: "</span> <span class="o">&lt;&lt;</span> <span class="k">alignof</span><span class="p">(</span><span class="n">aligned_data</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="A_Jd1-z6">输出如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="nl">unaligned</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nl">aligned</span><span class="p">:</span> <span class="mi">16</span>
</code></pre></div><p data-pid="D2hU2API">因此，如果只有<code>unsigned char __data[_Len]；</code>，无法保证内存对齐，需要<code>struct alignas(_Align) { } __align</code>的辅助。</p><p data-pid="RZ0gu_fv">最后再提下 <code>std::__aligned_storage_msa</code>的必要性：在构造类<code>std::aligned_storage</code>对象时，如果没有指定类的第二个模板参数<code>_Align</code>，即内存对齐大小，由<code>std::__aligned_storage_msa</code>为你设置默认的内存对齐大小。</p><p data-pid="GFC6YhKO">可以看出，在 <code>std::__aligned_storage_msa</code> 的实现中，<code>__attribute__((__aligned__))</code> 后面是没有参数的，此时gcc即会根据平台生成默认内存对齐大小。</p><div class="highlight"><pre><code class="language-cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">alignof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">__aligned_storage_msa</span><span class="o">&lt;</span><span class="k">sizeof</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;::</span><span class="n">__type</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">alignof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">__aligned_storage_msa</span><span class="o">&lt;</span><span class="k">sizeof</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;::</span><span class="n">__type</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">alignof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">__aligned_storage_msa</span><span class="o">&lt;</span><span class="k">sizeof</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">&gt;::</span><span class="n">__type</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">alignof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">__aligned_storage_msa</span><span class="o">&lt;</span><span class="k">sizeof</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">&gt;::</span><span class="n">__type</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="l_pvLidm">输出如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="err">$</span> <span class="n">g</span><span class="o">++</span> <span class="n">align_stroe</span><span class="p">.</span><span class="n">cc</span> <span class="o">-</span><span class="n">o</span> <span class="n">as</span> <span class="o">&amp;&amp;</span> <span class="p">.</span><span class="o">/</span><span class="n">as</span>
<span class="mi">16</span>
<span class="mi">16</span>
<span class="mi">16</span>
<span class="mi">16</span>
</code></pre></div><p data-pid="B0nJY5Fw">这个大小就是gcc编译器默认的内存大小。</p><h2>std::align</h2><p data-pid="PPpczgwc">类<code>std::aligned_storage</code> 是一个静态的内存对齐分配器，即在类<code>std::aligned_storage</code>对象构造完时，就已满足设定内存大小、内存对齐要求，但是如果现在有一块内存，想从中取出一块符合某对齐要求的内存，咋办？</p><p data-pid="rEomvZ8R">此时就可以使用<code>std::align</code>函数，其函数原型如下：</p><div class="highlight"><pre><code class="language-cpp"><span class="c1">/// @param  alignment 是想要分配的内存符合的内存对齐大小
</span><span class="c1">/// @param  size 想要分配内存的大小
</span><span class="c1">/// @param  ptr 是个输入输出参数，输入时指向待使用的内存，输出时调整为符合alignment对齐要求的内存地址
</span><span class="c1">/// @param  space 是ptr指向的内存剩余的空间
</span><span class="c1">/// @return 如果 ptr 经过调整后能满足大小为 alignment 的对齐要求，则返回ptr的值，否则返回 nullptr
</span><span class="c1"></span><span class="kt">void</span><span class="o">*</span> <span class="nf">align</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">alignment</span><span class="p">,</span>
             <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">size</span><span class="p">,</span>
             <span class="kt">void</span><span class="o">*&amp;</span> <span class="n">ptr</span><span class="p">,</span>
             <span class="n">std</span><span class="o">::</span><span class="n">size_t</span><span class="o">&amp;</span> <span class="n">space</span><span class="p">);</span>
</code></pre></div><p data-pid="DpVHrjPn">下面，我们继续先来看看 <a href="https://link.zhihu.com/?target=https%3A//zh.cppreference.com/w/%25E9%25A6%2596%25E9%25A1%25B5" class=" wrap external" target="_blank" rel="nofollow noreferrer" data-za-detail-view-id="1043">cpprefernece</a> 中提供的一个demo，熟悉下怎么使用<code>std::align</code>这个函数。</p><p data-pid="SNY73k1u">类<code>Arena</code>内已有一块缓冲区<code>buffer</code>，每次调用<code>AlignedAllocate&lt;T&gt;(size_t alignment)</code>函数时，即需要从<code>buffer</code>中取出大小为<code>sizeof(T)</code>的一块内存<code>ptr</code>，<code>AlignedAllocate</code>函数的输入参数<code>alignment</code>指定了获得的内存<code>ptr</code>满足的内存对齐要求。</p><p data-pid="SUofsqoP">现在来看看实现。</p><div class="highlight"><pre><code class="language-cpp"><span class="k">template</span> <span class="o">&lt;</span><span class="n">size_t</span> <span class="n">N</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="nc">Arena</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
  <span class="kt">void</span><span class="o">*</span> <span class="n">ptr</span><span class="p">;</span>
  <span class="n">size_t</span> <span class="n">size</span><span class="p">;</span>

  <span class="n">Arena</span><span class="p">()</span> <span class="o">:</span> <span class="n">ptr</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span> <span class="n">size</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

  <span class="c1">/// @return 返回的指针满足大小为 alignment 的内存对齐要求
</span><span class="c1"></span>  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
  <span class="n">T</span><span class="o">*</span> <span class="n">AlignedAllocate</span><span class="p">(</span><span class="n">size_t</span> <span class="n">alignment</span> <span class="o">=</span> <span class="k">alignof</span><span class="p">(</span><span class="n">T</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"ptr: "</span> <span class="o">&lt;&lt;</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">align</span><span class="p">(</span><span class="n">alignment</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">T</span><span class="o">*</span> <span class="n">result</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">T</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
          <span class="n">ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">ptr</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
          <span class="n">size</span> <span class="o">-=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
          <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// 若无，则返回 nullptr
</span><span class="c1"></span>      <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div><p data-pid="QL9awF66">下面是测试。</p><div class="highlight"><pre><code class="language-cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">Arena</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span> <span class="n">arena</span><span class="p">;</span>

    <span class="kt">char</span><span class="o">*</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">arena</span><span class="p">.</span><span class="n">AlignedAllocate</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">*</span><span class="n">p1</span> <span class="o">=</span> <span class="sc">'a'</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"allocated a char at "</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">p1</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>

    <span class="kt">int</span><span class="o">*</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">arena</span><span class="p">.</span><span class="n">AlignedAllocate</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">*</span><span class="n">p2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"allocated an int at "</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">p2</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>

    <span class="kt">int</span><span class="o">*</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">arena</span><span class="p">.</span><span class="n">AlignedAllocate</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p3</span><span class="p">)</span> <span class="o">*</span><span class="n">p3</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"allocated an int at "</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">p3</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="NdNa2dPM">从下面的输出可以看出，<code>AlignedAllocate</code> 函数返回的内存地址都是符合设定的内存对齐要求的。</p><div class="highlight"><pre><code class="language-bash">$ g++ align.cc -o align <span class="o">&amp;&amp;</span> ./align 
ptr: 0x16fc2b4b8, allocated a char at 0x16fc2b4b8     <span class="c1"># 1 byte 内存对齐，指针无须调整</span>
ptr: 0x16fc2b4b9, allocated an int at 0x16fc2b4bc     <span class="c1"># 4 byte 内存对齐，指针调整了 3 个字节</span>
ptr: 0x16fc2b4c0, allocated an int at 0x16fc2b4c0     <span class="c1"># 32 byte 内存对齐，指针无须调整</span></code></pre></div><p data-pid="dlZ3yaTg">最后，我们再来看看<code>std::align</code>函数的实现，稍微简化后如下。</p><div class="highlight"><pre><code class="language-cpp"><span class="c1">// in &lt;memory&gt;
</span><span class="c1"></span>  <span class="kr">inline</span> <span class="kt">void</span><span class="o">*</span> <span class="nf">align</span><span class="p">(</span><span class="n">size_t</span> <span class="n">__align</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">__size</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*&amp;</span><span class="n">__ptr</span><span class="p">,</span> <span class="n">size_t</span> <span class="o">&amp;</span><span class="n">__space</span><span class="p">)</span> <span class="k">noexcept</span> <span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">__intptr</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">uintptr_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">__ptr</span><span class="p">);</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">__aligned</span> <span class="o">=</span> <span class="p">(</span><span class="n">__intptr</span> <span class="o">-</span> <span class="mi">1u</span> <span class="o">+</span> <span class="n">__align</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">__align</span><span class="p">;</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">__diff</span> <span class="o">=</span> <span class="n">__aligned</span> <span class="o">-</span> <span class="n">__intptr</span><span class="p">;</span>
    <span class="c1">// 如果没有剩余的空间，直接返回 nullptr
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="n">__size</span> <span class="o">+</span> <span class="n">__diff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">__space</span><span class="p">)</span>
      <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
     <span class="n">__space</span> <span class="o">-=</span> <span class="n">__diff</span><span class="p">;</span>
     <span class="k">return</span> <span class="n">__ptr</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">void</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">__aligned</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div><p data-pid="rwPFpL0J"><code>std::align</code>的实现里，最为关键的一步，即计算对齐后的地址：</p><div class="highlight"><pre><code class="language-cpp"><span class="k">const</span> <span class="k">auto</span> <span class="n">__aligned</span> <span class="o">=</span> <span class="p">(</span><span class="n">__intptr</span> <span class="o">-</span> <span class="mi">1u</span> <span class="o">+</span> <span class="n">__align</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">__align</span><span class="p">;</span>
</code></pre></div><p data-pid="8NtcnGUL">对于这一步，本来想写个证明啥的，还是举个例子来解释比较通俗。</p><p data-pid="xxF2AzTe">按照<code>__align</code>大小进行内存对齐，即可视为按<code>__align</code>进制向上取整。</p><p data-pid="kSyXWYWL">什么意思呢？</p><p data-pid="x-I2Luyv">比如说，现在按照10进制对齐，有地址12，想让12向上调整到10的倍数，怎么做？</p><ol><li data-pid="wGrX-VWU">先加上一个步长：<code>12 + 10 - 1 = 21</code></li><li data-pid="JFuRAKOZ">将余数1清掉：<code>21 &amp;  (-10) = 20</code>。这一步中，<code>-10</code> 的本质就是保证高位不变，将低位全部变为0，取<code>&amp;</code>之后，取余就全部清理了。</li></ol><p data-pid="PckDFstC">现在的内存对齐，本质上也是向上取整：<code>__intptr - 1u + __align</code>是为了向前一个步长，再对  <code>-__align</code>取<code>&amp;</code>，来清除余数。</p><p data-pid="nyaLyFk1">关于内存对齐，很多项目里都有涉及，最近在阅读RocksDb也再次遇到，于是乎就找了个契机写下了这篇博客，后续会尝试更新RocksDb。</p></div></div></div><div role="button" tabindex="0" class="ContentItem-time">发布于 2021-10-05 01:03</div><div class="Reward"><div><div class="Reward-tagline">「真诚赞赏，手留余香」</div><button class="Reward-rewardBtn">赞赏</button></div><div class="Reward-countZero">还没有人赞赏，快来当第一个赞赏的人吧！</div></div><div class="Post-topicsAndReviewer"><div class="TopicList Post-Topics"><div class="Tag Topic" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19584970&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19584970" target="_blank"><div class="Popover"><div id="Popover2-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover2-content">C++</div></div></a></span></div><div class="Tag Topic" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19579205&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19579205" target="_blank"><div class="Popover"><div id="Popover3-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover3-content">内存管理</div></div></a></span></div><div class="Tag Topic" data-za-detail-view-path-module="TopicItem" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19726035&quot;}}}"><span class="Tag-content"><a class="TopicLink" href="https://www.zhihu.com/topic/19726035" target="_blank"><div class="Popover"><div id="Popover4-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover4-content">C++11</div></div></a></span></div></div></div><div><div class="Sticky RichContent-actions is-bottom" style=""><div class="ContentItem-actions" data-za-detail-view-path-module="BottomBar" data-za-extra-module="{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;id&quot;:&quot;417061548&quot;}}}"><span><button aria-label="赞同 92 " aria-live="polite" type="button" class="Button VoteButton VoteButton--up"><span style="display:inline-flex;align-items:center">​<svg width="10" height="10" viewBox="0 0 24 24" data-new-api="AgreeFill24" data-old-api="TriangleUp" class="Zi Zi--TriangleUp VoteButton-TriangleUp" fill="currentColor"><path d="M13.792 3.681c-.781-1.406-2.803-1.406-3.584 0l-7.79 14.023c-.76 1.367.228 3.046 1.791 3.046h15.582c1.563 0 2.55-1.68 1.791-3.046l-7.79-14.023z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>赞同 92</button><button aria-label="反对" aria-live="polite" type="button" class="Button VoteButton VoteButton--down"><span style="display:inline-flex;align-items:center">​<svg width="10" height="10" viewBox="0 0 24 24" data-new-api="OpposeFill24" data-old-api="TriangleDown" class="Zi Zi--TriangleDown" fill="currentColor"><path d="M13.792 20.319c-.781 1.406-2.803 1.406-3.584 0L2.418 6.296c-.76-1.367.228-3.046 1.791-3.046h15.582c1.563 0 2.55 1.68 1.791 3.046l-7.79 14.023z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span></button></span><button type="button" class="Button BottomActions-CommentBtn Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ChatBubbleFill24" data-old-api="Comment" class="Zi Zi--Comment Button-zi" fill="currentColor"><path d="M12 2.75a9.25 9.25 0 104.737 17.197l2.643.817a1 1 0 001.25-1.25l-.8-2.588A9.25 9.25 0 0012 2.75z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>8 条评论</button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="Popover5-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover5-content"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="PaperplaneFill24" data-old-api="Share" class="Zi Zi--Share Button-zi" fill="currentColor"><path d="M19.47 1.914a.8.8 0 011.204.778l-1.872 16.386a.9.9 0 01-1.204.743l-4.615-1.692a.7.7 0 00-.831.28l-1.927 3.02c-.43.674-1.474.369-1.474-.43v-3.865a.8.8 0 01.179-.504l5.808-7.148a.595.595 0 00-.897-.781l-5.93 6.354a1.1 1.1 0 01-1.258.252L2.57 13.46a.8.8 0 01-.08-1.415l16.98-10.13z"></path></svg></span>分享</button></div></div><button aria-live="polite" type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="HeartFill24" data-old-api="Heart" class="Zi Zi--Heart Button-zi" fill="currentColor"><path d="M12.004 4.934c1.015-.944 2.484-1.618 3.98-1.618 3.48 0 6.53 3.265 6.15 7.614-.11 1.254-.686 2.55-1.458 3.753-.778 1.215-1.79 2.392-2.845 3.419-1.054 1.028-2.168 1.923-3.161 2.566a9.96 9.96 0 01-1.41.777c-.418.182-.862.32-1.268.32s-.848-.137-1.267-.317a9.918 9.918 0 01-1.407-.771c-.992-.64-2.103-1.53-3.156-2.555-1.052-1.024-2.062-2.2-2.84-3.417-.77-1.208-1.346-2.51-1.456-3.775-.38-4.349 2.67-7.614 6.15-7.614 1.484 0 2.983.673 3.988 1.618z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>喜欢</button><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="StarFill24" data-old-api="Star" class="Zi Zi--Star Button-zi" fill="currentColor"><path d="M10.484 3.307c.673-1.168 2.358-1.168 3.032 0l2.377 4.122a.25.25 0 00.165.12l4.655.987c1.319.28 1.84 1.882.937 2.884l-3.186 3.535a.25.25 0 00-.063.193l.5 4.733c.142 1.34-1.222 2.33-2.453 1.782l-4.346-1.938a.25.25 0 00-.204 0l-4.346 1.938c-1.231.549-2.595-.442-2.453-1.782l.5-4.733a.25.25 0 00-.064-.193L2.35 11.42c-.903-1.002-.382-2.604.937-2.884l4.655-.987a.25.25 0 00.164-.12l2.378-4.122z"></path></svg></span>收藏</button><button type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="TrayFullFill24" data-old-api="Deliver" class="Zi Zi--Deliver Button-zi" fill="currentColor"><g fill-rule="evenodd" clip-rule="evenodd"><path d="M7.821 12a.75.75 0 01.75-.75h6.857a.75.75 0 010 1.5H8.571a.75.75 0 01-.75-.75zm1.144-4a.75.75 0 01.75-.75h4.571a.75.75 0 010 1.5H9.715a.75.75 0 01-.75-.75z"></path><path d="M7.527 3.15a2.35 2.35 0 00-2.309 1.91L3.165 15.84a.85.85 0 00-.015.16v2.5a2.35 2.35 0 002.35 2.35h13a2.35 2.35 0 002.35-2.35V16a.848.848 0 00-.015-.16L18.78 5.06a2.35 2.35 0 00-2.308-1.91H7.527zm0 1.7a.65.65 0 00-.639.528l-1.88 9.872h13.984l-1.88-9.872a.65.65 0 00-.64-.528H7.528z"></path></g></svg></span>申请转载</button><div class="Post-ActionMenuButton"><div class="Popover"><div id="Popover6-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover6-content"><button type="button" class="Button Button--plain Button--withIcon Button--iconOnly"><span style="display:inline-flex;align-items:center">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="Dots24" data-old-api="Dots" class="Zi Zi--Dots Button-zi" fill="currentColor"><path d="M5.34 12a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0zm8.325 0a1.665 1.665 0 11-3.33 0 1.665 1.665 0 013.33 0z"></path></svg></span></button></div></div></div></div></div></div></article><div class="Post-Sub Post-NormalSub"><div class="Comments-container" data-za-detail-view-path-module="CommentList" data-za-extra-module="{}"><div class="CommentsV2 CommentsV2--withEditor CommentsV2-withPagination"><div class="Topbar CommentTopbar"><div class="Topbar-title"><h2 class="CommentTopbar-title">8 条评论</h2></div><div class="Topbar-options"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="ArrowSwitch24" data-old-api="Switch" class="Zi Zi--Switch Button-zi" fill="currentColor"><path d="M18.296 8.592a.75.75 0 101.149-.964l-3.87-4.61a.747.747 0 00-1.057-.092.748.748 0 00-.268.574v17a.75.75 0 001.5 0V5.56l2.546 3.032zM9.75 20.5a.749.749 0 01-.293.595.75.75 0 01-1.097-.056l-3.87-4.613a.75.75 0 111.15-.964l2.61 3.111V3.5a.75.75 0 111.5 0v17z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>切换为时间排序</button></div></div><div class="CommentsV2-footer-wrapper"><div><div class="CommentsV2-footer CommentEditorV2--normal"><div class="CommentEditorV2-inputWrap"><div class="InputLike CommentEditorV2-input Editable"><div class="Dropzone Editable-content RichText RichText--editable RichText--clearBoth ztext" style="min-height: 198px;"><div class="DraftEditor-root"><div class="public-DraftEditorPlaceholder-root"><div class="public-DraftEditorPlaceholder-inner" id="placeholder-d7d8m" style="white-space: pre-wrap;">写下你的评论...</div></div><div class="DraftEditor-editorContainer"><div aria-describedby="placeholder-d7d8m" class="notranslate public-DraftEditor-content" contenteditable="true" role="textbox" spellcheck="true" tabindex="0" style="outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word;"><div data-contents="true"><div class="Editable-unstyled" data-block="true" data-editor="d7d8m" data-offset-key="8ec54-0-0"><div data-offset-key="8ec54-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="8ec54-0-0"><br data-text="true"></span></div></div></div></div></div></div></div><div></div><input multiple="" type="file" accept="image/webp,image/jpg,image/jpeg,image/png,image/gif" style="display: none;"></div><div class="CommentEditorV2-inputUpload"><div class="CommentEditorV2-popoverWrap"><div class="Popover ImagePopover"><button aria-label="插入图片" data-tooltip="插入图片" data-tooltip-position="bottom" data-tooltip-will-hide-on-click="true" id="Popover14-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover14-content" type="button" class="Button Editable-control Button--plain"><svg width="24" height="24" viewBox="0 0 24 24" data-new-api="ImagePlus24" data-old-api="AddImage" class="Zi Zi--AddImage" fill="currentColor"><path d="M3 5.42a2.415 2.415 0 012.415-2.416h13.17a2.415 2.415 0 012.414 2.415V11.5a.75.75 0 01-1.5 0V5.42a.915.915 0 00-.915-.916H5.415a.915.915 0 00-.915.915v7.42a.75.75 0 01-1.5 0V5.42zm12.09 8.022a5.57 5.57 0 00-3.192 1.005l-2.053 1.435a8.52 8.52 0 01-4.882 1.538H4.5v1.16c0 .506.41.916.915.916H14a.75.75 0 010 1.5H5.415A2.415 2.415 0 013 18.58v-1.356c0-.72.585-1.305 1.305-1.305h.658a7.02 7.02 0 004.023-1.267l2.052-1.435a7.07 7.07 0 014.051-1.276h.191a.75.75 0 110 1.5h-.19zM6.5 8.937a2.417 2.417 0 114.833 0 2.417 2.417 0 01-4.833 0zm2.417-.917a.917.917 0 100 1.834.917.917 0 000-1.834zM19.5 14a.75.75 0 01.75.75v2h2a.75.75 0 010 1.5h-2v2a.75.75 0 01-1.5 0v-2h-2a.75.75 0 010-1.5h2v-2a.75.75 0 01.75-.75z" fill-rule="evenodd" clip-rule="evenodd"></path></svg><svg width="21" height="14" class="css-agjc5i" fill="none"><path fill="url(#A)" stroke="#f6f6f6" d="M7.486.504a6 6 0 100 12h7a6 6 0 100-12h-7z"></path><g fill="#935d14"><path d="M8.459 9.431l2.465-5.366h-.916L8.401 7.751l-1.6-3.687h-.923L8.35 9.431h.109zm3.825 0V4.065h-.814v5.366h.814zm2.05 0V7.445h.284c.659 0 1.156-.153 1.491-.46s.502-.747.502-1.321c0-.496-.154-.887-.462-1.172s-.794-.427-1.458-.427h-1.178v5.366h.822zm.305-2.708h-.305V4.78h.378c.388 0 .664.09.829.27s.247.414.247.701c0 .268-.085.496-.254.686s-.468.285-.894.285z" fill-rule="evenodd"></path><path d="M8.459 9.431v.146h.094l.039-.085-.133-.061zm2.465-5.366l.133.061.095-.207h-.228v.146zm-.916 0v-.146h-.096l-.038.088.134.058zM8.401 7.751l-.134.058.134.309.134-.309-.134-.058zm-1.6-3.687l.134-.058-.038-.088h-.096v.146zm-.923 0v-.146h-.229l.096.208.133-.061zM8.35 9.431l-.133.061.039.085h.094v-.146zm3.934 0v.146h.146v-.146h-.146zm0-5.366h.146v-.146h-.146v.146zm-.814 0v-.146h-.146v.146h.146zm0 5.366h-.146v.146h.146v-.146zm2.865 0v.146h.146v-.146h-.146zm0-1.986v-.146h-.146v.146h.146zm-.822-3.38v-.146h-.146v.146h.146zm0 5.366h-.146v.146h.146v-.146zm.822-2.708h-.146v.146h.146v-.146zm0-1.942v-.146h-.146v.146h.146zM8.592 9.492l2.465-5.366-.266-.122L8.326 9.37l.266.122zm2.332-5.573h-.916v.293h.916v-.293zm-1.05.088L8.267 7.693l.268.117 1.607-3.687-.268-.117zM8.535 7.693l-1.6-3.687-.269.116 1.6 3.687.268-.116zM6.801 3.918h-.923v.293h.923v-.293zm-1.056.208l2.472 5.366.266-.122-2.472-5.366-.266.122zM8.35 9.577h.109v-.293H8.35v.293zm4.08-.146V4.065h-.293v5.366h.293zm-.146-5.512h-.814v.293h.814v-.293zm-.961.146v5.366h.293V4.065h-.293zm.146 5.512h.814v-.293h-.814v.293zm3.011-.146V7.445h-.293v1.986h.293zm-.146-1.839h.284v-.293h-.284v.293zm.284 0c.68 0 1.218-.158 1.589-.498l-.198-.216c-.297.273-.753.421-1.392.421v.293zm1.589-.498c.372-.341.549-.826.549-1.429h-.293c0 .545-.158.942-.454 1.214l.198.216zm.549-1.429c0-.529-.166-.962-.509-1.279l-.199.215c.272.252.415.6.415 1.064h.293zm-.509-1.279c-.347-.321-.877-.466-1.557-.466v.293c.648 0 1.09.14 1.358.388l.199-.215zM14.69 3.92h-1.178v.293h1.178V3.92zm-1.324.146v5.366h.293V4.065h-.293zm.146 5.512h.822v-.293h-.822v.293zm1.127-3.001h-.305v.293h.305v-.293zm-.159.146V4.78h-.293v1.942h.293zm-.146-1.796h.378v-.293h-.378v.293zm.378 0c.37 0 .597.087.721.223l.216-.198c-.205-.224-.532-.318-.937-.318v.293zm.721.223c.136.148.209.345.209.602h.293c0-.317-.092-.588-.286-.8l-.216.198zm.209.602a.85.85 0 01-.217.589l.218.195a1.14 1.14 0 00.292-.784h-.293zm-.217.589c-.128.143-.373.236-.785.236v.293c.441 0 .792-.097 1.003-.334l-.218-.195z"></path></g><defs><lineargradient id="A" x1="1.986" x2="19.986" y1="12.004" y2="12.004" gradientUnits="userSpaceOnUse"><stop stop-color="#f8e2c4"></stop><stop offset="1" stop-color="#f3bb6c"></stop></lineargradient></defs></svg></button></div><label class="UploadPicture-wrapper"><input type="file" accept="image/png,image/jpeg" class="UploadPicture-input"></label><div class="Popover"><div id="Popover15-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover15-content" class="css-ltqpv7"></div></div><div class="Popover"><button aria-label="插入表情" data-tooltip="插入表情" data-tooltip-position="bottom" data-tooltip-will-hide-on-click="true" id="Popover16-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover16-content" type="button" class="Button Editable-control Button--plain"><svg width="24" height="24" viewBox="0 0 24 24" data-new-api="EmoHappy24" data-old-api="Emotion" class="Zi Zi--Emotion" fill="currentColor"><path d="M12 20.5a8.5 8.5 0 100-17 8.5 8.5 0 000 17zm0 1.5c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" fill-rule="evenodd" clip-rule="evenodd"></path><path d="M10 10.25a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zm6.5 0a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0z"></path><path d="M8.712 13.807a.75.75 0 01.98.406 2.488 2.488 0 001.352 1.347 2.503 2.503 0 003.263-1.347.75.75 0 011.386.575 3.99 3.99 0 01-2.164 2.159 4.004 4.004 0 01-5.222-2.16.75.75 0 01.405-.98z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button></div></div></div></div><button type="button" disabled="" class="Button CommentEditorV2-singleButton Button--primary Button--blue">发布</button></div></div></div><div><div class="CommentListV2"><ul class="NestComment"><li class="NestComment--rootCommentNoChild"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover19-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover19-content"><a href="https://www.zhihu.com/people/xian-dan-73-52" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar UserLink-avatar" width="24" height="24" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-abed1a8c04700ba7d72b45195223e0ff_s.jpg" srcset="https://pica.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xs.jpg?source=06d4cd63 2x" alt="咸蛋"></a></div></div></span><span class="UserLink"><a href="https://www.zhihu.com/people/xian-dan-73-52" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">咸蛋</a></span><span class="CommentItemV2-time">04-11</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext css-9scqi7" options="[object Object]">对齐补码算法举例不对 对齐必须是2的幂 (15 - 1 + 10) &amp; (-10) 为16 显然是无效的</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ArrowShapeTurnLeftFill24" data-old-api="Reply" class="Zi Zi--Reply" fill="currentColor" style="margin-right: 5px;"><path d="M10.75 5.414c0-1.559-1.885-2.34-2.988-1.237l-6.585 6.585a1.75 1.75 0 000 2.475l6.585 6.586c1.103 1.103 2.988.322 2.988-1.237v-2.83c3.086.053 4.95.44 6.289 1.042 1.434.646 2.33 1.566 3.54 2.82l.037.039c.374.388.915.477 1.36.282.456-.2.76-.68.685-1.24-.286-2.162-1.287-4.77-3.31-6.845-1.919-1.968-4.723-3.422-8.601-3.588V5.414z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="transform: rotate(180deg); margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="FlagFill24" data-old-api="FlagFill24" class="ZDI ZDI--FlagFill24" fill="currentColor"><path d="M12.842 4.421c-1.86-1.24-3.957-1.408-5.798-1.025-1.827.38-3.467 1.313-4.47 2.381a.75.75 0 00-.171.732l4.44 14.546a.75.75 0 101.434-.438l-1.08-3.542c.025-.018.053-.036.083-.054.298-.184.801-.415 1.568-.523 1.386-.197 2.307.129 3.341.543l.187.075c1.005.405 2.161.872 3.791.804 1.401-.003 2.707-.45 3.67-1.015a5.217 5.217 0 001.212-.953c.284-.312.581-.752.581-1.255V5.046a.75.75 0 00-1.17-.622c-1.82 1.23-4.881 1.823-7.618-.003z"></path></svg></span> 举报</button></div></div></div></div></li></ul><ul class="NestComment"><li class="NestComment--rootCommentNoChild"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover20-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover20-content"><a href="https://www.zhihu.com/people/yu-zhi-bo-ban-3-43" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar UserLink-avatar" width="24" height="24" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-0c694ecfe22508a2aefe1a7be2faca54_s.jpg" srcset="https://pic2.zhimg.com/v2-0c694ecfe22508a2aefe1a7be2faca54_xs.jpg?source=06d4cd63 2x" alt="宇智波斑"></a></div></div></span><span class="UserLink"><a href="https://www.zhihu.com/people/yu-zhi-bo-ban-3-43" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">宇智波斑</a></span><span class="CommentItemV2-time">04-06</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext css-9scqi7" options="[object Object]">struct aligned_storage实现部分，为什么要采用union写法呢？直接写struct __declspec(align(n)) aligned_storage{ unsigned char __data[_Len];}不行吗？</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ArrowShapeTurnLeftFill24" data-old-api="Reply" class="Zi Zi--Reply" fill="currentColor" style="margin-right: 5px;"><path d="M10.75 5.414c0-1.559-1.885-2.34-2.988-1.237l-6.585 6.585a1.75 1.75 0 000 2.475l6.585 6.586c1.103 1.103 2.988.322 2.988-1.237v-2.83c3.086.053 4.95.44 6.289 1.042 1.434.646 2.33 1.566 3.54 2.82l.037.039c.374.388.915.477 1.36.282.456-.2.76-.68.685-1.24-.286-2.162-1.287-4.77-3.31-6.845-1.919-1.968-4.723-3.422-8.601-3.588V5.414z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="transform: rotate(180deg); margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="FlagFill24" data-old-api="FlagFill24" class="ZDI ZDI--FlagFill24" fill="currentColor"><path d="M12.842 4.421c-1.86-1.24-3.957-1.408-5.798-1.025-1.827.38-3.467 1.313-4.47 2.381a.75.75 0 00-.171.732l4.44 14.546a.75.75 0 101.434-.438l-1.08-3.542c.025-.018.053-.036.083-.054.298-.184.801-.415 1.568-.523 1.386-.197 2.307.129 3.341.543l.187.075c1.005.405 2.161.872 3.791.804 1.401-.003 2.707-.45 3.67-1.015a5.217 5.217 0 001.212-.953c.284-.312.581-.752.581-1.255V5.046a.75.75 0 00-1.17-.622c-1.82 1.23-4.881 1.823-7.618-.003z"></path></svg></span> 举报</button></div></div></div></div></li></ul><ul class="NestComment"><li class="NestComment--rootComment"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover21-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover21-content"><a href="https://www.zhihu.com/people/wang-ke-89-87" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar UserLink-avatar" width="24" height="24" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-fd9c78d350e9feed3bd2cea7c39ef1ce_s.jpg" srcset="https://picx.zhimg.com/v2-fd9c78d350e9feed3bd2cea7c39ef1ce_xs.jpg?source=06d4cd63 2x" alt="惘客"></a></div></div></span><span class="UserLink"><a href="https://www.zhihu.com/people/wang-ke-89-87" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">惘客</a></span><span class="CommentItemV2-time">2021-10-08</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext css-9scqi7" options="[object Object]">网络通信中常用做法: 让成员变量1字节对齐有什么优雅的做法吗？</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ArrowShapeTurnLeftFill24" data-old-api="Reply" class="Zi Zi--Reply" fill="currentColor" style="margin-right: 5px;"><path d="M10.75 5.414c0-1.559-1.885-2.34-2.988-1.237l-6.585 6.585a1.75 1.75 0 000 2.475l6.585 6.586c1.103 1.103 2.988.322 2.988-1.237v-2.83c3.086.053 4.95.44 6.289 1.042 1.434.646 2.33 1.566 3.54 2.82l.037.039c.374.388.915.477 1.36.282.456-.2.76-.68.685-1.24-.286-2.162-1.287-4.77-3.31-6.845-1.919-1.968-4.723-3.422-8.601-3.588V5.414z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="transform: rotate(180deg); margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="FlagFill24" data-old-api="FlagFill24" class="ZDI ZDI--FlagFill24" fill="currentColor"><path d="M12.842 4.421c-1.86-1.24-3.957-1.408-5.798-1.025-1.827.38-3.467 1.313-4.47 2.381a.75.75 0 00-.171.732l4.44 14.546a.75.75 0 101.434-.438l-1.08-3.542c.025-.018.053-.036.083-.054.298-.184.801-.415 1.568-.523 1.386-.197 2.307.129 3.341.543l.187.075c1.005.405 2.161.872 3.791.804 1.401-.003 2.707-.45 3.67-1.015a5.217 5.217 0 001.212-.953c.284-.312.581-.752.581-1.255V5.046a.75.75 0 00-1.17-.622c-1.82 1.23-4.881 1.823-7.618-.003z"></path></svg></span> 举报</button></div></div></div></div></li><li class="NestComment--child"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover22-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover22-content"><a href="https://www.zhihu.com/people/gin-47-16" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar UserLink-avatar" width="24" height="24" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/6892d81d7e4c3df99d292385bbb349aa_s.jpg" srcset="https://pic2.zhimg.com/6892d81d7e4c3df99d292385bbb349aa_xs.jpg?source=06d4cd63 2x" alt="Gin"></a></div></div></span><span class="UserLink"><a href="https://www.zhihu.com/people/gin-47-16" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">Gin</a><span rel="noopener noreferrer" class="css-1cd9gw4"><span style="display: inline-flex; align-items: center;">​<svg width="24" height="24" fill="none" viewBox="0 0 24 24" data-new-api="Vip24" data-old-api="VIP" class="Zi Zi--VIP css-139b4gy"><g clip-path="url(#clip0_2369_7529)"><path fill="url(#paint0_linear_2369_7529)" d="M21.351 4.858A3.115 3.115 0 0122.93 7.56v8.88a3.114 3.114 0 01-1.578 2.702l-7.774 4.44a3.184 3.184 0 01-3.154 0l-7.774-4.44a3.114 3.114 0 01-1.58-2.702V7.56c0-1.115.602-2.145 1.578-2.702l7.774-4.44a3.185 3.185 0 013.154 0l7.774 4.44zm-2.475 1.904L13.16 3.507a2.347 2.347 0 00-2.32 0L5.124 6.762a2.283 2.283 0 00-1.16 1.982v6.512c0 .817.442 1.573 1.16 1.982l5.716 3.255a2.347 2.347 0 002.32 0l5.716-3.255a2.283 2.283 0 001.16-1.982V8.744c0-.817-.442-1.573-1.16-1.982zm-9.874 4.13L12 5.76l2.998 5.131 2.466-2.12v6.343c0 .49-.4.886-.893.886H7.429a.89.89 0 01-.893-.887V8.771l2.466 2.12z"></path></g><defs><lineargradient id="paint0_linear_2369_7529" x1="3.479" x2="21.813" y1="4.463" y2="21.357" gradientUnits="userSpaceOnUse"><stop stop-color="#F2D9B6"></stop><stop offset="1" stop-color="#BF8B43"></stop></lineargradient><clippath id="clip0_2369_7529"><path fill="#fff" d="M0 0h24v24H0z"></path></clippath></defs></svg></span></span></span><span class="CommentItemV2-reply">回复</span><span class="UserLink"><a href="https://www.zhihu.com/people/wang-ke-89-87" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">惘客</a></span><span class="CommentItemV2-time">01-28</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext css-9scqi7" options="[object Object]">#pragma pack(1)</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>1</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ArrowShapeTurnLeftFill24" data-old-api="Reply" class="Zi Zi--Reply" fill="currentColor" style="margin-right: 5px;"><path d="M10.75 5.414c0-1.559-1.885-2.34-2.988-1.237l-6.585 6.585a1.75 1.75 0 000 2.475l6.585 6.586c1.103 1.103 2.988.322 2.988-1.237v-2.83c3.086.053 4.95.44 6.289 1.042 1.434.646 2.33 1.566 3.54 2.82l.037.039c.374.388.915.477 1.36.282.456-.2.76-.68.685-1.24-.286-2.162-1.287-4.77-3.31-6.845-1.919-1.968-4.723-3.422-8.601-3.588V5.414z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="transform: rotate(180deg); margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="FlagFill24" data-old-api="FlagFill24" class="ZDI ZDI--FlagFill24" fill="currentColor"><path d="M12.842 4.421c-1.86-1.24-3.957-1.408-5.798-1.025-1.827.38-3.467 1.313-4.47 2.381a.75.75 0 00-.171.732l4.44 14.546a.75.75 0 101.434-.438l-1.08-3.542c.025-.018.053-.036.083-.054.298-.184.801-.415 1.568-.523 1.386-.197 2.307.129 3.341.543l.187.075c1.005.405 2.161.872 3.791.804 1.401-.003 2.707-.45 3.67-1.015a5.217 5.217 0 001.212-.953c.284-.312.581-.752.581-1.255V5.046a.75.75 0 00-1.17-.622c-1.82 1.23-4.881 1.823-7.618-.003z"></path></svg></span> 举报</button></div></div></div></div></li><li class="NestComment--child"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover23-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover23-content"><a href="https://www.zhihu.com/people/xian-dan-73-52" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar UserLink-avatar" width="24" height="24" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-abed1a8c04700ba7d72b45195223e0ff_s(1).jpg" srcset="https://pic4.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xs.jpg?source=06d4cd63 2x" alt="咸蛋"></a></div></div></span><span class="UserLink"><a href="https://www.zhihu.com/people/xian-dan-73-52" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">咸蛋</a></span><span class="CommentItemV2-reply">回复</span><span class="UserLink"><a href="https://www.zhihu.com/people/wang-ke-89-87" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">惘客</a></span><span class="CommentItemV2-time">04-11</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext css-9scqi7" options="[object Object]">#pragma pack(push, 1)<br data-first-child="">// 需要对齐1的类<br>#pragma pack(pop)</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ArrowShapeTurnLeftFill24" data-old-api="Reply" class="Zi Zi--Reply" fill="currentColor" style="margin-right: 5px;"><path d="M10.75 5.414c0-1.559-1.885-2.34-2.988-1.237l-6.585 6.585a1.75 1.75 0 000 2.475l6.585 6.586c1.103 1.103 2.988.322 2.988-1.237v-2.83c3.086.053 4.95.44 6.289 1.042 1.434.646 2.33 1.566 3.54 2.82l.037.039c.374.388.915.477 1.36.282.456-.2.76-.68.685-1.24-.286-2.162-1.287-4.77-3.31-6.845-1.919-1.968-4.723-3.422-8.601-3.588V5.414z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="transform: rotate(180deg); margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="FlagFill24" data-old-api="FlagFill24" class="ZDI ZDI--FlagFill24" fill="currentColor"><path d="M12.842 4.421c-1.86-1.24-3.957-1.408-5.798-1.025-1.827.38-3.467 1.313-4.47 2.381a.75.75 0 00-.171.732l4.44 14.546a.75.75 0 101.434-.438l-1.08-3.542c.025-.018.053-.036.083-.054.298-.184.801-.415 1.568-.523 1.386-.197 2.307.129 3.341.543l.187.075c1.005.405 2.161.872 3.791.804 1.401-.003 2.707-.45 3.67-1.015a5.217 5.217 0 001.212-.953c.284-.312.581-.752.581-1.255V5.046a.75.75 0 00-1.17-.622c-1.82 1.23-4.881 1.823-7.618-.003z"></path></svg></span> 举报</button></div></div></div></div></li></ul><ul class="NestComment"><li class="NestComment--rootCommentNoChild"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover24-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover24-content"><a href="https://www.zhihu.com/people/baichi1212345" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar UserLink-avatar" width="24" height="24" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-b1ef1e5f7b6aa66a58c7ef9d91208293_s.jpg" srcset="https://pic4.zhimg.com/v2-b1ef1e5f7b6aa66a58c7ef9d91208293_xs.jpg?source=06d4cd63 2x" alt="我没看到你看到我"></a></div></div></span><span class="UserLink"><a href="https://www.zhihu.com/people/baichi1212345" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">我没看到你看到我</a></span><span class="CommentItemV2-time">2021-10-05</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext css-9scqi7" options="[object Object]">align取整房方法感觉。是只对2^n有效吧</div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ArrowShapeTurnLeftFill24" data-old-api="Reply" class="Zi Zi--Reply" fill="currentColor" style="margin-right: 5px;"><path d="M10.75 5.414c0-1.559-1.885-2.34-2.988-1.237l-6.585 6.585a1.75 1.75 0 000 2.475l6.585 6.586c1.103 1.103 2.988.322 2.988-1.237v-2.83c3.086.053 4.95.44 6.289 1.042 1.434.646 2.33 1.566 3.54 2.82l.037.039c.374.388.915.477 1.36.282.456-.2.76-.68.685-1.24-.286-2.162-1.287-4.77-3.31-6.845-1.919-1.968-4.723-3.422-8.601-3.588V5.414z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="transform: rotate(180deg); margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="FlagFill24" data-old-api="FlagFill24" class="ZDI ZDI--FlagFill24" fill="currentColor"><path d="M12.842 4.421c-1.86-1.24-3.957-1.408-5.798-1.025-1.827.38-3.467 1.313-4.47 2.381a.75.75 0 00-.171.732l4.44 14.546a.75.75 0 101.434-.438l-1.08-3.542c.025-.018.053-.036.083-.054.298-.184.801-.415 1.568-.523 1.386-.197 2.307.129 3.341.543l.187.075c1.005.405 2.161.872 3.791.804 1.401-.003 2.707-.45 3.67-1.015a5.217 5.217 0 001.212-.953c.284-.312.581-.752.581-1.255V5.046a.75.75 0 00-1.17-.622c-1.82 1.23-4.881 1.823-7.618-.003z"></path></svg></span> 举报</button></div></div></div></div></li></ul><ul class="NestComment"><li class="NestComment--rootComment"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover25-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover25-content"><a href="https://www.zhihu.com/people/zhangyachen" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar UserLink-avatar" width="24" height="24" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-8a6c09f54d2b954510abfa792553257b_s.jpg" srcset="https://pic1.zhimg.com/v2-8a6c09f54d2b954510abfa792553257b_xs.jpg?source=06d4cd63 2x" alt="张雅宸"></a></div></div></span><span class="UserLink"><a href="https://www.zhihu.com/people/zhangyachen" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">张雅宸</a></span><span class="CommentItemV2-time">2021-10-05</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext css-9scqi7" options="[object Object]">姿持<img data-first-child="" data-zhihu-emoticon="[赞同]" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-419a1a3ed02b7cfadc20af558aabc897.png" alt="[赞同]"></div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ArrowShapeTurnLeftFill24" data-old-api="Reply" class="Zi Zi--Reply" fill="currentColor" style="margin-right: 5px;"><path d="M10.75 5.414c0-1.559-1.885-2.34-2.988-1.237l-6.585 6.585a1.75 1.75 0 000 2.475l6.585 6.586c1.103 1.103 2.988.322 2.988-1.237v-2.83c3.086.053 4.95.44 6.289 1.042 1.434.646 2.33 1.566 3.54 2.82l.037.039c.374.388.915.477 1.36.282.456-.2.76-.68.685-1.24-.286-2.162-1.287-4.77-3.31-6.845-1.919-1.968-4.723-3.422-8.601-3.588V5.414z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="transform: rotate(180deg); margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="FlagFill24" data-old-api="FlagFill24" class="ZDI ZDI--FlagFill24" fill="currentColor"><path d="M12.842 4.421c-1.86-1.24-3.957-1.408-5.798-1.025-1.827.38-3.467 1.313-4.47 2.381a.75.75 0 00-.171.732l4.44 14.546a.75.75 0 101.434-.438l-1.08-3.542c.025-.018.053-.036.083-.054.298-.184.801-.415 1.568-.523 1.386-.197 2.307.129 3.341.543l.187.075c1.005.405 2.161.872 3.791.804 1.401-.003 2.707-.45 3.67-1.015a5.217 5.217 0 001.212-.953c.284-.312.581-.752.581-1.255V5.046a.75.75 0 00-1.17-.622c-1.82 1.23-4.881 1.823-7.618-.003z"></path></svg></span> 举报</button></div></div></div></div></li><li class="NestComment--child"><div class="CommentItemV2"><div><div class="CommentItemV2-meta"><span class="UserLink CommentItemV2-avatar"><div class="Popover"><div id="Popover26-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover26-content"><a href="https://www.zhihu.com/people/wx8bf61dc609c0aa69" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User"><img class="Avatar UserLink-avatar" width="24" height="24" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-a71366f3d114e7933a248784fce4ba9c_s.jpg" srcset="https://pic1.zhimg.com/v2-a71366f3d114e7933a248784fce4ba9c_xs.jpg?source=06d4cd63 2x" alt="fibonaccii"></a></div></div></span><span class="UserLink"><a href="https://www.zhihu.com/people/wx8bf61dc609c0aa69" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">fibonaccii</a></span><span class="CommentItemV2-roleInfo"> (作者) </span><span class="CommentItemV2-reply">回复</span><span class="UserLink"><a href="https://www.zhihu.com/people/zhangyachen" target="_blank" class="UserLink-link" data-za-detail-view-element_name="User">张雅宸</a></span><span class="CommentItemV2-time">2021-10-05</span></div><div class="CommentItemV2-metaSibling"><div class="CommentRichText CommentItemV2-content"><div class="RichText ztext css-9scqi7" options="[object Object]">感动 感谢老铁支持 <img data-first-child="" data-zhihu-emoticon="[看看你]" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-4e4870fc6e57bb76e7e5924375cb20b6.png" alt="[看看你]"><img data-zhihu-emoticon="[看看你]" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-4e4870fc6e57bb76e7e5924375cb20b6.png" alt="[看看你]"><img data-zhihu-emoticon="[看看你]" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-4e4870fc6e57bb76e7e5924375cb20b6.png" alt="[看看你]"></div></div><div class="CommentItemV2-footer"><button type="button" class="Button CommentItemV2-likeBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>赞</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ArrowShapeTurnLeftFill24" data-old-api="Reply" class="Zi Zi--Reply" fill="currentColor" style="margin-right: 5px;"><path d="M10.75 5.414c0-1.559-1.885-2.34-2.988-1.237l-6.585 6.585a1.75 1.75 0 000 2.475l6.585 6.586c1.103 1.103 2.988.322 2.988-1.237v-2.83c3.086.053 4.95.44 6.289 1.042 1.434.646 2.33 1.566 3.54 2.82l.037.039c.374.388.915.477 1.36.282.456-.2.76-.68.685-1.24-.286-2.162-1.287-4.77-3.31-6.845-1.919-1.968-4.723-3.422-8.601-3.588V5.414z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span>回复</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="16" height="16" viewBox="0 0 24 24" data-new-api="ThumbFill24" data-old-api="Like" class="Zi Zi--Like" fill="currentColor" style="transform: rotate(180deg); margin-right: 5px;"><path d="M8.5 4.078c0-1.834 1.986-2.979 3.573-2.06a4.826 4.826 0 012.379 4.71l-.114 1.022h3.581c2.53 0 4.334 2.454 3.58 4.868l-1.823 5.833a3.784 3.784 0 01-3.848 2.64c-2.372-.147-6.042-.341-8.828-.341H4.5A1.75 1.75 0 012.75 19V9.5c0-.967.784-1.75 1.75-1.75h.637a3.418 3.418 0 003.19-2.191c.115-.296.173-.611.173-.928v-.553z"></path></svg></span>踩</button><button type="button" class="Button CommentItemV2-hoverBtn Button--plain"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" data-new-api="FlagFill24" data-old-api="FlagFill24" class="ZDI ZDI--FlagFill24" fill="currentColor"><path d="M12.842 4.421c-1.86-1.24-3.957-1.408-5.798-1.025-1.827.38-3.467 1.313-4.47 2.381a.75.75 0 00-.171.732l4.44 14.546a.75.75 0 101.434-.438l-1.08-3.542c.025-.018.053-.036.083-.054.298-.184.801-.415 1.568-.523 1.386-.197 2.307.129 3.341.543l.187.075c1.005.405 2.161.872 3.791.804 1.401-.003 2.707-.45 3.67-1.015a5.217 5.217 0 001.212-.953c.284-.312.581-.752.581-1.255V5.046a.75.75 0 00-1.17-.622c-1.82 1.23-4.881 1.823-7.618-.003z"></path></svg></span> 举报</button></div></div></div></div></li></ul></div></div></div></div><div class="PostIndex-Contributions" data-za-detail-view-path-module="ColumnList" data-za-detail-view-path-module_name="文章被以下专栏收录" data-za-extra-module="{}"><h3 class="BlockTitle">文章被以下专栏收录</h3><ul><div class="ContentItem Column-ColumnItem"><div class="ContentItem-main"><div class="ContentItem-image"><a class="ColumnLink" href="https://www.zhihu.com/column/c_1344587700045914112"><div class="Popover"><div id="Popover7-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover7-content"><img class="Avatar Avatar--medium Avatar--round" width="40" height="40" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/4b70deef7_xs.jpg" srcset="https://pica.zhimg.com/4b70deef7_l.jpg?source=172ae18b 2x" alt="深入了解Modern C++"></div></div></a></div><div class="ContentItem-head"><h2 class="ContentItem-title"><span><a class="ColumnLink ColumnItem-Title" href="https://www.zhihu.com/column/c_1344587700045914112"><div class="Popover"><div id="Popover8-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="Popover8-content">深入了解Modern C++</div></div></a></span></h2><div class="ContentItem-meta">更好、更安全地使用Modern C++</div></div></div></div></ul></div><div role="complementary" aria-label="推荐阅读" class="Recommendations-Main" style="width: 1905px;"><h3 class="BlockTitle Recommendations-BlockTitle">推荐阅读</h3><ul class="Recommendations-List"><button class="PagingButton PagingButton-Previous" disabled="" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg width="40" height="40" viewBox="0 0 24 24" data-new-api="ArrowLeftSmall24" data-old-api="ArrowLeft" fill="#d3d3d3" class="Zi Zi--ArrowLeft"><path d="M10.752 12l4.025-3.78a.684.684 0 000-1.01.796.796 0 00-1.075 0l-4.42 4.15a.866.866 0 000 1.28l4.42 4.15a.796.796 0 001.075 0 .684.684 0 000-1.01L10.752 12z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button><a href="https://zhuanlan.zhihu.com/p/402251966" class="PostItem"><div><img src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/v2-1bc66b075acb68438e160ec77134b2e4_250x0.jpg" srcset="https://pic3.zhimg.com/v2-1bc66b075acb68438e160ec77134b2e4_qhd.jpg?source=172ae18b 2x" class="PostItem-TitleImage" alt="谈谈C++的左值右值，左右引用，移动语意及完美转发"><h1 class="PostItem-Title">谈谈C++的左值右值，左右引用，移动语意及完美转发</h1><div class="PostItem-Footer"><span>rayhu...</span><span class="PostItem-FooterTitle">发表于C/C++...</span></div></div></a><a href="https://zhuanlan.zhihu.com/p/419672503" class="PostItem"><div><h1 class="PostItem-Title">c++11新特性所有知识点</h1><p class="PostItem-Summary">部分代码案例关键字新增关键字thread_localstatic_assertnullptrnoexceptdecltypeconstexprchar16_tchar32_talignofalignas含义变化或者新增含义关键字（meaning changed or new meaning ad…</p><div class="PostItem-Footer"><span>程序员编程指南</span><span class="PostItem-FooterTitle"></span></div></div></a><a href="https://zhuanlan.zhihu.com/p/349784961" class="PostItem"><div><h1 class="PostItem-Title">C++20 新特性: ranges 纳入标准库</h1><p class="PostItem-Summary">本文写于 2021 年 2 月 7 日. 这个库早在 C++14 的时候已经有了实现, 在 C++20 的时候被纳入了标准库, 在头文件 &amp;lt;ranges&amp;gt; 之中. 这是一种全新的设计语言. 这篇文章主要介绍怎么使用, …</p><div class="PostItem-Footer"><span>孙孟越</span><span class="PostItem-FooterTitle">发表于smy的笔...</span></div></div></a><a href="https://zhuanlan.zhihu.com/p/348365662" class="PostItem"><div><h1 class="PostItem-Title">C++ 标准库开洞史</h1><p class="PostItem-Summary">（知乎这 markdown 支持真的吐了，似乎不支持嵌套的缩进） 标准库的开洞，大致分为几种： 与 core languange 规范扯在一起的，这种一般是用户无法自行实现的。例如著名的 std::type_info（s…</p><div class="PostItem-Footer"><span>刘雨培</span><span class="PostItem-FooterTitle">发表于12k 讨...</span></div></div></a><button class="PagingButton PagingButton-Next" data-za-detail-view-path-module="Unknown" data-za-detail-view-path-module_name="推荐阅读" data-za-extra-module="{}"><svg width="40" height="40" viewBox="0 0 24 24" data-new-api="ArrowRightSmall24" data-old-api="ArrowRight" fill="#d3d3d3" class="Zi Zi--ArrowRight"><path d="M13.248 12l-4.025 3.78a.684.684 0 000 1.01.796.796 0 001.075 0l4.42-4.15a.867.867 0 000-1.28l-4.42-4.15a.796.796 0 00-1.075 0 .684.684 0 000 1.01L13.248 12z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button></ul></div></div></div></main><div role="complementary"><div class="CornerButtons"><div class="CornerAnimayedFlex"><button data-tooltip="回到顶部" data-tooltip-position="left" data-tooltip-will-hide-on-click="true" aria-label="回到顶部" type="button" class="Button CornerButton Button--plain"><svg width="24" height="24" viewBox="0 0 24 24" data-new-api="ArrowShapeUpwardFill24" data-old-api="BackToTop" aria-label="回到顶部" class="Zi Zi--BackToTop" fill="currentColor"><path d="M13.204 3.107a1.75 1.75 0 00-2.408 0L3.806 9.73c-1.148 1.088-.378 3.02 1.204 3.02h2.24V20c0 .966.784 1.75 1.75 1.75h6A1.75 1.75 0 0016.75 20v-7.25h2.24c1.582 0 2.353-1.932 1.204-3.02l-6.99-6.623z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button></div></div></div></div></div><script id="js-clientConfig" type="text/json">{"fetchRoot":{"www":"https:\u002F\u002Fwww.zhihu.com","api":"https:\u002F\u002Fapi.zhihu.com","lens":"https:\u002F\u002Flens.zhihu.com","zhuanlan":"https:\u002F\u002Fzhuanlan.zhihu.com","walletpay":"https:\u002F\u002Fwalletpay.zhihu.com","captcha":"https:\u002F\u002Fcaptcha.zhihu.com","vzuu":"https:\u002F\u002Fv.vzuu.com","openapi":"https:\u002F\u002Fopenapi.zhihu.com","svip":"https:\u002F\u002Fsvip.zhihu.com"},"host":"zhihu.com","protocol":"https:","wwwHost":"www.zhihu.com","videoHost":"video.zhihu.com","allowSignUp":true}</script><script id="js-initialData" type="text/json">{"initialState":{"common":{"ask":{}},"loading":{"global":{"count":0},"local":{"env\u002FgetIpinfo\u002F":false,"article\u002Fget\u002F":false,"brand\u002FgetUrl\u002F":false,"article\u002FloadPostSearchEntity\u002F":false}},"club":{"tags":{},"admins":{"data":[]},"members":{"data":[]},"explore":{"candidateSyncClubs":{}},"profile":{},"checkin":{},"comments":{"paging":{},"loading":{},"meta":{},"ids":{}},"postList":{"paging":{},"loading":{},"ids":{}},"recommend":{"data":[]},"silences":{"data":[]},"application":{"profile":null}},"entities":{"users":{"c29982ea4958b35f1d733b99ef5bf579":{"uid":1454038455692562400,"userType":"people","id":"c29982ea4958b35f1d733b99ef5bf579"},"wx8bf61dc609c0aa69":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a71366f3d114e7933a248784fce4ba9c.jpg?source=172ae18b","uid":"987058110737039360","userType":"people","isFollowing":false,"urlToken":"wx8bf61dc609c0aa69","id":"64d408c30111fc3e37486786f5b50ad8","description":"人生苦短，我选C++","name":"fibonaccii","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002F64d408c30111fc3e37486786f5b50ad8","avatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-a71366f3d114e7933a248784fce4ba9c_l.jpg?source=172ae18b","isOrg":false,"type":"people","badge":[{"type":"identity","topics":[],"description":"百度 C++后端工程师"}],"badgeV2":{"title":"百度 C++后端工程师","mergedBadges":[{"type":"identity","detailType":"identity","title":"认证","description":"百度 C++后端工程师","url":"https:\u002F\u002Fwww.zhihu.com\u002Faccount\u002Fverification\u002Fintro","sources":[],"icon":"","nightIcon":""}],"detailBadges":[{"type":"identity","detailType":"identity_people","title":"已认证的个人","description":"百度 C++后端工程师","url":"https:\u002F\u002Fwww.zhihu.com\u002Faccount\u002Fverification\u002Fintro","sources":[],"icon":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-235258cecb8a0f184c4d38483cd6f6b6_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-45e870b8f0982bcd7537ea4627afbd00_l.png?source=32738c0c"}],"icon":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-235258cecb8a0f184c4d38483cd6f6b6_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-45e870b8f0982bcd7537ea4627afbd00_l.png?source=32738c0c"},"exposedMedal":{"medalId":"972481762269622272","medalName":"笔耕不辍","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-288c7ef30025f4cd0862fb187d74914c_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-288c7ef30025f4cd0862fb187d74914c_l.png?source=172ae18b","description":"连续答题 5 天","medalAvatarFrame":""}}},"questions":{},"answers":{},"articles":{"417061548":{"trackUrl":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper\u002Fcontent_monitor_log?si=__SESSIONID__&ti=__ATOKEN__&at=view&pf=__OS__&ed=BiBUKF0xBSkqGGpfBWh6CVx3AAGOF_uGOiPJ&idfa=__IDFA__&imei=__IMEI__&androidid=__ANDROIDID__&oaid=__OAID__&ci=__CREATIVEID__&zid=__ZONEID__"],"entityWords":[{"name":"sizoef","mention":"sizoef","matchorder":3,"begin":1154,"end":1160,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"OtherTerm","score":0.0029817819595336914,"attachedInfoBytes":"sgJTCgZzaXpvZWYSCU90aGVyVGVybRiCCSCICSgDNQBqQzs6B2FydGljbGVAAEgAUiQ0YjEzZWI0YS0zMDMxLTQ1ODItOGQ1Mi00ZTk4MGUyN2FlMTY=","isOnAB":false,"isNatural":1},{"name":"静态数组","mention":"静态数组","matchorder":1,"begin":20454,"end":20458,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0065364837646484375,"attachedInfoBytes":"sgJWCgzpnZnmgIHmlbDnu4QSBE1hdGgY5p8BIOqfASgBNQAw1js6B2FydGljbGVAAEgAUiQ0YjEzZWI0YS0zMDMxLTQ1ODItOGQ1Mi00ZTk4MGUyN2FlMTY=","isOnAB":false,"isNatural":1},{"name":"10进制","mention":"10进制","matchorder":1,"begin":50544,"end":50548,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0035997331142425537,"attachedInfoBytes":"sgJSCggxMOi\u002Fm+WIthIETWF0aBjwigMg9IoDKAE1gOlrOzoHYXJ0aWNsZUAASABSJDRiMTNlYjRhLTMwMzEtNDU4Mi04ZDUyLTRlOTgwZTI3YWUxNg==","isOnAB":false,"isNatural":1},{"name":"static_assert","mention":"static_assert","matchorder":1,"begin":1740,"end":1753,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJVCg1zdGF0aWNfYXNzZXJ0EgRNYXRoGMwNINkNKAE1AMpcOjoHYXJ0aWNsZUAASABSJDRiMTNlYjRhLTMwMzEtNDU4Mi04ZDUyLTRlOTgwZTI3YWUxNg==","isOnAB":false,"isNatural":1},{"name":"正数幂","mention":"正数幂","matchorder":1,"begin":16892,"end":16895,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJTCgnmraPmlbDluYISBE1hdGgY\u002FIMBIP+DASgBNQDKXDo6B2FydGljbGVAAEgAUiQ0YjEzZWI0YS0zMDMxLTQ1ODItOGQ1Mi00ZTk4MGUyN2FlMTY=","isOnAB":false,"isNatural":1},{"name":"align函数","mention":"align函数","matchorder":1,"begin":7426,"end":7433,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJTCgthbGlnbuWHveaVsBIETWF0aBiCOiCJOigBNQDKXDo6B2FydGljbGVAAEgAUiQ0YjEzZWI0YS0zMDMxLTQ1ODItOGQ1Mi00ZTk4MGUyN2FlMTY=","isOnAB":false,"isNatural":1},{"name":"函数","mention":"函数","matchorder":1,"begin":893,"end":895,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0025189220905303955,"attachedInfoBytes":"sgJOCgblh73mlbASBE1hdGgY\u002FQYg\u002FwYoATWAFCU7OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"代码","mention":"代码","matchorder":1,"begin":9390,"end":9392,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0023469626903533936,"attachedInfoBytes":"sgJOCgbku6PnoIESBE1hdGgYrkkgsEkoATWAzxk7OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"struct alignas","mention":"struct alignas","matchorder":8,"begin":31616,"end":31630,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJYCg5zdHJ1Y3QgYWxpZ25hcxIETWF0aBiA9wEgjvcBKAg1AMpcOjoHYXJ0aWNsZUAASABSJDRiMTNlYjRhLTMwMzEtNDU4Mi04ZDUyLTRlOTgwZTI3YWUxNg==","isOnAB":false,"isNatural":1},{"name":"整倍数","mention":"整倍数","matchorder":1,"begin":12677,"end":12680,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0029514729976654053,"attachedInfoBytes":"sgJRCgnmlbTlgI3mlbASBE1hdGgYhWMgiGMoATWAbUE7OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"sizoef(T)值","mention":"sizoef(T)值","matchorder":1,"begin":604,"end":614,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJUCgxzaXpvZWYoVCnlgLwSBE1hdGgY3AQg5gQoATUAylw6OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"int i2","mention":"int i2","matchorder":2,"begin":2807,"end":2813,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJOCgZpbnQgaTISBE1hdGgY9xUg\u002FRUoAjUAylw6OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"取余","mention":"取余","matchorder":2,"begin":1236,"end":1238,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.008254587650299072,"attachedInfoBytes":"sgJOCgblj5bkvZkSBE1hdGgY1Akg1gkoAjVAPgc8OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"缓冲区","mention":"缓冲区","matchorder":1,"begin":39196,"end":39199,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0.003798574209213257,"attachedInfoBytes":"sgJXCgnnvJPlhrLljLoSCENvbXB1dGVyGJyyAiCfsgIoATWA8Xg7OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"alignof(T","mention":"alignof(T","matchorder":2,"begin":5043,"end":5052,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJRCglhbGlnbm9mKFQSBE1hdGgYsycgvCcoAjUAylw6OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"类StaticVector","mention":"类StaticVector","matchorder":1,"begin":5285,"end":5298,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"OtherTerm","score":0.0008422434329986572,"attachedInfoBytes":"sgJcCg\u002FnsbtTdGF0aWNWZWN0b3ISCU90aGVyVGVybRilKSCyKSgBNQDKXDo6B2FydGljbGVAAEgAUiQ0YjEzZWI0YS0zMDMxLTQ1ODItOGQ1Mi00ZTk4MGUyN2FlMTY=","isOnAB":false,"isNatural":1},{"name":"扩展指令","mention":"扩展指令","matchorder":1,"begin":12928,"end":12932,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"OtherTerm","score":0.00627472996711731,"attachedInfoBytes":"sgJZCgzmianlsZXmjIfku6QSCU90aGVyVGVybRiAZSCEZSgBNUCczTs6B2FydGljbGVAAEgAUiQ0YjEzZWI0YS0zMDMxLTQ1ODItOGQ1Mi00ZTk4MGUyN2FlMTY=","isOnAB":false,"isNatural":1},{"name":"sizeof(c","mention":"sizeof(c","matchorder":1,"begin":713,"end":721,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJQCghzaXplb2YoYxIETWF0aBjJBSDRBSgBNQDKXDo6B2FydGljbGVAAEgAUiQ0YjEzZWI0YS0zMDMxLTQ1ODItOGQ1Mi00ZTk4MGUyN2FlMTY=","isOnAB":false,"isNatural":1},{"name":"nullptr return nullptr","mention":"nullptr return nullptr","matchorder":1,"begin":8402,"end":8424,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJeChZudWxscHRyIHJldHVybiBudWxscHRyEgRNYXRoGNJBIOhBKAE1AMpcOjoHYXJ0aWNsZUAASABSJDRiMTNlYjRhLTMwMzEtNDU4Mi04ZDUyLTRlOTgwZTI3YWUxNg==","isOnAB":false,"isNatural":1},{"name":"gcc","mention":"gcc","matchorder":2,"begin":4217,"end":4220,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Food","score":0.006280720233917236,"attachedInfoBytes":"sgJLCgNnY2MSBEZvb2QY+SAg\u002FCAoAjWAzs07OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"main sizeof","mention":"main sizeof","matchorder":2,"begin":1971,"end":1982,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJTCgttYWluIHNpemVvZhIETWF0aBizDyC+DygCNQDKXDo6B2FydGljbGVAAEgAUiQ0YjEzZWI0YS0zMDMxLTQ1ODItOGQ1Mi00ZTk4MGUyN2FlMTY=","isOnAB":false,"isNatural":1},{"name":"起始地址","mention":"起始地址","matchorder":2,"begin":9081,"end":9085,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0.012071222066879272,"attachedInfoBytes":"sgJYCgzotbflp4vlnLDlnYASCENvbXB1dGVyGPlGIP1GKAI1YMZFPDoHYXJ0aWNsZUAASABSJDRiMTNlYjRhLTMwMzEtNDU4Mi04ZDUyLTRlOTgwZTI3YWUxNg==","isOnAB":false,"isNatural":1},{"name":"成员变量","mention":"成员变量","matchorder":1,"begin":9074,"end":9078,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.009877890348434448,"attachedInfoBytes":"sgJUCgzmiJDlkZjlj5jph48SBE1hdGgY8kYg9kYoATXg1iE8OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"align_stroe.cc","mention":"align_stroe.cc","matchorder":2,"begin":28694,"end":28708,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Medical","score":0.0008422434329986572,"attachedInfoBytes":"sgJbCg5hbGlnbl9zdHJvZS5jYxIHTWVkaWNhbBiW4AEgpOABKAI1AMpcOjoHYXJ0aWNsZUAASABSJDRiMTNlYjRhLTMwMzEtNDU4Mi04ZDUyLTRlOTgwZTI3YWUxNg==","isOnAB":false,"isNatural":1},{"name":"类std::aligned_storage","mention":"类std::aligned_storage","matchorder":4,"begin":7296,"end":7317,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Computer","score":0.0008422434329986572,"attachedInfoBytes":"sgJjChfnsbtzdGQ6OmFsaWduZWRfc3RvcmFnZRIIQ29tcHV0ZXIYgDkglTkoBDUAylw6OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"余数1","mention":"余数1","matchorder":1,"begin":50675,"end":50678,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.0008422434329986572,"attachedInfoBytes":"sgJRCgfkvZnmlbAxEgRNYXRoGPOLAyD2iwMoATUAylw6OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"int类型变量","mention":"int类型变量","matchorder":1,"begin":1191,"end":1198,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Math","score":0.004666328430175781,"attachedInfoBytes":"sgJXCg9pbnTnsbvlnovlj5jph48SBE1hdGgYpwkgrgkoATUA6Jg7OgdhcnRpY2xlQABIAFIkNGIxM2ViNGEtMzAzMS00NTgyLThkNTItNGU5ODBlMjdhZTE2","isOnAB":false,"isNatural":1},{"name":"0x16b5734e0","mention":"0x16b5734e0","matchorder":1,"begin":28771,"end":28782,"entityid":0,"isBookMark":false,"link":{"linkType":0,"linkUrl":"","docType":"","topicToken":""},"entityClass":"Medical","score":0.0008422434329986572,"attachedInfoBytes":"sgJYCgsweDE2YjU3MzRlMBIHTWVkaWNhbBjj4AEg7uABKAE1AMpcOjoHYXJ0aWNsZUAASABSJDRiMTNlYjRhLTMwMzEtNDU4Mi04ZDUyLTRlOTgwZTI3YWUxNg==","isOnAB":false,"isNatural":1}],"id":417061548,"title":"深入了解 | 内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析","type":"article","articleType":"normal","excerptTitle":"","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F417061548","imageUrl":"","titleImage":"","excerpt":"本文首发于个人技术号： \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmp.weixin.qq.com\u002Fs%3F__biz%3DMzkyMjIxMzIxNA%3D%3D%26mid%3D2247487875%26idx%3D1%26sn%3Dba5c5d9460c8601b9af9958a4de50a3d%26chksm%3Dc1f69fb2f68116a495efbd3d1b4e3cc0df36884e6c4917f0527ce0b4002ef84c1845548a7617%26token%3D448078940%26lang%3Dzh_CN%23rd\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-3b5c9593dccbf88852d6faf340d58bf0_180x120.jpg\" data-image-width=\"1080\" data-image-height=\"459\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E深入了解C++(15) | 内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析\u003C\u002Fa\u003E关于内存对齐，有诸多好处，因此常常在分配内存时也会将内存对齐这一因素纳入考量。 这一节，来讲下内存对齐以及C++11中关于内存对齐引入的 align…","created":1633367026,"updated":1633367026,"author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a71366f3d114e7933a248784fce4ba9c.jpg?source=172ae18b","uid":"987058110737039360","userType":"people","isFollowing":false,"urlToken":"wx8bf61dc609c0aa69","id":"64d408c30111fc3e37486786f5b50ad8","description":"人生苦短，我选C++","name":"fibonaccii","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002F64d408c30111fc3e37486786f5b50ad8","avatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-a71366f3d114e7933a248784fce4ba9c_l.jpg?source=172ae18b","isOrg":false,"type":"people","badge":[{"type":"identity","topics":[],"description":"百度 C++后端工程师"}],"badgeV2":{"title":"百度 C++后端工程师","mergedBadges":[{"type":"identity","detailType":"identity","title":"认证","description":"百度 C++后端工程师","url":"https:\u002F\u002Fwww.zhihu.com\u002Faccount\u002Fverification\u002Fintro","sources":[],"icon":"","nightIcon":""}],"detailBadges":[{"type":"identity","detailType":"identity_people","title":"已认证的个人","description":"百度 C++后端工程师","url":"https:\u002F\u002Fwww.zhihu.com\u002Faccount\u002Fverification\u002Fintro","sources":[],"icon":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-235258cecb8a0f184c4d38483cd6f6b6_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-45e870b8f0982bcd7537ea4627afbd00_l.png?source=32738c0c"}],"icon":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-235258cecb8a0f184c4d38483cd6f6b6_l.png?source=32738c0c","nightIcon":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-45e870b8f0982bcd7537ea4627afbd00_l.png?source=32738c0c"},"exposedMedal":{"medalId":"972481762269622272","medalName":"笔耕不辍","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-288c7ef30025f4cd0862fb187d74914c_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-288c7ef30025f4cd0862fb187d74914c_l.png?source=172ae18b","description":"连续答题 5 天","medalAvatarFrame":""}},"commentPermission":"all","copyrightPermission":"need_review","state":"published","ipInfo":"","imageWidth":0,"imageHeight":0,"content":"\u003Cp data-pid=\"X1LCxWD0\"\u003E本文首发于个人技术号：\u003C\u002Fp\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fmp.weixin.qq.com\u002Fs%3F__biz%3DMzkyMjIxMzIxNA%3D%3D%26mid%3D2247487875%26idx%3D1%26sn%3Dba5c5d9460c8601b9af9958a4de50a3d%26chksm%3Dc1f69fb2f68116a495efbd3d1b4e3cc0df36884e6c4917f0527ce0b4002ef84c1845548a7617%26token%3D448078940%26lang%3Dzh_CN%23rd\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-3b5c9593dccbf88852d6faf340d58bf0_180x120.jpg\" data-image-width=\"1080\" data-image-height=\"459\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E深入了解C++(15) |  内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析\u003C\u002Fa\u003E\u003Chr\u002F\u003E\u003Cp data-pid=\"9p6rf6Gb\"\u003E关于内存对齐，有诸多好处，因此常常在分配内存时也会将内存对齐这一因素纳入考量。\u003C\u002Fp\u003E\u003Cp data-pid=\"VcC8EOrv\"\u003E这一节，来讲下内存对齐以及C++11中关于内存对齐引入的\u003Ccode\u003Ealignof\u003C\u002Fcode\u003E、\u003Ccode\u003Ealignas\u003C\u002Fcode\u003E、\u003Ccode\u003Estd::aligned_storage\u003C\u002Fcode\u003E、\u003Ccode\u003Estd::align\u003C\u002Fcode\u003E ，其中前两个为关键字，后两个分别为类和函数。\u003C\u002Fp\u003E\u003Ch2\u003Ealignment\u003C\u002Fh2\u003E\u003Cp data-pid=\"UtO5ADiC\"\u003E我们知道，C++中的内置的基础类型，比如\u003Ccode\u003Echar\u003C\u002Fcode\u003E、\u003Ccode\u003Eint\u003C\u002Fcode\u003E、\u003Ccode\u003Efloat\u003C\u002Fcode\u003E、\u003Ccode\u003Edouble\u003C\u002Fcode\u003E，在内存布局上都是按照其 \u003Ccode\u003Esizeof\u003C\u002Fcode\u003E 大小进行对齐（alignment）。\u003C\u002Fp\u003E\u003Cp data-pid=\"CDm00foP\"\u003E什么叫对齐？\u003C\u002Fp\u003E\u003Cp data-pid=\"lwcX6Ety\"\u003E比如，\u003Ccode\u003Esizoef(int)\u003C\u002Fcode\u003E 值为 4，如果满足内存对齐要求，那么int类型变量\u003Ccode\u003Ea\u003C\u002Fcode\u003E的地址\u003Ccode\u003E&amp;a\u003C\u002Fcode\u003E对4取余的结果应该是0。\u003C\u002Fp\u003E\u003Cp data-pid=\"tVv0qPDQ\"\u003E下面提供一个编译期就能检测内存对齐的宏 \u003Ccode\u003ECHECK_ALIGN\u003C\u002Fcode\u003E：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cp\"\u003E#define CHECK_ALIGN(ptr, alignment)                       \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E  do{                                                     \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E    constexpr size_t status                               \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E       = reinterpret_cast&lt;uintptr_t&gt;(ptr) % alignment;    \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E    static_assert(status == 0, &#34;ptr must be aligned&#34;);    \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E  }while(0)                                               \\\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"kLoI1djU\"\u003E下面我们来校验内置类型的内存对齐大小确实等于其\u003Ccode\u003Esizoef(T)\u003C\u002Fcode\u003E值，demo如下。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[])\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Elong\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ECHECK_ALIGN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ECHECK_ALIGN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ECHECK_ALIGN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ECHECK_ALIGN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ECHECK_ALIGN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E \u003Cspan class=\"c1\"\u003E\u002F\u002F 编译错误\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"ugyy6wdT\"\u003E上述demo中的 \u003Ccode\u003ECHECK_ALIGN(&amp;i, sizeof(l));\u003C\u002Fcode\u003E 会导致编译错误，因为\u003Ccode\u003Eint\u003C\u002Fcode\u003E类型变量的内存对齐大小要求是4，而\u003Ccode\u003Elong\u003C\u002Fcode\u003E在gcc下是8个字节，即\u003Ccode\u003Esizoef(l)\u003C\u002Fcode\u003E为8，故而编译失败。\u003C\u002Fp\u003E\u003Cp data-pid=\"AY8bvaMy\"\u003E到此，我相信你应该明白何为「内存对齐」了。\u003C\u002Fp\u003E\u003Ch2\u003Ealignof\u003C\u002Fh2\u003E\u003Cp data-pid=\"_mZF20XU\"\u003EC++11引入的关键字\u003Ccode\u003Ealignof\u003C\u002Fcode\u003E，可直接获取类型\u003Ccode\u003ET\u003C\u002Fcode\u003E的内存对齐要求。\u003Ccode\u003Ealignof\u003C\u002Fcode\u003E的返回值类型是\u003Ccode\u003Esize_t\u003C\u002Fcode\u003E，用法类似于\u003Ccode\u003Esizeof\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cp data-pid=\"4tT7e1EZ\"\u003E下面先来看看\u003Ccode\u003Ealignof\u003C\u002Fcode\u003E的用法。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cp\"\u003E#define SHOW_SIZEOF_AND_ALIGNOF(T)                                   \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E  do {                                                               \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E    std::cout &lt;&lt; &#34;sizeof(&#34; &lt;&lt; #T &lt;&lt; &#34;):\\t&#34; &lt;&lt; sizeof(T) &lt;&lt; &#34;,\\t&#34;     \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E              &lt;&lt; &#34;alignof(&#34; &lt;&lt; #T &lt;&lt; &#34;):\\t&#34; &lt;&lt; alignof(T)            \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E              &lt;&lt; std::endl;                                          \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E  }while(0)\n\u003C\u002Fspan\u003E\u003Cspan class=\"cp\"\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[])\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ESHOW_SIZEOF_AND_ALIGNOF\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ESHOW_SIZEOF_AND_ALIGNOF\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ESHOW_SIZEOF_AND_ALIGNOF\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Elong\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ESHOW_SIZEOF_AND_ALIGNOF\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Efloat\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ESHOW_SIZEOF_AND_ALIGNOF\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Edouble\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"FHo2gtPH\"\u003E输出如下，这也是符合前文关于基础类型内存对齐的论述。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003E$ g++ main.cc -o main \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E .\u002Fmain\nsizeof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003Echar\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:   1,      alignof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003Echar\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:  \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E\nsizeof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003Eint\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:    4,      alignof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003Eint\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:   \u003Cspan class=\"m\"\u003E4\u003C\u002Fspan\u003E\nsizeof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003Elong\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:   8,      alignof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003Elong\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:  \u003Cspan class=\"m\"\u003E8\u003C\u002Fspan\u003E\nsizeof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003Efloat\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:  4,      alignof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003Efloat\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E: \u003Cspan class=\"m\"\u003E4\u003C\u002Fspan\u003E\nsizeof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003Edouble\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E: 8,      alignof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003Edouble\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:8\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"-8Nd_F6r\"\u003E好，到此我相信你已经对内存对齐和\u003Ccode\u003Ealignof\u003C\u002Fcode\u003E有了基本了解。下面我们来看看类的内存对齐。\u003C\u002Fp\u003E\u003Cp data-pid=\"qWmh-fNK\"\u003E现在有类\u003Ccode\u003EFoo\u003C\u002Fcode\u003E：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EFoo\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n  \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Elong\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"nkhP5FDC\"\u003E考虑下\u003Ccode\u003Ealignof(Foo)\u003C\u002Fcode\u003E和\u003Ccode\u003Esizeof(Foo)\u003C\u002Fcode\u003E分别会是多少，即下面的demo会输出？？？\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[])\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ESHOW_SIZEOF_AND_ALIGNOF\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"FNIjaCSW\"\u003EThink Again~~~~\u003C\u002Fp\u003E\u003Cp data-pid=\"DuTNmqxz\"\u003E3\u003C\u002Fp\u003E\u003Cp data-pid=\"d6jVH97P\"\u003E2\u003C\u002Fp\u003E\u003Cp data-pid=\"3g_IYyU-\"\u003E1\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003E$ g++ main.cc -o main \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E .\u002Fmain\nsizeof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003EFoo\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:    24,     alignof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003EFoo\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:   \u003Cspan class=\"m\"\u003E8\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"7juMJNnG\"\u003E嗯？怎么会是这个结果？\u003C\u002Fp\u003E\u003Cp data-pid=\"AjDHRisw\"\u003E为了更好地解释这个结果，我准备借助\u003Ccode\u003Eoffsetof\u003C\u002Fcode\u003E函数，来获取成员变量距离类起始地址的偏移量，其函数原型如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"cm\"\u003E\u002F* Offset of member MEMBER in a struct of type TYPE. *\u002F\u003C\u002Fspan\u003E\n\u003Cspan class=\"cp\"\u003E#define offsetof(OBJECT_TYPE, MEMBER) __builtin_offsetof (OBJECT_TYPE, MEMBER)\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"LPv5N8Qp\"\u003E好，现在看下如下代码，并猜测下输出？\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[])\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eoffsetof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E  \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eoffsetof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E \n            \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eoffsetof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eoffsetof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E  \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"UdKR15G4\"\u003E输出如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003E$ g++ main.cc -o main \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E .\u002Fmain\n\u003Cspan class=\"m\"\u003E0\u003C\u002Fspan\u003E   \u003Cspan class=\"c1\"\u003E# c 的偏移量为 0 \u003C\u002Fspan\u003E\n\u003Cspan class=\"m\"\u003E4\u003C\u002Fspan\u003E   \u003Cspan class=\"c1\"\u003E# i1 的偏移量为 4， c  -&gt; i1 中间填充了 3个字节，才满足 4 字节的内存对齐要求\u003C\u002Fspan\u003E\n\u003Cspan class=\"m\"\u003E8\u003C\u002Fspan\u003E   \u003Cspan class=\"c1\"\u003E# i2 的偏移量为 8,  i1 -&gt; i2 无填充\u003C\u002Fspan\u003E\n\u003Cspan class=\"m\"\u003E16\u003C\u002Fspan\u003E  \u003Cspan class=\"c1\"\u003E# l 的偏移量为 16， i2 -&gt; l  中间填充了4个字节，才满足8字节的内存对齐要求\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"DIYVEmrH\"\u003E好，到此，我准备基于这个输出来解释\u003Ccode\u003Ealignof\u003C\u002Fcode\u003E了。\u003C\u002Fp\u003E\u003Cp data-pid=\"9ANLWSn-\"\u003E对于\u003Ccode\u003EFoo\u003C\u002Fcode\u003E而言，所谓内存对齐，即\u003Ccode\u003EFoo\u003C\u002Fcode\u003E中每个字段都要满足内存对齐。而内存对齐最严格（即对齐字节数最大）的字段满足了，其他的字段也就满足了。\u003C\u002Fp\u003E\u003Cp data-pid=\"PTnksHSP\"\u003E假设现在有三个起始地址，分别是 0、1、4，我们来看看是否都能满足\u003Ccode\u003EFoo\u003C\u002Fcode\u003E中所有字段的内存对齐要求。\u003C\u002Fp\u003E\u003Cp data-pid=\"yPI1ortp\"\u003E起始地址分别0、1、4，各个字段的地址如下三列。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EFoo\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E   \n  \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E     \u003Cspan class=\"c1\"\u003E\u002F\u002F 0  |  1  |  4\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E     \u003Cspan class=\"c1\"\u003E\u002F\u002F 4  |  5  |  8\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E     \u003Cspan class=\"c1\"\u003E\u002F\u002F 8  |  9  |  12 \n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"kt\"\u003Elong\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E     \u003Cspan class=\"c1\"\u003E\u002F\u002F 16 |  17 |  20\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"ibAuynLd\"\u003E从上面的右侧三列结果可以看出，只有起始地址为0（8的整倍数）的恰好能满足所有字段内存对齐的要求。因此，\u003Ccode\u003Ealignof(Foo)\u003C\u002Fcode\u003E输出为8。\u003C\u002Fp\u003E\u003Ch2\u003Ealignas\u003C\u002Fh2\u003E\u003Cp data-pid=\"aTMe3nx0\"\u003E上面讲述的内存对齐要求都是默认情况下的，有时候考虑到cacheline、以及向量化操作，可能会需要改变一个类的\u003Ccode\u003Ealignof\u003C\u002Fcode\u003E值。\u003C\u002Fp\u003E\u003Cp data-pid=\"YLYgBlXm\"\u003E怎么办？\u003C\u002Fp\u003E\u003Cp data-pid=\"dWRWu1B_\"\u003E在C++11之前，需要依赖靠编译器的扩展指令，C++11之后可以借助\u003Ccode\u003Ealignas\u003C\u002Fcode\u003E关键字。\u003C\u002Fp\u003E\u003Cblockquote data-pid=\"1Kl1E-L8\"\u003E 比如，在C++11之前，gcc实现 \u003Ccode\u003Ealignas(alignment)\u003C\u002Fcode\u003E 效果的方式为  \u003Ccode\u003E__attribute__((__aligned__((alignment)))\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E \u003C\u002Fblockquote\u003E\u003Cp data-pid=\"1v2apwTu\"\u003E仍然以上述的\u003Ccode\u003EFoo\u003C\u002Fcode\u003E为例子，不过此时你希望\u003Ccode\u003EFoo\u003C\u002Fcode\u003E对象的起始地址总是32的倍数，C++11之后借助\u003Ccode\u003Ealignas\u003C\u002Fcode\u003E关键字，可以如下操作：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ealignas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E32\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n  \u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ethis\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Elong\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[])\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ECHECK_ALIGN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E));\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ESHOW_SIZEOF_AND_ALIGNOF\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"FHU_NF56\"\u003E输出如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E$ g++ main.cc -o main &amp;&amp; .\u002Fmain\n0x16d6f34e0\nsizeof(Foo):    32,     alignof(Foo):   32\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"OOw_rZE2\"\u003E说完\u003Ccode\u003Ealignas\u003C\u002Fcode\u003E的基础用法，下面说下使用\u003Ccode\u003Ealignas\u003C\u002Fcode\u003E时的注意事项，即\u003Ccode\u003Ealignas(alignment)\u003C\u002Fcode\u003E中的\u003Ccode\u003Ealignment\u003C\u002Fcode\u003E也不是随意写的，对于类型\u003Ccode\u003ET\u003C\u002Fcode\u003E，需要满足如下两个条件。\u003C\u002Fp\u003E\u003Ch3\u003E1. alignment &gt;= alignof(T)\u003C\u002Fh3\u003E\u003Cp data-pid=\"7dobj7dR\"\u003E仍然以\u003Ccode\u003EFoo\u003C\u002Fcode\u003E为例，在没有\u003Ccode\u003Ealignas\u003C\u002Fcode\u003E修饰时，默认的Foo的内存对齐要求\u003Ccode\u003Ealignof(Foo)\u003C\u002Fcode\u003E为8，现在尝试使用\u003Ccode\u003Ealignas\u003C\u002Fcode\u003E让\u003Ccode\u003EFoo\u003C\u002Fcode\u003E的对齐要求为4，操作如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ealignas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n  \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Elong\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"_pyMrTcO\"\u003E此时 \u003Ccode\u003ESHOW_SIZEOF_AND_ALIGNOF(Foo);\u003C\u002Fcode\u003E的输出\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003E$ g++ main.cc -o main \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E .\u002Fmain\nsizeof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003EFoo\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:    24,     alignof\u003Cspan class=\"o\"\u003E(\u003C\u002Fspan\u003EFoo\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E:   \u003Cspan class=\"m\"\u003E8\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"kPeTTx-S\"\u003E可以看出，此时的\u003Ccode\u003Ealignas\u003C\u002Fcode\u003E是失效的，在其他编译器下也许直接编译失败。\u003C\u002Fp\u003E\u003Ch3\u003E2. alignment == pow(2, N)\u003C\u002Fh3\u003E\u003Cp data-pid=\"Zn7mUocZ\"\u003E即\u003Ccode\u003Ealignas\u003C\u002Fcode\u003E 指定的大小\u003Ccode\u003Ealignment\u003C\u002Fcode\u003E必须是2的正数幂（\u003Ccode\u003EN&gt;0\u003C\u002Fcode\u003E），否则也是失效，在有些编译器下也许直接编译失败。\u003C\u002Fp\u003E\u003Cp data-pid=\"c4tMzBx3\"\u003E仍然以\u003Ccode\u003EFoo\u003C\u002Fcode\u003E为例子，\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ealignas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E9\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n  \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Elong\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"_4A0tCBW\"\u003E编译如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"err\"\u003E$\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eg\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E++\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecc\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eo\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003Ecc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E19\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"nl\"\u003Eerror\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Erequested\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ealignment\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;9&#39;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eis\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enot\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epositive\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epower\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eof\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\n   \u003Cspan class=\"mi\"\u003E20\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003Ealignas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E9\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"o\"\u003E|\u003C\u002Fspan\u003E                   \u003Cspan class=\"o\"\u003E^~~\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"XxBFPFAE\"\u003E好，到此，我想你应该大致理解了\u003Ccode\u003Ealignof\u003C\u002Fcode\u003E和\u003Ccode\u003Ealignas\u003C\u002Fcode\u003E两个关键字，更多用法可以参`\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fzh.cppreference.com\u002Fw\u002F%25E9%25A6%2596%25E9%25A1%25B5\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Ecpprefernece\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\u003Ch2\u003Estd::aligned_storage\u003C\u002Fh2\u003E\u003Cp data-pid=\"9HpAonQu\"\u003E在C++11中，也引入了一个满足内存对齐要求的静态内存分配类\u003Ccode\u003Estd::aligned_storage\u003C\u002Fcode\u003E，其类模板原型如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F in &lt;type_traits&gt;\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ELen\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \n          \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EAlign\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"cm\"\u003E\u002F*default-alignment*\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003Ealigned_storage\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"UwN3VpAY\"\u003E类\u003Ccode\u003Estd::aligned_storage\u003C\u002Fcode\u003E对象构造完成时，即分配了长度为\u003Ccode\u003ELen\u003C\u002Fcode\u003E个字节的内存，且该内存满足大小为 \u003Ccode\u003EAlign\u003C\u002Fcode\u003E 的对齐要求。\u003C\u002Fp\u003E\u003Cp data-pid=\"FbTV-5BM\"\u003E下面，我们先来看看 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fzh.cppreference.com\u002Fw\u002F%25E9%25A6%2596%25E9%25A1%25B5\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Ecpprefernece\u003C\u002Fa\u003E 给的一个demo，来熟悉下怎么使用\u003Ccode\u003Estd::aligned_storage\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cp data-pid=\"SyCwsxie\"\u003E类 \u003Ccode\u003EStaticVector\u003C\u002Fcode\u003E ，是一个满足内存对齐要求的静态数组，模板参数\u003Ccode\u003ET\u003C\u002Fcode\u003E是元素类型，\u003Ccode\u003EN\u003C\u002Fcode\u003E是数组元素个数。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EN\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EStaticVector\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Epublic\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EStaticVector\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n      \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;\u002F&#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eidx\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eidx\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eidx\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n        \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edata\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eidx\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n      \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"o\"\u003E~\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EStaticVector\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epos\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epos\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em_size\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereinterpret_cast\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edata\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-&gt;~\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n      \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArgs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \n    \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eemplace_back\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArgs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E...\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em_size\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&gt;=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ethrow\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebad_alloc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{};\u003C\u002Fspan\u003E\n      \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edata\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em_size\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eforward\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArgs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)...);\u003C\u002Fspan\u003E\n      \u003Cspan class=\"o\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em_size\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eoperator\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[](\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Ereinterpret_cast\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edata\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Epos\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Eprivate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"c1\"\u003E\u002F\u002F std::aligned_storage&lt;sizeof(T), alignof(T)&gt;::type data[N]; \u002F\u002F C++11\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ealigned_storage_t\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edata\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E];\u003C\u002Fspan\u003E        \u003Cspan class=\"c1\"\u003E\u002F\u002F c++14\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em_size\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"Og613tTY\"\u003E类\u003Ccode\u003EStaticVector\u003C\u002Fcode\u003E的使用如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ealignas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E32\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \n  \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \n  \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Elong\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003El\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[])\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EStaticVector\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ev1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ev1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eemplace_back\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;*&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ev1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003EStaticVector\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFoo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ev2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"062JaVT_\"\u003E在输出前，我们预测下：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"V7CSGMgc\"\u003E\u003Ccode\u003Estd:::string\u003C\u002Fcode\u003E 的\u003Ccode\u003Ealignof\u003C\u002Fcode\u003E值是8，那么\u003Ccode\u003EStaticVector\u003C\u002Fcode\u003E分配的两个\u003Ccode\u003Estd::string\u003C\u002Fcode\u003E对象地址，都应该是8的倍数\u003C\u002Fli\u003E\u003Cli data-pid=\"bbPrrSMx\"\u003E\u003Ccode\u003EFoo\u003C\u002Fcode\u003E的\u003Ccode\u003Ealignof\u003C\u002Fcode\u003E值是32，那么\u003Ccode\u003EStaticVector\u003C\u002Fcode\u003E为\u003Ccode\u003EFoo\u003C\u002Fcode\u003E 分配的两个\u003Ccode\u003EFoo\u003C\u002Fcode\u003E对象地址，都是32的倍数，\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp data-pid=\"6aykO3p8\"\u003E好，现在我们来看下输出：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003E$ g++ align_stroe.cc -o as \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E .\u002Fas\n8\u002F32\n0x16b5734c0\n0x16b5734e0\n*****\n32\u002F32\n0x16b573470\n0x16b573490\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"AkKgOTFj\"\u003E所以，到此，你也许理解了\u003Ccode\u003Estd::aligned_storage\u003C\u002Fcode\u003E 中\u003Ccode\u003Ealigned\u003C\u002Fcode\u003E的含义，即每个对象都是经过内存对齐的。\u003C\u002Fp\u003E\u003Cp data-pid=\"OikYMrR-\"\u003E熟悉了\u003Ccode\u003Estd::aligned_storage\u003C\u002Fcode\u003E 的用法，现在来看看他的实现叭，毕竟没人愿意只做个调包侠（滑稽脸）。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F in std namespace;\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_Len\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003E__aligned_storage_msa\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eunion\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003E__type\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"kt\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__data\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_Len\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E];\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003E__attribute__\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__aligned__\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__align\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_Len\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \n                  \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E_Align\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__aligned_storage_msa\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_Len\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__type\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003Ealigned_storage\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eunion\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"kt\"\u003Eunsigned\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__data\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_Len\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E];\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ealignas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_Align\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__align\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"tFObfg31\"\u003E在 \u003Ccode\u003Estd::aligned_storage\u003C\u002Fcode\u003E 内部，是通过一个\u003Ccode\u003Eunion\u003C\u002Fcode\u003E来实现的：\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli data-pid=\"oVj1Du6T\"\u003E\u003Ccode\u003Eunsigned char __data[_Len];\u003C\u002Fcode\u003E：这一行保证了分配的内存大小是\u003Ccode\u003E_Len\u003C\u002Fcode\u003E个字节\u003C\u002Fli\u003E\u003Cli data-pid=\"XSaW9XB5\"\u003E\u003Ccode\u003Estruct alignas(_Align) { } __align;\u003C\u002Fcode\u003E ：这一行保证了分配的内存是按照\u003Ccode\u003EAlign\u003C\u002Fcode\u003E 大小进行对齐的。\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp data-pid=\"op3SpWDO\"\u003E其中，第二点很好理解：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[])\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edata\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E16\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E];\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ealignas\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E16\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ealigned_data\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E16\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E];\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;unaligned: &#34;\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Edata\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;, aligned: &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ealigned_data\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"A_Jd1-z6\"\u003E输出如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"nl\"\u003Eunaligned\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nl\"\u003Ealigned\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E16\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"D2hU2API\"\u003E因此，如果只有\u003Ccode\u003Eunsigned char __data[_Len]；\u003C\u002Fcode\u003E，无法保证内存对齐，需要\u003Ccode\u003Estruct alignas(_Align) { } __align\u003C\u002Fcode\u003E的辅助。\u003C\u002Fp\u003E\u003Cp data-pid=\"RZ0gu_fv\"\u003E最后再提下 \u003Ccode\u003Estd::__aligned_storage_msa\u003C\u002Fcode\u003E的必要性：在构造类\u003Ccode\u003Estd::aligned_storage\u003C\u002Fcode\u003E对象时，如果没有指定类的第二个模板参数\u003Ccode\u003E_Align\u003C\u002Fcode\u003E，即内存对齐大小，由\u003Ccode\u003Estd::__aligned_storage_msa\u003C\u002Fcode\u003E为你设置默认的内存对齐大小。\u003C\u002Fp\u003E\u003Cp data-pid=\"GFC6YhKO\"\u003E可以看出，在 \u003Ccode\u003Estd::__aligned_storage_msa\u003C\u002Fcode\u003E 的实现中，\u003Ccode\u003E__attribute__((__aligned__))\u003C\u002Fcode\u003E 后面是没有参数的，此时gcc即会根据平台生成默认内存对齐大小。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[])\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__aligned_storage_msa\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__type\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__aligned_storage_msa\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__type\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__aligned_storage_msa\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E16\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__type\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__aligned_storage_msa\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E32\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__type\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eendl\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"l_pvLidm\"\u003E输出如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"err\"\u003E$\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eg\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E++\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ealign_stroe\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecc\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eo\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eas\u003C\u002Fspan\u003E\n\u003Cspan class=\"mi\"\u003E16\u003C\u002Fspan\u003E\n\u003Cspan class=\"mi\"\u003E16\u003C\u002Fspan\u003E\n\u003Cspan class=\"mi\"\u003E16\u003C\u002Fspan\u003E\n\u003Cspan class=\"mi\"\u003E16\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"B0nJY5Fw\"\u003E这个大小就是gcc编译器默认的内存大小。\u003C\u002Fp\u003E\u003Ch2\u003Estd::align\u003C\u002Fh2\u003E\u003Cp data-pid=\"PPpczgwc\"\u003E类\u003Ccode\u003Estd::aligned_storage\u003C\u002Fcode\u003E 是一个静态的内存对齐分配器，即在类\u003Ccode\u003Estd::aligned_storage\u003C\u002Fcode\u003E对象构造完时，就已满足设定内存大小、内存对齐要求，但是如果现在有一块内存，想从中取出一块符合某对齐要求的内存，咋办？\u003C\u002Fp\u003E\u003Cp data-pid=\"rEomvZ8R\"\u003E此时就可以使用\u003Ccode\u003Estd::align\u003C\u002Fcode\u003E函数，其函数原型如下：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F\u002F @param  alignment 是想要分配的内存符合的内存对齐大小\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F\u002F @param  size 想要分配内存的大小\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F\u002F @param  ptr 是个输入输出参数，输入时指向待使用的内存，输出时调整为符合alignment对齐要求的内存地址\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F\u002F @param  space 是ptr指向的内存剩余的空间\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F\u002F @return 如果 ptr 经过调整后能满足大小为 alignment 的对齐要求，则返回ptr的值，否则返回 nullptr\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ealign\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ealignment\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n             \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n             \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n             \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Espace\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"DpVHrjPn\"\u003E下面，我们继续先来看看 \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fzh.cppreference.com\u002Fw\u002F%25E9%25A6%2596%25E9%25A1%25B5\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003Ecpprefernece\u003C\u002Fa\u003E 中提供的一个demo，熟悉下怎么使用\u003Ccode\u003Estd::align\u003C\u002Fcode\u003E这个函数。\u003C\u002Fp\u003E\u003Cp data-pid=\"SNY73k1u\"\u003E类\u003Ccode\u003EArena\u003C\u002Fcode\u003E内已有一块缓冲区\u003Ccode\u003Ebuffer\u003C\u002Fcode\u003E，每次调用\u003Ccode\u003EAlignedAllocate&lt;T&gt;(size_t alignment)\u003C\u002Fcode\u003E函数时，即需要从\u003Ccode\u003Ebuffer\u003C\u002Fcode\u003E中取出大小为\u003Ccode\u003Esizeof(T)\u003C\u002Fcode\u003E的一块内存\u003Ccode\u003Eptr\u003C\u002Fcode\u003E，\u003Ccode\u003EAlignedAllocate\u003C\u002Fcode\u003E函数的输入参数\u003Ccode\u003Ealignment\u003C\u002Fcode\u003E指定了获得的内存\u003Ccode\u003Eptr\u003C\u002Fcode\u003E满足的内存对齐要求。\u003C\u002Fp\u003E\u003Cp data-pid=\"SUofsqoP\"\u003E现在来看看实现。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EN\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"nc\"\u003EArena\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebuffer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E];\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003EArena\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ebuffer\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"c1\"\u003E\u002F\u002F\u002F @return 返回的指针满足大小为 alignment 的内存对齐要求\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Etemplate\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Etypename\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EAlignedAllocate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ealignment\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ealignof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;ptr: &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereinterpret_cast\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;, &#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ealign\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ealignment\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n          \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eresult\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereinterpret_cast\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n          \u003Cspan class=\"n\"\u003Eptr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eptr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n          \u003Cspan class=\"n\"\u003Esize\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Esizeof\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n          \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eresult\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n      \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n      \u003Cspan class=\"c1\"\u003E\u002F\u002F 若无，则返回 nullptr\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E      \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enullptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E};\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"QL9awF66\"\u003E下面是测试。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargv\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[])\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EArena\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E64\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earena\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ep1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earena\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAlignedAllocate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Echar\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;a&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;allocated a char at &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ep2\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earena\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAlignedAllocate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E();\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep2\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;allocated an int at &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep2\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ep3\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Earena\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EAlignedAllocate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Eint\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E32\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep3\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Estd\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ecout\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E&#34;allocated an int at &#34;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ep3\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&lt;&lt;\u003C\u002Fspan\u003E \u003Cspan class=\"sc\"\u003E&#39;\\n&#39;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"NdNa2dPM\"\u003E从下面的输出可以看出，\u003Ccode\u003EAlignedAllocate\u003C\u002Fcode\u003E 函数返回的内存地址都是符合设定的内存对齐要求的。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003E$ g++ align.cc -o align \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E .\u002Falign \nptr: 0x16fc2b4b8, allocated a char at 0x16fc2b4b8     \u003Cspan class=\"c1\"\u003E# 1 byte 内存对齐，指针无须调整\u003C\u002Fspan\u003E\nptr: 0x16fc2b4b9, allocated an int at 0x16fc2b4bc     \u003Cspan class=\"c1\"\u003E# 4 byte 内存对齐，指针调整了 3 个字节\u003C\u002Fspan\u003E\nptr: 0x16fc2b4c0, allocated an int at 0x16fc2b4c0     \u003Cspan class=\"c1\"\u003E# 32 byte 内存对齐，指针无须调整\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"dlZ3yaTg\"\u003E最后，我们再来看看\u003Ccode\u003Estd::align\u003C\u002Fcode\u003E函数的实现，稍微简化后如下。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"c1\"\u003E\u002F\u002F in &lt;memory&gt;\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E  \u003Cspan class=\"kr\"\u003Einline\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ealign\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__align\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__size\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Esize_t\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__space\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enoexcept\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__intptr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereinterpret_cast\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Euintptr_t\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__ptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__aligned\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__intptr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1u\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__align\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__align\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__diff\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__aligned\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__intptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c1\"\u003E\u002F\u002F 如果没有剩余的空间，直接返回 nullptr\n\u003C\u002Fspan\u003E\u003Cspan class=\"c1\"\u003E\u003C\u002Fspan\u003E    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__size\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__diff\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__space\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Enullptr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n     \u003Cspan class=\"n\"\u003E__space\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__diff\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n     \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__ptr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ereinterpret_cast\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__aligned\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"rwPFpL0J\"\u003E\u003Ccode\u003Estd::align\u003C\u002Fcode\u003E的实现里，最为关键的一步，即计算对齐后的地址：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-cpp\"\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__aligned\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__intptr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1u\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E__align\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E__align\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp data-pid=\"8NtcnGUL\"\u003E对于这一步，本来想写个证明啥的，还是举个例子来解释比较通俗。\u003C\u002Fp\u003E\u003Cp data-pid=\"xxF2AzTe\"\u003E按照\u003Ccode\u003E__align\u003C\u002Fcode\u003E大小进行内存对齐，即可视为按\u003Ccode\u003E__align\u003C\u002Fcode\u003E进制向上取整。\u003C\u002Fp\u003E\u003Cp data-pid=\"kSyXWYWL\"\u003E什么意思呢？\u003C\u002Fp\u003E\u003Cp data-pid=\"x-I2Luyv\"\u003E比如说，现在按照10进制对齐，有地址12，想让12向上调整到10的倍数，怎么做？\u003C\u002Fp\u003E\u003Col\u003E\u003Cli data-pid=\"wGrX-VWU\"\u003E先加上一个步长：\u003Ccode\u003E12 + 10 - 1 = 21\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\u003Cli data-pid=\"JFuRAKOZ\"\u003E将余数1清掉：\u003Ccode\u003E21 &amp;  (-10) = 20\u003C\u002Fcode\u003E。这一步中，\u003Ccode\u003E-10\u003C\u002Fcode\u003E 的本质就是保证高位不变，将低位全部变为0，取\u003Ccode\u003E&amp;\u003C\u002Fcode\u003E之后，取余就全部清理了。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp data-pid=\"PckDFstC\"\u003E现在的内存对齐，本质上也是向上取整：\u003Ccode\u003E__intptr - 1u + __align\u003C\u002Fcode\u003E是为了向前一个步长，再对  \u003Ccode\u003E-__align\u003C\u002Fcode\u003E取\u003Ccode\u003E&amp;\u003C\u002Fcode\u003E，来清除余数。\u003C\u002Fp\u003E\u003Cp data-pid=\"nyaLyFk1\"\u003E关于内存对齐，很多项目里都有涉及，最近在阅读RocksDb也再次遇到，于是乎就找了个契机写下了这篇博客，后续会尝试更新RocksDb。\u003C\u002Fp\u003E","adminClosedComment":false,"topics":[{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19584970","type":"topic","id":"19584970","name":"C++"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19579205","type":"topic","id":"19579205","name":"内存管理"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19726035","type":"topic","id":"19726035","name":"C++11"}],"voteupCount":92,"voting":0,"heavyUpStatus":"allow_heavy_up","column":{"description":"","canManage":false,"intro":"更好、更安全地使用Modern C++","isFollowing":false,"urlToken":"c_1344587700045914112","id":"c_1344587700045914112","articlesCount":12,"acceptSubmission":false,"title":"深入了解Modern C++","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1344587700045914112","commentPermission":"all","created":1613354689,"updated":1613453266,"imageUrl":"https:\u002F\u002Fpica.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a71366f3d114e7933a248784fce4ba9c.jpg?source=172ae18b","uid":"987058110737039360","userType":"people","isFollowing":false,"urlToken":"wx8bf61dc609c0aa69","id":"64d408c30111fc3e37486786f5b50ad8","description":"人生苦短，我选C++","name":"fibonaccii","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002F64d408c30111fc3e37486786f5b50ad8","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a71366f3d114e7933a248784fce4ba9c_l.jpg?source=172ae18b","isOrg":false,"type":"people"},"followers":16,"type":"column"},"commentCount":8,"contributions":[{"id":34279914,"state":"accepted","type":"first_publish","column":{"description":"","canManage":false,"intro":"更好、更安全地使用Modern C++","isFollowing":false,"urlToken":"c_1344587700045914112","id":"c_1344587700045914112","articlesCount":12,"acceptSubmission":false,"title":"深入了解Modern C++","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1344587700045914112","commentPermission":"all","created":1613354689,"updated":1613453266,"imageUrl":"https:\u002F\u002Fpica.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a71366f3d114e7933a248784fce4ba9c.jpg?source=172ae18b","uid":"987058110737039360","userType":"people","isFollowing":false,"urlToken":"wx8bf61dc609c0aa69","id":"64d408c30111fc3e37486786f5b50ad8","description":"人生苦短，我选C++","name":"fibonaccii","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002F64d408c30111fc3e37486786f5b50ad8","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a71366f3d114e7933a248784fce4ba9c_l.jpg?source=172ae18b","isOrg":false,"type":"people"},"followers":16,"type":"column"}}],"isTitleImageFullScreen":false,"upvotedFollowees":[],"commercialInfo":{"isCommercial":false,"plugin":{}},"suggestEdit":{"status":false,"reason":"","tip":"","url":"","title":""},"reason":"","annotationAction":[],"canTip":true,"tipjarorsCount":0,"isLabeled":false,"hasPublishingDraft":false,"isFavorited":false,"favlistsCount":277,"isNormal":true,"status":0,"shareText":"深入了解 | 内存对齐之 alignof、alignas 、aligned_storage、align 深度剖析 - 来自知乎专栏「深入了解Modern C++」，作者: fibonaccii https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F417061548 （想看更多？下载 @知乎 App：http:\u002F\u002Fweibo.com\u002Fp\u002F100404711598 ）","canComment":{"status":true,"reason":""},"mcnFpShow":-1,"isVisible":true,"isLiked":false,"likedCount":21,"hasColumn":true,"republishers":[],"isNewLinkCard":true,"emojiReaction":{"cryFaceCount":0,"cryFaceHasSet":false,"hugCount":0,"hugHasSet":false,"likeCount":21,"likeHasSet":false,"onlookerCount":0,"onlookerHasSet":false},"abParam":{"shangyebiaoshi":"1"},"attachedInfo":"kgIkCgkxODA4MTAyNzcSCTQxNzA2MTU0OBgHIgpJTUFHRV9URVhU","shareGuide":{"hasPositiveBubble":false,"hasTimeBubble":false,"hitShareGuideCluster":false},"settings":{"tableOfContents":{"enabled":false}},"canReference":false,"reactionInstruction":{}}},"columns":{"c_1344587700045914112":{"description":"","canManage":false,"intro":"更好、更安全地使用Modern C++","isFollowing":false,"urlToken":"c_1344587700045914112","id":"c_1344587700045914112","articlesCount":12,"acceptSubmission":false,"title":"深入了解Modern C++","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1344587700045914112","commentPermission":"all","created":1613354689,"updated":1613453266,"imageUrl":"https:\u002F\u002Fpica.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a71366f3d114e7933a248784fce4ba9c.jpg?source=172ae18b","uid":"987058110737039360","userType":"people","isFollowing":false,"urlToken":"wx8bf61dc609c0aa69","id":"64d408c30111fc3e37486786f5b50ad8","description":"人生苦短，我选C++","name":"fibonaccii","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002F64d408c30111fc3e37486786f5b50ad8","avatarUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-a71366f3d114e7933a248784fce4ba9c_l.jpg?source=172ae18b","isOrg":false,"type":"people"},"followers":16,"type":"column"}},"topics":{},"roundtables":{},"favlists":{},"comments":{},"notifications":{},"ebooks":{},"activities":{},"feeds":{},"pins":{},"promotions":{},"drafts":{},"chats":{},"posts":{},"clubs":{},"clubTags":{},"zvideos":{},"zvideoContributions":{},"briefs":{},"eduCourses":{}},"currentUser":"c29982ea4958b35f1d733b99ef5bf579","account":{"lockLevel":{},"unlockTicketStatus":false,"unlockTicket":null,"challenge":[],"errorStatus":false,"message":"","isFetching":false,"accountInfo":{},"urlToken":{"loading":false},"cardUserInfo":{"vipInfo":{}},"handleWidget":{},"widgetList":[],"userWidgetId":""},"settings":{"socialBind":null,"inboxMsg":null,"notification":{},"email":{},"privacyFlag":null,"blockedUsers":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"blockedFollowees":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"ignoredTopics":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"restrictedTopics":null,"laboratory":{}},"notification":{},"people":{"profileStatus":{},"activitiesByUser":{},"answersByUser":{},"answersSortByVotesByUser":{},"answersIncludedByUser":{},"votedAnswersByUser":{},"thankedAnswersByUser":{},"voteAnswersByUser":{},"thankAnswersByUser":{},"topicAnswersByUser":{},"zvideosByUser":{},"articlesByUser":{},"articlesSortByVotesByUser":{},"articlesIncludedByUser":{},"pinsByUser":{},"questionsByUser":{},"commercialQuestionsByUser":{},"favlistsByUser":{},"followingByUser":{},"followersByUser":{},"mutualsByUser":{},"followingColumnsByUser":{},"followingQuestionsByUser":{},"followingFavlistsByUser":{},"followingTopicsByUser":{},"publicationsByUser":{},"columnsByUser":{},"allFavlistsByUser":{},"brands":null,"creationsByUser":{},"creationsSortByVotesByUser":{},"creationsFeed":{},"infinity":{},"batchUsers":{},"profileInfinity":null},"env":{"ab":{"config":{"params":[{"id":"titlepagechoose","type":"Int","value":"1","layerId":"titlepagechoose"},{"id":"pc_ppt_publish","type":"Int","value":"1","layerId":"pc_ppt_publish"},{"id":"zse_3","type":"Int","value":"1","layerId":"zse_3"},{"id":"pc_comment","type":"Int","value":"0","layerId":"EsOR"},{"id":"vessay_v2_sdk","type":"Int","value":"1","layerId":"Qtkm"},{"id":"helpcenter_pc","type":"Int","value":"1","layerId":"helpcenter_pc"}],"experiments":[{"expId":"pc_ppt_publish-2_v2","expPrefix":"pc_ppt_publish","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"titlepagechoose-2_v3","expPrefix":"titlepagechoose","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"helpcenter_pc-2_v11","expPrefix":"helpcenter_pc","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"pc_comment-1_v3","expPrefix":"pc_comment","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"zse_3-2_v20","expPrefix":"zse_3","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false}],"chains":[{"chainId":"_all_"}],"encodedParams":"CpYCdAjaCKUKKQvzA9YEzAKiBmcIFgnDCeALUgt2CHkLowswBtwHYAvdB0kKqQrsCkEGmwd5CH0L4At0AXcHSQlUCRsAtwOUBtEJQwBqAdYIhAndCuULmArkCtgCyAntCjsL1wvcC\u002FQJtQuDCnYLmws7AjIDPwnlCfEJjQs0DOkE5QhrCsALPwAnCP0KtAAyBVUJxAnECjcMxwn2CdQKAQlgCcUIvgqiA3gHyQmFC7QKQgmMBZ4FFgYxBlcHqwn0A8wJAQtAAVADpgQRBcsJuQvmC2kBiwVlCn0CjAQpBScH6wbYB3oImAgECv4KoANWDFEFfgbFCcoJRwBPA6EDcQvXAo0ExgnOCkYLMwSNCbkC4QkTC0MLhwsSiwEAAAAAAAQAAAQAAAEBAAAAAAIAAgAAAQAABQAAAAABAAAAAAAVAQAAAAABAAAAAAEAAAADAAACAAAAAAUBAAABAAAAAAQAAQAAAAEAAgEAAAAAAAAAAAAAAAEAAQEBAAAAAQAAAAAAAAEAAAEEAAAAAAIDAAAAAQEAAAAAAAAAAAQAAAAAABUAAQAA"},"triggers":{}},"userAgent":{"Edge":false,"IE":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"iOS":false,"isAppleDevice":false,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Quark":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"AndroidDaily":false,"iOSDaily":false,"WxMiniProgram":false,"BaiduMiniProgram":false,"QQMiniProgram":false,"JDMiniProgram":false,"isWebView":false,"isMiniProgram":false,"origin":"Mozilla\u002F5.0 (X11; Linux x86_64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F103.0.0.0 Safari\u002F537.36"},"appViewConfig":{},"ctx":{"path":"\u002Fp\u002F417061548","query":{},"href":"http:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F417061548","host":"zhuanlan.zhihu.com"},"trafficSource":"production","edition":{"beijing":true,"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false,"sogouInput":false,"baiduSearch":false,"googleSearch":false,"shenma":false,"miniProgram":false,"xiaomi":false},"theme":"light","appHeaderTheme":{"current":"normal","disable":true,"normal":{"bgColor":"GBK99A"},"custom":{"bgColor":"GBK99A"}},"enableShortcut":true,"referer":"https:\u002F\u002Fwww2.bing.com\u002F","xUDId":"AIAe75fvzhSPTpeNw8WYbUTCwgHWLCTfJt8=","mode":"ssr","conf":{},"xTrafficFreeOrigin":"","ipInfo":{"cityName":"北京","countryName":"中国","regionName":"北京","countryCode":"CN"},"logged":true,"vars":{"passThroughHeaders":{}}},"me":{"columnContributions":[]},"label":{"recognizerLists":{}},"ecommerce":{},"comments":{"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"parent":{}},"commentsV2":{"stickers":[],"commentWithPicPermission":{},"notificationsComments":{},"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"conversationMore":{},"parent":{}},"pushNotifications":{"default":{"isFetching":false,"isDrained":false,"ids":[]},"follow":{"isFetching":false,"isDrained":false,"ids":[]},"vote_thank":{"isFetching":false,"isDrained":false,"ids":[]},"currentTab":"default","notificationsCount":{"default":0,"follow":0,"vote_thank":0}},"messages":{"data":{},"currentTab":"common","messageCount":0},"register":{"registerValidateSucceeded":null,"registerValidateErrors":{},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null},"login":{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"needSMSIdentify":false,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false},"switches":{},"captcha":{"captchaNeeded":false,"captchaValidated":false,"captchaBase64String":null,"captchaValidationMessage":null,"loginCaptchaExpires":false},"sms":{"supportedCountries":[]},"chat":{"chats":{},"inbox":{"recents":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"strangers":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"friends":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"search":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"config":{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0}},"global":{"isChatMqttExisted":false}},"emoticons":{"emoticonGroupList":[],"emoticonGroupDetail":{}},"creator":{"currentCreatorUrlToken":null,"homeData":{"recommendQuestions":[]},"tools":{"question":{"invitationCount":{"questionFolloweeCount":0,"questionTotalCount":0},"goodatTopics":[]},"customPromotion":{"itemLists":{}},"recommend":{"recommendTimes":{}}},"explore":{"academy":{"tabs":[],"article":{}}},"rights":[],"newRights":[],"rightsStatus":{},"levelUpperLimit":10,"account":{"growthLevel":{}},"mcn":{},"applyStatus":{},"videoSupport":{},"textBenefit":{},"mcnManage":{},"tasks":{},"newTasks":{"creatorTask":{"tasks":[],"des":[]}},"scoreInfo":{},"recentlyCreated":[],"analysis":{"all":{},"answer":{},"zvideo":{},"article":{},"pin":{},"singleContent":{}},"announcement":{},"bannerList":[],"school":{"tabs":[],"contents":[],"banner":null,"entities":{}},"creatorsRecommendInfo":{},"menusShowControlByServer":{"bVipRecomend":false,"creationRelationship":false},"income":{"aggregation":{}}},"answers":{"voters":{},"copyrightApplicants":{},"favlists":{},"newAnswer":{},"entityWords":{},"concernedUpvoters":{},"simpleConcernedUpvoters":{},"paidContent":{},"settings":{}},"recommendation":{"homeRecommendations":[]},"shareTexts":{},"articles":{"voters":{},"concernedUpvoters":{}},"previewPost":{},"favlists":{"relations":{}},"columns":{"voters":{}},"reward":{"answer":{},"article":{},"question":{}},"video":{"data":{},"shareVideoDetail":{},"last":{}},"topstory":{"recommend":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"follow":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"room":{"meta":{},"isFetching":false,"afterId":0,"items":[],"next":null},"followWonderful":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"sidebar":null,"announcement":{},"hotList":[],"guestFeeds":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followExtra":{"isNewUser":null,"isFetched":false,"followCount":0,"followers":[]},"hotDaily":{"data":[],"paging":{}},"hotHighlight":{"isFetching":false,"isDrained":false,"data":[],"paging":{}},"banner":{},"commercialBanner":{"show":false,"banner":{},"trackData":{}},"video":{"items":[],"next":null,"isLoading":false,"isDrained":false}},"readStatus":{},"column":{},"requestColumn":{"categories":[],"error":null},"articleContribution":{"contributeRequests":[],"deleteContributeIdList":[],"handledContributeIdList":[],"recommendedColumns":[],"pinnedColumns":[],"sentContributeRequestsIdList":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"c_1344587700045914112"]},"columnContribution":{"contributeRequests":[],"autoInviteEnabled":false,"recommendedContributors":[],"contributionInvitation":null},"draftHistory":{"history":{},"drafts":{}},"upload":{},"articleDraft":{"titleImage":"","titleImageSize":{},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"updating":false,"globalLoading":false,"pendingVideo":{"resource":null,"error":null},"deleteFail":{"fail":false},"recommendTopics":[],"selectedColumn":0,"articleDisclaimers":[]},"articleDrafts":{"isDrained":false,"isLoading":false,"items":[]},"columnAutocomplete":{"users":[],"friends":[]},"columnCollection":{},"userProfit":{"permission":{"permissionStatus":{"zhiZixuan":0,"recommend":-1,"task":0,"plugin":0,"infinity":0},"visible":false}},"mcn":{"bindInfo":{},"memberCategoryList":[],"producerList":[],"categoryList":[],"lists":{},"banners":{},"protocolStatus":{"isAgreedNew":true,"isAgreedOld":true},"probationCountdownDays":0},"zvideos":{"campaignVideoList":{},"campaigns":{},"tagoreCategory":[],"recommendations":{},"insertable":{},"recruit":{"form":{"platform":"","nickname":"","followerCount":"","domain":"","contact":""},"submited":false,"ranking":[]},"club":{},"qyActivityData":{},"talkActivityData":{},"party2022ActivityData":{},"batchVideos":{},"contribution":{"selectedContribution":null,"campaign":null,"configs":{},"contributionLists":{},"recommendQuestions":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]},"questionSearchResults":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]}},"creationReferences":{},"zvideoCollection":{},"zvideoGrant":{},"collectData":{"isFetching":false,"list":[]},"videoSource":{"isLoaded":false}},"republish":{},"commentPermission":{},"creatorRightStatus":{"list":[]}},"fetchHost":"www.zhihu.com","subAppName":"column"}</script><script crossorigin="" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/vendor.4bb309fcb0b4b803488b.js"></script><script crossorigin="" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.lib_09e9ad9b.fbfa55fa9433796f820f.js"></script><script crossorigin="" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.lib_79b5cf47.de789fe0bc73ed9e2a1e.js"></script><script crossorigin="" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.lib_29107295.22996fa650bfe2970aa2.js"></script><script crossorigin="" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.lib_0ad37f8a.945f89efc7273da86d82.js"></script><script crossorigin="" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/column.app.b0d7f0cad64f82742d61.js"></script><script defer="" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/aria.js"></script><script src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/hm.js" async=""></script><script crossorigin="" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/zap.js"></script><script src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/push.js"></script><div><div style="display: none;"><i>想来知乎工作？请发送邮件到 jobs@zhihu.com</i></div></div><div><div><div class="css-8pdeid"></div></div></div><script crossorigin="" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/js"></script><script crossorigin="" src="./深入了解_内存对齐之 alignof_alignas_aligned_storage_align_files/emoticon.js"></script><div><div><div class="Editable-languageSuggestions" style="left: -1179px; top: -999px;"><div><div class="Popover"><label class="Editable-languageSuggestionsInput Input-wrapper"><input autocomplete="off" role="combobox" aria-expanded="false" aria-autocomplete="list" aria-activedescendant="AutoComplete18-0" id="Popover17-toggle" aria-haspopup="true" aria-owns="Popover17-content" class="Input" placeholder="选择语言" value=""><svg width="24" height="24" viewBox="0 0 24 24" data-new-api="ArrowUpDown24" data-old-api="Select" fill="#afbdcf" class="Zi Zi--Select"><path d="M12.53 3.47a.75.75 0 00-1.06 0l-5 5a.75.75 0 001.06 1.06L12 5.06l4.47 4.47a.75.75 0 101.06-1.06l-5-5zm-5 11a.75.75 0 00-1.06 1.06l5 5a.75.75 0 001.06 0l5-5a.75.75 0 10-1.06-1.06L12 18.94l-4.47-4.47z" fill-rule="evenodd" clip-rule="evenodd"></path></svg></label></div></div></div></div></div></body></html>