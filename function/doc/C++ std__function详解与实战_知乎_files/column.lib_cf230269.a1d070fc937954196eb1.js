(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{1706:function(e,t,n){"use strict";n.d(t,"a",(function(){return on}));var r,o,c,i=n(1380),a=n.n(i),s=n(186),u=n.n(s),l=n(30),d=n.n(l),b=n(33),p=n.n(b),f=n(73),h=n.n(f),m=n(51),O=n.n(m),g=n(22),j=n.n(g),v=n(0),x=n(1),y=n.n(x),C=n(123),k=n(891),T=n(5),w=n(9),A=n(89),B=n.n(A),I=n(1441),z=n(1500),S=n(1707),E=n(53),L=n.n(E),R=n(1725),D=n(1783),G=n(906),N=n(1343),P=n(700),F=n(1788),M=n(287),_=n(27),K=n(156),H=n(41),U=n(253),V=n.n(U),W=n(795),J=n.n(W),q=n(45),X=n.n(q),Y=n(1210),$=n(1215),Q=n(350),Z=n(444),ee=n(1293),te=n(699),ne=n(1284),re=n(892),oe=n(1784),ce=n(1212),ie=n(1785),ae=n(1213),se=n(1786),ue=n(1787),le=n(1789),de=n(1790),be=n(893),pe=n(3),fe=n(93),he=n(533),me=n(175),Oe=n(61),ge=n(177),je=n(76),ve=n(1708),xe=n(228),ye=n(1216),Ce=["children"],ke=["showConfirm"],Te=["sortType"];function we(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ae(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ae(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,c=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw c}}}}function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Be(e,t){var n=Object(x.useRef)(),r=Object(x.useRef)(),o=Object(x.useState)({}),c=j()(o,2)[1],i=Object(C.a)((function(e){e!==r.current&&(r.current="function"==typeof e?e(r.current):e,c({}))}));return function(e,t){return!e||!t||e.length!==t.length||e.some((function(e,n){return e!==t[n]}))}(n.current,t)&&(n.current=t,r.current=e()),[r.current,i]}var Ie=function(e){var t=e.isOpen,n=e.title,r=e.content,o=e.onOK,c=e.onCancel;return Object(v.b)(R.a,{title:n,closeButton:" ",maskClosable:!1,hotKeyClosable:!1,children:t&&Object(v.c)(v.a,{children:[Boolean(r)&&Object(v.b)(T.Text,{textAlign:"center",mb:"-15px",children:r}),Object(v.c)(D.a,{direction:"horizontal",children:[Object(v.b)(G.a,{onClick:c,children:"取消"}),Object(v.b)(G.a,{preset:"primary",color:"blue",onClick:o,children:"确定"})]})]})})},ze="https://www.zhihu.com/api/v4/comment_v5",Se=function(e){var t,n;return(null===(n=null===(t=e.payload)||void 0===t?void 0:t.error)||void 0===n?void 0:n.message)||e.statusMessage||e.message},Ee=new _.b.Entity("comments"),Le=new _.b.Array(Ee);Ee.define({childComments:Le});var Re,De=function(e){return Object(_.a)(e,Le)},Ge=function(e){return{elementLocation:{block:{blockText:e}}}},Ne={root:"root_comment",sub:"child_comment",collapsed:"collapse_comments",reviewing:"reviewing_comments",anchor:"anchor_comment"},Pe=function(e){var t=e.resourceId,n=e.resourceType,r=e.onError,o=e.children,c=Object(M.b)(),i=Object(I.d)().cache,a=Object(x.useMemo)((function(){return function(e,t){return function(n){return function(r,o,c){return Array.isArray(r)?n([e,t].concat(O()(r)),o,c):n(r,o,c)}}}(n,t)}),[n,t]),s=Object(C.a)((function(e,r,o,c,a){var s,u,l=Object(I.c)([n,t,e,r,o]),d="".concat(l).concat(JSON.stringify(c||""),","),b=we(i.keys());try{for(b.s();!(u=b.n()).done;){var p=u.value;p.startsWith(l)&&p!==d&&function(){var e=(null===(s=i.get(p))||void 0===s?void 0:s.entities)||{};a.data=a.data.filter((function(t){return!e[t.id]}))}()}}catch(e){b.e(e)}finally{b.f()}})),u=Object(C.a)(function(){var e=h()(p.a.mark((function e(t,n,o,i,a,u){var l,d,b,f,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l="sub"!==o&&"anchor"!==o||!a?"".concat(t,"s/").concat(n):"comment/".concat(a),e.next=4,c("".concat(ze,"/").concat(l,"/").concat(Ne[o]),{query:{order_by:i,limit:20,offset:u}});case 4:return d=e.sent,s(o,i,a,u,d),b=De(d.data),f=b.result,h=b.entities,d.data=f||[],d.entities=h.comments||{},e.abrupt("return",d);case 12:throw e.prev=12,e.t0=e.catch(0),r("commentFetchError",Se(e.t0)),e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n,r,o,c,i){return e.apply(this,arguments)}}());return Object(v.b)(I.a,{value:{use:[a],fetcher:u,revalidateOnFocus:!1,errorRetryCount:3},children:o})},Fe=Object(x.createContext)({}),Me=function(e){var t=e.children,n=d()(e,Ce),r=n.resourceType,o=n.resourceId,c=n.onError,i=function(){var e=Object(x.useState)({isOpen:!1,title:""}),t=j()(e,2),n=t[0],r=n.isOpen,o=n.title,c=n.content,i=t[1],a=Object(x.useRef)(),s=Object(C.a)((function(e,t){return i({isOpen:!0,title:e,content:t}),new Promise((function(e){a.current=e}))}));return{isOpen:r,title:o,content:c,onOK:Object(C.a)((function(){var e;i({isOpen:!1,title:""}),null===(e=a.current)||void 0===e||e.call(a,!0),a.current=void 0})),onCancel:Object(C.a)((function(){var e;i({isOpen:!1,title:""}),null===(e=a.current)||void 0===e||e.call(a,!1),a.current=void 0})),showConfirm:s}}(),a=i.showConfirm,s=d()(i,ke),u=Object(x.useMemo)((function(){return Object.assign({showConfirm:a},n)}),Object.values(n));return r&&o?Object(v.c)(Fe.Provider,{value:u,children:[Object(v.b)(Pe,{resourceType:r,resourceId:o,onError:c,children:t}),Object(v.b)(Ie,Object.assign({},s))]}):null},_e=function(){return Object(x.useContext)(Fe)},Ke=y.a.createContext({push:L.a,pop:L.a,changeLayerData:L.a,layers:[]}),He=y.a.createContext({}),Ue=function(e){var t=e.children,n=_e(),r=n.shown,o=n.displayType,c=n.anchorCommentId,i=n.onClose,a=Be((function(){if(!r)return[];var e=[{index:0,sortType:"score",commentType:"root",displayType:o}];return c&&e.push({index:1,sortType:"score",commentType:"anchor",displayType:"modal",fetchCommentId:c}),e}),[r,o,c]),s=j()(a,2),u=s[0],l=s[1],b=Object(C.a)((function(e){var t=e.sortType,n=d()(e,Te);l((function(e){return[].concat(O()(e),[Object.assign({index:e.length,sortType:t||"score",displayType:"modal"},n)])}))})),p=Object(C.a)((function(e){1===u.length?null==i||i():l("number"==typeof e?function(t){return t.slice(0,e+1)}:function(e){return e.slice(0,e.length-1)})})),f=Object(C.a)((function(e,t){l(Object(S.b)((function(n){n[t]=Object.assign(Object.assign({},n[t]),e)})))})),h={layers:u,push:b,pop:p,changeLayerData:f};return Object(v.b)(Ke.Provider,{value:h,children:t})},Ve=function(){return Object(x.useContext)(Ke)},We=Object(x.memo)((function(e){var t=e.data,n=e.children,r=Ve(),o=r.changeLayerData,c=Object(C.a)((function(e){o(e,t.index)})),i=Object(C.a)((function(){return t.index===r.layers.length-1}));return t&&n?Object(v.b)(He.Provider,{value:Object.assign(Object.assign({},t),{},{changeLayerData:c,isTopLayer:i,router:r}),children:n}):null})),Je=function(){return Object(x.useContext)(He)},qe=function(e,t){var n=Je(),r=n.displayType,o=n.commentType,c=n.sortType,i=n.fetchCommentId;return Object(I.b)([o,c,i,e],Object.assign({revalidateIfStale:Boolean("list"===r||(null==t?void 0:t.isInfinitePage))},t))},Xe={1:"评论已关闭",2:"评论内容由作者筛选后展示",3:"因作者设置，评论区已关闭"},Ye=function(e){var t=e.noComments,n=e.type,r=void 0===n?0:n,o=Je(),c=o.displayType,i=o.commentType,a="list"===c?{height:"400px"}:{height:"100%"};if(t){var s="root"===i||"sub"===i;return Object(v.b)(K.a.EI1,{image:"noWorks",content:s?"还没有评论，发表第一个评论吧":"无内容",css:a})}return Object(v.b)(K.a.EI1,{image:"contentError",content:Xe[r],css:a})},$e=function(e,t){var n=t.pageOffset,r=t.layer,o=t.changePageData,c=r.commentType,i=r.sortType;""!==n&&o(e,void 0,[c,i,void 0,""])},Qe=function(e){var t=e.layer;(0,e.changePageData)(void 0,void 0,["root",t.router.layers[0].sortType,void 0,""],!0)},Ze=function(){var e=h()(p.a.mark((function e(t,n){var r,o,c,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,o=t.replyCommentId,e.next=3,n.changePageData((function(e){e.entities[r.id]=r;var t=e.entities[o].replyRootCommentId,c=e.entities[t];e.counts.totalCounts+=1,t===o?(c.childComments.unshift(r.id),c.childCommentCount+=1):"root"===n.layer.commentType?c.childComments.splice(c.childComments.indexOf(o)+1,0,r.id):e.data.splice(e.data.indexOf(o)+1,0,r.id)}));case 3:null===(i=(c=n.sharedData).onMessage)||void 0===i||i.call(c,"评论发布成功！"),$e((function(e){e.counts.totalCounts+=1}),n);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),et=function(e,t){var n=e.id,r=e.type,o=t.changePageData,c=t.fetcher,i=t.sharedData;return o(function(){var e=h()(p.a.mark((function e(t){var o,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.entities[n]["".concat(r,"d")],e.next=3,c("".concat(ze,"/comment/").concat(n,"/reaction/").concat(r),{method:a?"PUT":"DELETE"});case 3:"dislike"===r&&(null===(o=i.onMessage)||void 0===o||o.call(i,a?"已踩评论":"已取消踩"));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){var t=e.entities[n];if("like"===r)t.liked=!t.liked,t.disliked&&(t.disliked=!t.liked),t.likeCount+=t.liked?1:-1;else{t.disliked=!t.disliked;var o=t.liked;t.liked&&(t.liked=!t.disliked),o!==t.liked&&(t.likeCount+=t.liked?1:-1)}}))},tt=function(){var e=h()(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=Number(X.a.get("zhihu::comment_replace_top_count"))||0)>=3)){e.next=3;break}return e.abrupt("return",!0);case 3:return X.a.set("zhihu::comment_replace_top_count",n+1),e.next=6,t("确定替换已置顶的评论？","当前已有置顶评论，你只能置顶一条评论");case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),nt=function(){var e=h()(p.a.mark((function e(t,n){var r,o,c,i,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.commentData,o=t.alreadyToppedId,c=n.changePageData,i=n.fetcher,a=n.layer,e.abrupt("return",c(function(){var e=h()(p.a.mark((function e(t){var n,c,a,s,u,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=7;break}return n=t.entities[o],e.next=4,i("".concat(ze,"/comment/").concat(o));case 4:(c=e.sent).childComments=n.childComments,t.entities[o]=c;case 7:a=De([r]),s=a.result,u=a.entities,l=t.data.findIndex((function(e){return t.entities[e].top})),t.data.splice(l+1,0,s[0]),t.entities=Object.assign(Object.assign({},t.entities),u.comments);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),void 0,["root",a.sortType,void 0,""]));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),rt=function(){var e=h()(p.a.mark((function e(t,n){var r,o,c,i,a,s,u,l,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.changePageData,c=n.getCache,i=n.sharedData,a=n.fetcher,s=n.layer,e.next=3,o(function(){var e=h()(p.a.mark((function e(n){var r,o,b,f;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.entities[t],o=r.isAuthorTop){e.next=12;break}if(b=c(["root",s.sortType,void 0,""]),l=null==b?void 0:b.data.find((function(e){return b.entities[e].isAuthorTop})),e.t0=l,!e.t0){e.next=10;break}return e.next=9,tt(i.showConfirm);case 9:e.t0=!e.sent;case 10:if(!e.t0){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,a("".concat(ze,"/comment/").concat(t,"/operation/top"),{method:o?"DELETE":"PUT"});case 14:f=e.sent,o?(f.childComments=r.childComments,n.entities[t]=f):(r.childComments.forEach((function(e){delete n.entities[e]})),delete n.entities[t],n.data=n.data.filter((function(e){return t!==e})),u=f),d=o?"已取消置顶":"已置顶";case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:u&&nt({commentData:u,alreadyToppedId:l},n),d&&(null===(r=i.onMessage)||void 0===r||r.call(i,d));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ot=function(){var e=h()(p.a.mark((function e(t,n){var r,o,c,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,o=n.fetcher,c=n.changePageData,i=n.sharedData,e.next=4,i.showConfirm("你确定要删除这条评论吗？");case 4:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,c(function(){var e=h()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o("".concat(ze,"/comment/").concat(r),{method:"DELETE"});case 2:t.entities[r].isDelete=!0;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ct={addComment:function(e,t){var n=e.data,r=t.changePageData,o=t.sharedData;return r((function(e){var t;e.entities[n.id]=n,e.data.unshift(n.id),e.counts.totalCounts+=1,null===(t=o.onMessage)||void 0===t||t.call(o,"评论发布成功！")}))},replyComment:Ze,toggleLike:function(e,t){return et({id:e,type:"like"},t)},toggleDislike:function(e,t){return et({id:e.id,type:"dislike"},t)},toggleAuthorTop:rt,toggleHot:function(e,t){var n=e.id,r=t.fetcher;return(0,t.changePageData)(function(){var e=h()(p.a.mark((function e(t){var o,c,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.entities[n],c=o.hot,e.next=4,r("".concat(ze,"/comment/").concat(n,"/operation/hot"),{method:c?"DELETE":"PUT"});case 4:(i=e.sent).childComments=o.childComments,t.entities[n]=i;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},toggleCollapse:function(){var e=h()(p.a.mark((function e(t,n){var r,o,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,o=n.changePageData,c=n.fetcher,e.next=4,o(function(){var e=h()(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.entities[r].collapsed,e.next=3,c("".concat(ze,"/comment/").concat(r,"/operation/collapse"),{method:n?"DELETE":"PUT"});case 3:n?(delete t.entities[r],t.data=t.data.filter((function(e){return e!==r})),t.counts.totalCounts-=1):t.entities[r].collapsed=!0;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:$e((function(e){e.counts.totalCounts-=1}),n),Qe(n);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),deleteComment:ot,reviewComment:function(){var e=h()(p.a.mark((function e(t,n){var r,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.changePageData,o=n.fetcher,e.next=3,r(function(){var e=h()(p.a.mark((function e(n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o("".concat(ze,"/comment/").concat(t,"/operation/approve"),{method:"PUT"});case 2:delete n.entities[t],n.data=n.data.filter((function(e){return e!==t})),n.counts.totalCounts-=1;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:$e((function(e){e.counts.totalCounts-=1}),n),Qe(n);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),expandChildComments:function(){var e=h()(p.a.mark((function e(t,n){var r,o,c,i,a,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.changePageData,o=n.fetcher,e.next=3,o("".concat(ze,"/comment/").concat(t,"/child_comment"));case 3:return c=e.sent,i=De(c.data),a=i.entities.comments,s=i.result,e.abrupt("return",r((function(e){var n=e.entities[t];e.entities=Object.assign(Object.assign({},e.entities),a),n.childComments=V()(n.childComments,s)})));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),report:function(e,t){t.sharedData.onReport(e)},block:function(){var e=h()(p.a.mark((function e(t,n){var r,o,c,i,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.sharedData,o=n.fetcher,e.next=3,r.showConfirm(Object(v.b)("p",{css:{fontSize:"16px",margin:"0 10px"},children:"屏蔽后，对方将不能关注你、向你发私信、评论你的实名回答、使用「@」提及你、邀请你回答问题，但仍然可以查看你的公开信息。"}));case 3:if(!e.sent){e.next=9;break}return a=t.author.urlToken,e.next=7,o("https://www.zhihu.com/api/v4/members/".concat(encodeURIComponent(a),"/actions/block"),{method:"POST"});case 7:null===(c=r.onMessage)||void 0===c||c.call(r,"屏蔽成功"),null===(i=r.onUserBlocked)||void 0===i||i.call(r,t.author);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),copy:function(e,t){var n,r=t.sharedData,o=document.createElement("span");o.innerHTML=e.content,J()(o.innerText),null===(n=r.onMessage)||void 0===n||n.call(r,"已复制到剪贴板")}},it=function(){var e=Object(M.b)(),t=_e().onError;return Object(C.a)(h()(p.a.mark((function n(){var r,o=arguments;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.apply(void 0,o);case 3:return n.abrupt("return",n.sent);case 6:throw n.prev=6,n.t0=n.catch(0),r=n.t0,t("commentActionError",Se(r),r),n.t0;case 11:case"end":return n.stop()}}),n,null,[[0,6]])}))))},at=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Object(I.d)(),n=t.mutate,r=t.cache,o=it(),c=Je(),i=_e(),a=i.resourceType,s=i.resourceId,u=c.commentType,l=c.sortType,d=c.fetchCommentId,b=Object(C.a)((function(t,r,o){var c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return n(o?[a,s].concat(O()(o)):[a,s,u,l,d,e],t&&Object(S.a)(t),{optimisticData:r&&Object(S.a)(r),revalidate:c,populateCache:!r,rollbackOnError:!0})})),p=Object(C.a)((function(t){return r.get(Object(I.c)(t?[a,s].concat(O()(t)):[a,s,u,l,d,e]))}));return Object(C.a)((function(t,r){var a={changePageData:b,layer:c,fetcher:o,mutate:n,getCache:p,pageOffset:e,sharedData:i};return"string"==typeof t?ct[t](r,a):t(a)}))},st=Object(x.createContext)(L.a),ut=function(e){var t=e.pageOffset,n=e.isResourceAuthor,r=e.children,o=Object(x.useState)(!1),c=j()(o,2),i=c[0],a=c[1],s=Object(x.useState)(),u=j()(s,2),l=u[0],d=u[1],b=Object(x.useState)([]),p=j()(b,2),f=p[0],h=p[1],m=Object(x.useRef)(),O=Je().displayType,g=_e().authorInfo,y=at(t),k=Object(C.a)((function(e,t){var r;if(i)a(!1);else{d(e);var o=t.id,c=t.author,s=t.isAuthor,u=t.disliked,l=t.hot,b=t.collapsed,p=t.canDislike,f=t.canHot,v=t.canCollapse,x=t.canDelete,C=c.id===(null==g?void 0:g.id)&&s,k=[!C&&["屏蔽","block"],!C&&["举报","report"],!C&&p&&[u?"取消踩":"踩评论","toggleDislike"],n&&f&&[l?"取消推荐":"推荐为热门","toggleHot"],n&&v&&[b?"取消折叠":"折叠评论","toggleCollapse"],(n||C)&&x&&["删除评论","deleteComment"],["复制","copy"]].filter(Boolean),T="modal"===O?"comment_popup":"comment_list";h(k.map((function(e){var n=j()(e,2),r=n[0],c=n[1];return[r,function(){var e;a(!1),null===(e=m.current)||void 0===e||e.trackEvent({eventType:"Click",action:"report"===c?"Report":void 0,elementLocation:{type:"Text",content:{type:"Comment",id:o},text:r,block:{blockText:T}}}),y(c,t)}]}))),null===(r=m.current)||void 0===r||r.trackEvent({eventType:"Click",action:"Expand",elementLocation:{type:"Button",content:{type:"Comment",id:o},text:k.map((function(e){return j()(e,1)[0]})).join(" "),block:{blockText:T}}}),a(!0)}})),A=Object(C.a)((function(){a(!1)}));return Object(v.c)(v.a,{children:[Object(v.b)(st.Provider,{value:k,children:r}),Object(v.b)(w.e,{ref:m}),Object(v.b)(N.a,{globalClose:!0,placement:"bottom",target:l,isOpen:i,onClose:A,children:Object(v.b)(T.Box,{py:"5px",children:f.map((function(e){var t=j()(e,2),n=t[0],r=t[1];return Object(v.b)(T.Flex,{onClick:r,alignItems:"center",justifyContent:"center",width:"95px",height:"40px",fontSize:"14px",color:"GBL05A",sx:{cursor:"pointer",":hover":{background:"GBK10A"}},children:n},n)}))})})]})},lt=Object(x.createContext)({}),dt=function(e){var t=e.data,n=e.children;return Object(v.b)(lt.Provider,{value:t,children:n})},bt={score:"默认",ts:"时间"},pt={root:function(e){return e.totalCounts?"".concat(e.totalCounts," 条评论"):"暂无评论"},sub:function(){return"评论回复"},collapsed:function(e){return e.totalCounts?"".concat(e.totalCounts," 条已折叠评论"):"暂无评论"},reviewing:function(e){return e.totalCounts?"".concat(e.totalCounts," 条待筛选评论"):"暂无评论"},anchor:function(){return"返回评论"}},ft=function(e){var t=e.title,n=e.children;return Object(v.c)(T.Flex,{flex:"0 0 auto",px:"20px",height:"50px",alignItems:"center",justifyContent:"space-between",sx:Object(Y.a)({borderBottom:"1px solid",borderBottomColor:"GBK09A"}),children:[Object(v.b)(T.Flex,{alignItems:"center",justifyContent:"space-between",fontSize:"15px",color:"GBK03A",fontWeight:"bold",children:t}),n]})},ht=Object(x.memo)((function(e){var t=e.counts,n=e.onChangeSortType,r=_e().targetLink,o=Je(),c=o.commentType,i=o.index,a=o.sortType,s=o.changeLayerData,u=o.router,l="modal"===_e().displayType?i>0:i>1,d=Object(v.c)(v.a,{children:[Object(v.c)(T.Text,{onClick:l?u.pop.bind(void 0,void 0):void 0,css:{cursor:l?"pointer":"default"},children:[l&&Object(v.b)(ee.b,{center:!0,size:24}),pt[c](t||{})]}),0===i&&r]});return Object(v.b)(ft,{title:d,children:Boolean(t&&"root"===c)&&Object(v.b)(T.Flex,{fontSize:"12px",lineHeight:"24px",fontWeight:"bold",bg:"GBK10A",sx:{border:"2px solid",borderColor:"GBK10A",borderRadius:"3px"},children:["score","ts"].map((function(e){return Object(v.b)(w.a,{as:T.Box,zaType:"Button",zaText:!0,view:Ge("sort"),width:"50px",height:"24px",bg:e===a?"GBK99A":"transparent",sx:{color:a===e?"GBK02A":"GBK05A",borderRadius:"2px",textAlign:"center",cursor:"pointer"},onClick:function(){null==n||n(e),s({sortType:e,prevLayerOffset:void 0})},children:bt[e]},e)}))})})})),mt=function(e){var t=_e().onShowUserDetail;return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=Object(x.useRef)(),r=Object(C.a)((function(r){var o=r.currentTarget;n.current=setTimeout((function(){e(o)}),t)})),o=Object(C.a)((function(){clearTimeout(n.current)}));return{onMouseEnter:r,onMouseLeave:o}}((function(n){null==t||t(e,n)}))},Ot=Object(x.memo)((function(e){var t=e.user,n=t.avatarUrl,r=t.isOrg,o=t.id,c=t.name,i="0"===o||""===o,a=mt(o),s=Object(v.b)(P.b,{url:i?P.a:n,alt:c,size:24,css:Object($.a)(),loading:"lazy"});return i?s:Object(v.b)(fe.b,Object.assign(Object.assign({href:"https://www.zhihu.com/".concat(r?"org":"people","/").concat(o),target:"_blank",zaType:"Button",zaText:"头像",css:{flex:"0 0 auto",height:"24px",width:"24px"}},i||a),{},{children:s}))})),gt=Object(x.createContext)([]),jt=function(e){var t=e.children,n=Object(x.useState)(Re||[]),r=j()(n,2),o=r[0],c=r[1];return Object(x.useEffect)((function(){Re||Object(me.loadScript)("https://unpkg.zhimg.com/@cfe/emoticon@1.2.4/lib/emoticon.js").then((function(){window.zh_emoticon&&(Re=window.zh_emoticon.reduce((function(e,t){var n;return[].concat(O()(e),O()(null!==(n=t.stickers)&&void 0!==n?n:[]))}),[]),c(Re))}))}),[]),Object(v.b)(gt.Provider,{value:o,children:t})},vt=function(){return Object(x.useContext)(gt)},xt=function(e){var t=e.className,n=e.height,r=e.width,o=e.url,c=e.onClick,i=Object(x.useMemo)((function(){return function(e,t){var n=parseInt(t,10)||120,r=parseInt(e,10)||120,o=Math.max(120,Math.min(202,r)),c=Math.max(120,Math.min(202,n)),i=Math.min(Math.max(r/n,.5),2);return{width:i>1?o:c*i,height:i>1?o/i:c,ratio:i}}(r,n)}),[r,n]),a=i.width,s=i.height,u=i.ratio,l=Object(x.useMemo)((function(){return o.endsWith("gif")?[o,o]:[Object(Oe.imgUrl)(o,"xld"),Object(Oe.imgUrl)(o,"")]}),[o]),d=j()(l,2),b=d[0],p=d[1],f=Object(C.a)((function(e){null==c||c(e,origin)}));return Object(v.b)(T.Box,{width:a,height:s,sx:{backgroundColor:"GBK10B",position:"relative",borderRadius:"8px"},className:t,children:Object(v.b)("img",{alt:"",src:b,"data-rawwidth":r||a,"data-rawheight":n||a,"data-original":p,css:{width:"100%",height:"100%",borderRadius:"8px",objectFit:"cover",cursor:"zoom-in",objectPosition:u<1?"center top":"unset"},loading:"lazy",onClick:f})})},yt=function(e){var t=e["data-height"],n=e["data-width"],r=e.className,o=e.href,c=_e().onShowImage,i=Object(C.a)((function(e,t){null==c||c(t,e.currentTarget)}));return Object(v.b)(xt,{height:t,width:n,url:o,css:{marginTop:"12px"},className:r,onClick:i})},Ct=function(e){var t=e.href,n=e["data-hash"],r=e.children,o=mt(n);return Object(v.b)(fe.b,Object.assign(Object.assign({href:t,target:"_blank",className:"member_mention"},o),{},{children:r}))},kt=function(e,t){return Object(he.a)(e,{convertEmoticon:!0,emoticonList:t,traverseCallback:function(e,t){if(e.nodeType===Node.ELEMENT_NODE){var n=e.classList,r=e.textContent;if(n.contains("member_mention"))return t(Ct);if(n.contains("comment_img")||n.contains("comment_sticker"))return t(yt);if(null==r?void 0:r.match("http"))return t("A"===e.tagName?fe.b:void 0)}return t()}})},Tt=function(e){var t=e.data,n=e.commentType,r=vt(),o=t.content,c=t.isDelete,i=t.collapsed,a=Object(x.useMemo)((function(){if("collapsed"!==n){if(c)return[!0,"该条评论已删除"];if(i)return[!0,"该条评论被折叠"]}else if("collapsed"===n&&c)return[!0,"该条评论已删除"];return[!1,kt(o,r)]}),[n,c,i,o,r]),s=j()(a,2),u=s[0],l=s[1];return Object(v.b)(T.Text,{className:"CommentContent",mt:"4px",fontSize:"15px",lineHeight:"21px",sx:{color:u?"GBL05A":"GBK03A",p:{margin:0},".sticker":{width:"20px",height:"20px",marginBottom:"-4px"},".member_mention":{color:"GBL07A"},"a.internal,a.external":{textDecoration:"none",color:"GBK03A",borderBottom:"1px solid",borderColor:"GBK03A",":hover":{color:"GBL07A",borderBottom:"1px solid",borderColor:"GBL07A"},".invisible":{display:"none"},".ellipsis::after":{content:'"..."'}}},children:l})},wt=Object(x.memo)((function(e){var t=e.text;return Object(he.c)(t)})),At=function(e){var t=e.data,n=e.responseLink,r=e.richText,o=e.className,c=Object(Q.a)(),i=c.colors,a=i.GBK06A,s=i.GBK08A,u=i.GBL01A,l=c.isDarkMode,d=t.text,b=t.color,p=t.nightColor,f=t.hasBorder,h=t.borderColor,m=t.borderNightColor,O=t.targetLink,g=n&&O,j=g?fe.b:"span";return Object(v.c)(j,{css:Object.assign(Object.assign(Object.assign({},f&&Object.assign(Object.assign({},Object(Y.a)({border:"1px solid ".concat((l?m:h)||s),borderRadius:"4px"})),{},{padding:"0 4px"})),{},{color:(l?p:b)||a},g&&{textDecoration:"none"}),{},{height:"16px",fontSize:"12px",lineHeight:"16px",boxSizing:"border-box","& a":{color:u,textDecoration:"none"}}),className:o,href:g?O:"",children:[r?Object(v.b)(wt,{text:d}):d,Boolean(O)&&Object(v.b)(te.b,{css:{fill:b,marginRight:"-2px"},center:!0,size:12})]})},Bt=function(e){var t=e.data,n=_e().onNeedVip;if(!t)return null;var r=t.vipIcon,o=(r=void 0===r?{}:r).url,c=t.isVip;return o&&c?Object(v.b)(T.Image,{src:o,width:16,height:16,css:{cursor:"pointer",marginLeft:"4px"},onClick:function(){n("vip_badge")}}):null},It=function(e){var t=e.user,n=t.id,r=t.name,o=t.isOrg,c="0"===n||""===n,i=mt(n);return c?Object(v.b)("span",{children:r}):Object(v.b)(fe.b,Object.assign(Object.assign({href:"https://www.zhihu.com/".concat(o?"org":"people","/").concat(n),target:"_blank",css:function(e){return{fontSize:"15px",fontWeight:"bold",textDecoration:"none",color:e.colors.GBK03A}}},i),{},{children:r}))},zt=function(e){var t=e.user,n=e.authorTag,r=e.isReplyTo,o=t.badge,c=t.badgeV2,i=t.vipInfo;return Object(v.c)(T.Flex,{alignItems:"center",height:"16px",children:[Object(v.b)(It,{user:t}),Boolean(r)||Object(v.c)(v.a,{children:[null==n?void 0:n.map((function(e){return Object(v.b)(At,{data:e,css:{marginLeft:"4px"}},e.text)})),Object(v.b)(ge.c,{size:18,badge:null!=c?c:o,css:{marginLeft:"4px"}}),Object(v.b)(Bt,{data:i})]})]})},St=function(e){var t=e.onClick,n=_e().authorInfo;return(null==n?void 0:n.id)?Object(v.b)(T.Box,{size:"20px",css:{cursor:"pointer"},onClick:t,children:Object(v.b)(ne.d,{size:16})}):null},Et=function(e){var t=e.id,n=e.author,r=e.childComments,o=e.childCommentCount,c=e.pageOffset,i=e.onAction,a=Object(Q.a)().colors.GBL05A,s=o>(null==r?void 0:r.length),u=o<=5,l=Object(C.a)((function(){u?i("expandChildComments",t):i((function(e){e.layer.router.push({commentType:"sub",sortType:"ts",fetchCommentId:t,rootCommentAuthor:n,prevLayerOffset:c})}))}));return s?Object(v.c)(w.a,{as:G.a,shouldTrackShow:!0,zaType:"Block",zaAction:"Expand",view:Ge("show_reply"),preset:"secondary",color:"grey",onClick:l,css:{margin:"10px 0 10px 54px",padding:"0 6px 0 12px",height:"32px",color:a,fontWeight:500,svg:{marginBottom:"1px"}},children:[u?"展开其他 ".concat(o-r.length," 条回复"):"查看全部 ".concat(o," 条回复"),Object(v.b)(re.b,{center:!0,size:24})]}):null},Lt=function(e){var t=e.data,n=t.author,r=t.authorTag,o=t.replyToAuthor,c=t.replyAuthorTag;return Object(v.c)(T.Flex,{alignItems:"center",flex:"0 0 auto",children:[Object(v.b)(zt,{user:n,authorTag:r}),o&&Object(v.b)(oe.a,{size:12,css:{margin:"0 4px"}}),o&&Object(v.b)(zt,{user:o,isReplyTo:!0,authorTag:c})]})},Rt=function(e){var t=e.isReply,n=e.isSticky,r=e.autoFocus,o=e.replyCommentId,c=e.localCache,i=e.disabled,a=e.placeholder,s=e.maxLine,u=e.onSubmit,l=e.className,d=Object(x.useRef)(),b=_e(),p=b.authorInfo,f=b.resourceType,h=b.resourceId,m=b.onNeedLogin,O=b.onNeedVip,g=b.onError,j=vt(),y=t?void 0:n?"悬浮":"常驻",k=t?"reply_comment":"direct_comment",T=Object(C.a)((function(e){var t;null===(t=d.current)||void 0===t||t.trackEvent({eventType:"Click",action:"Comment",elementLocation:{type:"Button",text:y,block:{blockText:k}}}),u(e)}));return Object(v.c)(v.a,{children:[Object(v.b)(w.e,{ref:d}),Object(v.b)(w.f,{zaType:"Block",zaText:y,view:Ge(k),children:Object(v.b)(ve.a,{className:l,authorInfo:p,resourceType:f,resourceId:h,isReply:t,disabled:i,autoFocus:r,placeholder:a,localCache:c,replyCommentId:o,maxLine:s,emoticonList:j,onSubmit:T,onNeedLogin:m,onNeedPurchaseVip:O,onError:g})})]})},Dt=function(e){var t,n=e.data,r=e.subIntro,o=e.commentType,c=e.onAction,i=n.id,a=n.createdTime,s=n.commentTag,u=n.canReply,l=n.canLike,d=n.isAuthorTop,b=n.canAuthorTop,p=n.liked,f=n.likeCount,h=n.reviewing,m=n.collapsed,O=n.author,g=_e().authorInfo,y=!r&&!h&&!m&&u,k=O.id!==(null==g?void 0:g.id)&&l,A=!h&&!m&&b,B=Object(x.useState)(!1),I=j()(B,2),z=I[0],S=I[1],E=Object(C.a)((function(){S(!z)})),L=Object(C.a)((function(e){S(!1),c("replyComment",{replyCommentId:i,data:e})})),R=Object(C.a)((function(){c("toggleLike",i)})),D=Object(C.a)((function(){c("reviewComment",i)})),N=Object(C.a)((function(){c("toggleAuthorTop",i)}));return t=!h||"root"!==o&&"sub"!==o?Object(v.c)(T.Flex,{alignItems:"center",flex:"0 0 auto",css:{".Button":{marginLeft:"16px"}},children:[y&&Object(v.b)(w.a,{as:G.a,zaType:"Card",zaAction:"Comment",preset:"plain",icon:ce.b,label:"回复",onClick:E}),h&&Object(v.b)(w.a,{as:G.a,zaType:"Button",zaText:!0,preset:"plain",icon:ie.a,label:"公开此评论",onClick:D}),!h&&!m&&Object(v.b)(w.a,{as:G.a,zaType:"Card",zaAction:p?"UnUpvote":"Upvote",preset:"plain",disabled:!k,icon:ae.b,label:f?String(f):"赞",color:p?"blue":"grey",onClick:R}),A&&Object(v.b)(w.a,{as:G.a,shouldTrackShow:!0,zaType:"Button",zaText:!0,preset:"plain",icon:d?se.a:ue.a,label:d?"取消置顶":"置顶",onClick:N})]}):null,Object(v.c)(v.a,{children:[Object(v.c)(T.Flex,{alignItems:"center",justifyContent:"space-between",mt:"4px",children:[Object(v.c)(T.Flex,{alignItems:"center",flex:"0 0 auto",fontSize:"14px",color:"GBK06A",children:[Object(v.b)(T.Text,{mr:"4px",children:Object(je.toSmartString)(a)}),s.map((function(e){return Object(v.c)(x.Fragment,{children:[Object(v.b)("span",{children:" · "}),Object(v.b)(At,{data:e,css:{fontSize:"14px",margin:"0 4px"}})]},e.type)}))]}),t]}),z&&Object(v.b)(Rt,{isReply:!0,autoFocus:!0,localCache:!0,placeholder:"回复 ".concat(O.name),replyCommentId:i,onSubmit:L,css:{marginTop:"8px"}})]})},Gt=Object(pe.h)(r||(r=u()(["\n  0%, 100% {background-color: rgba(255,255,255,1);}\n  50% {background-color: rgba(0,102,255,.08);}\n"]))),Nt=Object(pe.h)(o||(o=u()(["\n  0%, 100% {background-color: rgba(0,0,0,1);}\n  50% {background-color: rgba(85, 142, 255,.08);}\n"]))),Pt=Object(x.memo)(Object(x.forwardRef)((function(e,t){var n=e.className,r=e.data,o=e.commentType,c=e.sub,i=e.subIntro,a=e.blink,s=e.pageOffset,u=e.onAction,l=r.id,d=r.author,b=r.childComments,p=r.childCommentCount,f=Object(x.useContext)(st),h=Object(C.a)((function(e){f(e.currentTarget,r)}));return Object(v.c)("div",{ref:t,children:[Object(v.b)(w.b,{content:{type:"Comment",id:l},children:Object(v.c)(w.f,{as:T.Flex,zaType:"Card",extra:{configMap:{commentLevel:c?"2":"1"}},css:function(e){return{animation:a?"".concat(e.isDarkMode?Nt:Gt," 1s linear forwards"):void 0,padding:"10px 20px 14px ".concat(c?"54px":"20px")}},className:n,children:[Object(v.b)(Ot,{user:d}),Object(v.c)(T.Box,{ml:"10px",flex:"1 1 auto",children:[Object(v.c)(T.Flex,{justifyContent:"space-between",color:"GBK06A",children:[Object(v.b)(Lt,{data:r}),Object(v.b)(St,{onClick:h})]}),Object(v.b)(Tt,{data:r,commentType:o}),Object(v.b)(Dt,{data:r,subIntro:i,commentType:o,onAction:u})]})]})}),Boolean(i)||(null==b?void 0:b.map((function(e){return Object(v.b)(Ft,{id:e,sub:!0,commentType:o,onAction:u},e)}))),Boolean(i)||Object(v.b)(Et,{id:l,author:d,childComments:b,childCommentCount:p,pageOffset:s,onAction:u})]})}))),Ft=Object(x.forwardRef)((function(e,t){var n,r=(n=e.id,Object(x.useContext)(lt)[n]);return Object(v.b)(Pt,Object.assign(Object.assign({ref:t},e),{},{data:r}))})),Mt=function(e){var t=e.pageOffset,n=e.rootCommentId,r=qe(t).data,o=at(t);return r&&n?Object(v.c)(dt,{data:r.entities,children:[Object(v.b)(Ft,{id:n,commentType:"sub",pageOffset:t,subIntro:!0,css:function(e){return{padding:"20px",background:e.colors.GBK99A,borderBottom:"20px solid ".concat(e.colorMod(e.colors.GBL05A).alpha(.1))}},onAction:o}),Object(v.b)(ft,{title:"".concat(Object(H.cnNiceNumber)(r.entities[n].childCommentCount),"条回复")})]}):null},_t=function(e){var t=e.isResourceAuthor,n=Je(),r=n.prevLayerOffset,o=void 0===r?"":r,c=n.fetchCommentId,i=n.router.layers,a=n.displayType,s=Object(x.useState)((function(){return Object.assign(Object.assign({},i[0]),{},{displayType:a})})),u=j()(s,1)[0];return Object(v.b)(We,{data:u,children:Object(v.b)(ut,{pageOffset:o,isResourceAuthor:t,children:Object(v.b)(Mt,{pageOffset:o,rootCommentId:c})})})},Kt=Object(x.memo)((function(e){var t=e.containerRef,n=e.className,r=e.commentType,o=e.scrollAndBlink,c=e.list,i=e.entities,a=e.paging,s=e.pageOffset,u=e.isInfinite,l=e.onNextPage,d=e.onAction,b=Object(x.useRef)(null),p=Object(x.useRef)(null),f=Object(x.useRef)(null),h=Object(x.useMemo)((function(){return o?"last"===o?c.length-1:c.findIndex((function(e){return e===o})):-1}),[c,o]);return Object(k.a)((function(){-1!==h&&t.current&&b.current&&p.current&&t.current.scrollTo({top:b.current.offsetTop+p.current.offsetTop-10})})),Object(x.useEffect)((function(){if(u&&!a.isEnd&&f.current){var e=new IntersectionObserver((function(e){if(e[0].isIntersecting&&a.next){var t=new URL(a.next).searchParams.get("offset");null==l||l(t)}}),{root:null==t?void 0:t.current,rootMargin:"0px 0px 200px 0px"});return e.observe(f.current),function(){e.disconnect()}}}),[u,a,l,t]),Object(v.c)(T.Box,{ref:b,className:n,children:[Object(v.b)(dt,{data:i,children:c.map((function(e,t){var n=t===h;return Object(v.b)(Ft,{ref:n?p:void 0,id:e,commentType:r,pageOffset:s,blink:n,onAction:d},e)}))}),Object(v.b)("div",{ref:f})]})})),Ht=Object(pe.h)(c||(c=u()(["\n0% {transform: translateX(-56%);}\n100% {transform: translateX(56%);}\n"]))),Ut=function(e){var t=e.className,n=Object(Q.a)().colors,r=n.GBK10A,o=n.GBK09A,c=n.GBK99A;return Object(v.c)("div",{className:t,css:{position:"relative",overflow:"hidden",background:r,color:c},children:[Object(v.b)("div",{css:{position:"absolute",width:"200%",height:"100%",background:"linear-gradient(to right, ".concat(r," 0%, ").concat(o," 20%, ").concat(r," 40%, ").concat(r," 100%)"),animation:"".concat(Ht," 1s linear 1ms infinite forwards")}}),Object(v.b)("svg",{width:"656",height:"44",viewBox:"0 0 656 44",css:{position:"relative",minWidth:"100%",verticalAlign:"top",boxSizing:"border-box"},children:Object(v.b)("path",{d:"M0 0h656v44H0V0zm0 0h480v12H0V0zm0 32h238v12H0V32z",fill:"currentColor",fillRule:"evenodd"})})]})},Vt=function(e){var t=e.isInfinite,n=e.fullHeight;return t?Object(v.b)("div",{css:{boxSizing:"border-box",padding:"10px 20px 14px 20px",height:n?"calc(100vh - 24px * 2 - 50px - 62px - 20px)":void 0},children:Object(v.b)(Ut,{})}):Object(v.b)(T.Flex,{justifyContent:"center",alignItems:"center",height:"96px",children:Object(v.b)(F.a,{})})},Wt=function(e){var t=e.containerRef,n=e.commentType,r=e.scrollAndBlink,o=e.fullHeightLoading,c=e.pageOffset,i=e.isResourceAuthor,a=e.isInfinite,s=e.onNextPage,u=qe(c,{isInfinitePage:a}),l=u.data,d=u.isValidating,b=at(c);if(d&&!l)return Object(v.b)(Vt,{isInfinite:a,fullHeight:o});var p=l||{},f=p.data,h=p.entities,m=p.paging;return f&&f.length>0&&h&&m?Object(v.b)(ut,{pageOffset:c,isResourceAuthor:i,children:Object(v.b)(Kt,{containerRef:t,commentType:n,scrollAndBlink:r,list:f,entities:h,paging:m,pageOffset:c,isInfinite:a,onNextPage:s,onAction:b})}):null},Jt=function(e){var t=e.paging,n=Object(x.useMemo)((function(){return t?[t.isEnd,new URL(t.next).searchParams.get("offset")||void 0]:[!0]}),[t]),r=j()(n,2),o=r[0],c=r[1],i=Je(),a=i.sortType,s=i.router,u=Object(C.a)((function(){!o&&c&&s.push({commentType:"root",sortType:a,prevLayerOffset:c})}));return o?null:Object(v.c)(w.a,{as:T.Flex,zaType:"Button",zaAction:"Expand",shouldTrackShow:!0,zaText:"查看全部评论",css:function(e){return Object.assign({alignItems:"center",justifyContent:"center",color:e.colors.GBL05A,fontSize:"15px",padding:"20px 0",margin:"0 20px",cursor:"pointer"},Object(Y.a)({borderTop:"1px solid ".concat(e.colors.GBK10A)}))},onClick:u,children:[Object(v.b)(T.Text,{children:"点击查看全部评论"}),Object(v.b)(re.b,{size:24})]})},qt=Object(x.memo)((function(e){var t=e.type,n=e.counts,r=e.isResourceAuthor,o=Ve().push,c=Object(C.a)((function(){r&&o({commentType:"reviewing"})})),i=Object(C.a)((function(){o({commentType:"collapsed"})}));if(!n)return null;if("reviewing"===t){var a=r&&n.reviewingCounts>0;return Object(v.c)(w.a,{as:T.Flex,shouldTrackShow:!0,zaType:"Button",zaAction:"Expand",zaText:!0,css:function(e){return{flex:"0 0 auto",alignItems:"center",margin:"20px 20px 0",padding:"0 10px",height:"36px",fontSize:"14px",color:r?e.colors.GBL01A:e.colors.GBL05A,borderRadius:"3px",backgroundColor:e.colorMod(r?e.colors.GBL01A:e.colors.GBL05A).alpha(.1),cursor:a?"pointer":"default"}},onClick:a?c:L.a,children:[Object(v.b)(le.a,{text:!0,size:16}),Object(v.b)(T.Text,{ml:"8px",flex:"1 1 auto",children:r?"".concat(n.reviewingCounts," 条新评论待筛选"):"评论内容由作者筛选后展示"}),a&&Object(v.b)(re.b,{size:24})]})}return"collapsed"===t&&n.collapsedCounts>0?Object(v.c)(T.Flex,{alignItems:"center",justifyContent:"center",color:"GBL05A",fontSize:"15px",py:"20px",mx:"20px",sx:Object.assign(Object.assign({},Object(Y.a)({borderTop:"1px solid",borderTopColor:"GBK10A"})),{},{cursor:"pointer"}),onClick:i,children:[Object(v.b)(T.Text,{children:"查看被折叠评论"}),Object(v.b)(de.a,{size:16,css:{marginLeft:"4px"},onClick:function(e){e.stopPropagation(),window.open("https://www.zhihu.com/question/52029856/answer/128623557")}})]}):null})),Xt=function(e){return{flex:"0 0 auto",padding:"10px 20px",boxShadow:"0px -1px 3px ".concat(e.colorMod(e.colors.GBK02B).alpha(.12))}},Yt=function(){var e=_e(),t=e.hideFoldButton,n=e.onClose;return t||!n?null:Object(v.b)(xe.a.div,{variants:{initial:{opacity:0},sticky:{opacity:1},unSticky:{opacity:0}},css:{position:"absolute",top:"-52px",right:"20px"},children:Object(v.c)(G.a,{preset:"secondary",color:"grey",onClick:n,css:function(e){return{margin:"10px 0 10px 54px",padding:"0 6px 0 12px",height:"32px",color:e.colors.GBL05A,backgroundColor:e.colors.GBK10A,fontWeight:500,":hover":{backgroundColor:e.colors.GBK10A},svg:{marginBottom:"1px"}}},children:["收起评论",Object(v.b)(be.b,{center:!0,size:24})]})})},$t=function(e){var t=e.disabled,n=e.autoFocus,r=e.placeholder,o=e.onSubmit,c=e.children,i=_e().hideBottomEditorShadow,a=Object(x.useRef)(null),s=Object(x.useRef)(null),u=Object(x.useRef)(null),l=Object(x.useState)(!1),d=j()(l,2),b=d[0],f=d[1],m=Object(ye.a)(),O=Object(Q.a)().colors,g=O.GBK99A,y=O.GBK02B;return Object(x.useEffect)((function(){if(a.current){var e=a.current.offsetHeight;f(e>1.5*window.innerHeight)}}),[c]),Object(x.useEffect)((function(){if(b&&a.current&&s.current&&u.current){var e=function(){var e=h()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.set(t?"unSticky":"sticky"),e.next=3,m.start(t?"sticky":"unSticky");case 3:t||m.set("initial");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t=new IntersectionObserver((function(t){var n=j()(t,2),r=n[0],o=n[1];2===t.length||!1===(null==o?void 0:o.isIntersecting)?m.start("initial"):r.target===u.current?m.start(r.isIntersecting?"initial":"sticky"):r.target===s.current&&e(r.isIntersecting)}));return t.observe(s.current),t.observe(u.current),function(){return t.disconnect()}}}),[m,b]),Object(v.c)("div",{css:{position:"relative"},ref:a,children:[Object(v.b)(w.b,{content:{type:"Comment"},children:Object(v.b)(Rt,{disabled:t,autoFocus:n,placeholder:r,localCache:!0,css:{marginBottom:"10px"},onSubmit:o})}),c,b&&Object(v.b)("div",{ref:s,css:{position:"absolute",top:"100vh",bottom:0}}),t||b&&Object(v.c)(xe.a.div,{initial:"initial",animate:m,variants:{initial:{position:"relative",boxShadow:"0 0"},sticky:{position:"sticky",y:0,boxShadow:i?"0 0":"0px -1px 3px ".concat(Object(Z.a)(y).alpha(.12))},unSticky:{position:"sticky",y:"100%",boxShadow:"0 0"}},css:{margin:"0 -20px",padding:"10px 20px",bottom:0,background:g},children:[Object(v.b)(Yt,{}),Object(v.b)(w.b,{content:{type:"Comment"},children:Object(v.b)(Rt,{isSticky:!0,autoFocus:!1,placeholder:r,maxLine:6,onSubmit:o})})]}),b&&Object(v.b)("div",{ref:u})]})},Qt=function(e){var t=e.hide,n=e.disabled,r=e.autoFocus,o=e.placeholder,c=e.children,i=Je(),a=i.displayType,s=i.fetchCommentId,u=i.rootCommentAuthor,l=at(),d=u?"回复 ".concat(u.name):o,b=Object(C.a)((function(e){l("addComment",{data:e})}));return t?Object(v.b)(v.a,{children:c}):"list"===a?Object(v.b)($t,{disabled:n,autoFocus:r,placeholder:d,onSubmit:b,children:c}):Object(v.c)(v.a,{children:[c,Object(v.b)(w.b,{content:{type:"Comment"},children:Object(v.b)(Rt,{disabled:n,autoFocus:r,placeholder:d,maxLine:6,localCache:!0,replyCommentId:s,css:Xt,onSubmit:b})})]})},Zt=function(e){var t=e.className,n=e.hideEditor,r=e.disableEditor,o=e.autoFocusEditor,c=e.editorPlaceholder,i=e.children,a=Je(),s=a.displayType,u=a.commentType,l="root"!==u&&"sub"!==u||n;return"list"===s?Object(v.b)(w.b,{block:"comment_list",children:Object(v.b)(T.Box,{className:t,children:Object(v.b)(Qt,{hide:l,disabled:r,autoFocus:o,placeholder:c,children:Object(v.b)(T.Flex,{flexDirection:"column",alignItems:"stretch",sx:{position:"relative",border:"1px solid",borderColor:"GBK09A",borderRadius:"4px"},children:i})})})}):Object(v.b)(w.b,{block:"comment_popup",children:Object(v.b)(T.Flex,{flexDirection:"column",alignItems:"stretch",height:"100%",css:{position:"relative"},className:t,children:Object(v.b)(Qt,{hide:l,disabled:r,autoFocus:o,placeholder:c,children:i})})})},en=function(e){var t,n,r,o,c=e.className,i=Object(x.useRef)(null),a=Je(),s=a.displayType,u=a.commentType,l=a.sortType,d=a.prevLayerOffset,b=a.fetchCommentId,p="modal"===s,f="list"===s,h="root"===u,m="sub"===u,g="anchor"===u,y=function(){var e=Je().commentType,t=Object(x.useMemo)((function(){return[["sub","anchor"].includes(e)?"root":e,"score",void 0,""]}),[e]),n=Object(z.a)(t),r=n.data,o=n.error,c=null==r?void 0:r.data;return t?o&&!c?{error:Se(o)}:c?B()(r,"entities"):{error:"请求数据失败"}:{}}(),k=Boolean(p&&h&&d),A=g?b:void 0,I=Be((function(){return[k&&d||""]}),[k,d,l]),S=j()(I,2),E=S[0],L=S[1],R=Object(C.a)((function(e){E.find((function(t){return t===e}))||L((function(t){return[].concat(O()(t),[e])}))})),D=Object(C.a)((function(){var e;p&&(null===(e=i.current)||void 0===e||e.scrollTo({top:0}))})),G=(null===(t=y.commentStatus)||void 0===t?void 0:t.type)||0;if(1===G||3===G)return Object(v.b)(Zt,{className:c,hideEditor:!0,children:Object(v.b)(Ye,{type:G})});var N=null===(n=y.commentStatus)||void 0===n?void 0:n.induceText,P=Boolean(y.error||N),F=h&&2===G;return 0===(null===(r=y.counts)||void 0===r?void 0:r.totalCounts)&&0===(null===(o=y.data)||void 0===o?void 0:o.length)?Object(v.c)(Zt,{className:c,disableEditor:P,autoFocusEditor:!P,editorPlaceholder:N,children:[F&&Object(v.b)(qt,{type:"reviewing",counts:y.counts,isResourceAuthor:y.isContentAuthor}),Object(v.b)(Ye,{noComments:!0})]}):Object(v.c)(Zt,{className:c,disableEditor:P,editorPlaceholder:N,children:[Object(v.b)(ht,{counts:y.counts,onChangeSortType:D}),Object(v.c)(w.f,{zaType:"Block",ref:i,css:{flex:"1 1 auto",overflowY:p?"scroll":void 0,position:"relative"},children:[m&&Object(v.b)(_t,{isResourceAuthor:y.isContentAuthor}),F&&Object(v.b)(qt,{type:"reviewing",counts:y.counts,isResourceAuthor:y.isContentAuthor}),Object(v.c)(T.Box,{py:"10px",css:{minHeight:"100%"},children:[Boolean(k)&&Object(v.b)(Wt,{containerRef:i,commentType:u,pageOffset:"",isResourceAuthor:y.isContentAuthor,scrollAndBlink:"last"}),E.map((function(e,t){return Object(v.b)(Wt,{commentType:u,containerRef:i,fullHeightLoading:0===t&&k,scrollAndBlink:A,pageOffset:e,isResourceAuthor:y.isContentAuthor,isInfinite:p&&!g,onNextPage:R},e)}))]}),Object(v.b)(qt,{type:"collapsed",counts:y.counts,isResourceAuthor:y.isContentAuthor})]}),f&&E.length>0&&Object(v.b)(Jt,{paging:y.paging})]})},tn=function(e){var t=e.onClose,n=e.onExit,r=e.children,o=Ve().pop,c=Object(C.a)((function(){t&&t(),o(0)}));return Object(v.b)(R.a,{size:"fullPage",css:{".Modal-content":{padding:0,marginTop:0,position:"relative"}},maskClosable:!1,onClose:c,onExitComplete:n,children:r})},nn=function(e,t){return 0===t&&e>1?{display:"none"}:{}},rn=function(e){var t=e.onExit,n=Ve().layers,r=_e(),o=r.className,c=r.displayType,i=r.onClose;if(Object(x.useEffect)((function(){"list"===c&&0===n.length&&t()}),[c,n.length,t]),"list"===c){var s=a()(n),u=s[0],l=s.slice(1);return u?Object(v.c)(v.a,{children:[Object(v.b)(We,{data:u,children:Object(v.b)(en,{className:o})}),Object(v.b)(tn,{children:l.length>0?l.map((function(e,t){return Object(v.b)(We,{data:e,children:Object(v.b)(en,{css:nn(l.length,t)})},e.index)})):null})]}):null}return Object(v.b)(tn,{onClose:i,onExit:t,children:n.length>0?n.map((function(e,t){return Object(v.b)(We,{data:e,children:Object(v.b)(en,{css:nn(n.length,t)})},e.index)})):null})},on=function(e){var t=e.shown,n=Object(x.useState)(t),r=j()(n,2),o=r[0],c=r[1],i=Object(C.a)((function(){c(!1)}));return Object(x.useEffect)((function(){t&&c(!0)}),[t]),o?Object(v.b)(Me,Object.assign(Object.assign({},e),{},{children:Object(v.b)(jt,{children:Object(v.b)(Ue,{children:Object(v.b)(rn,{onExit:i})})})})):null}}}]);
//# sourceMappingURL=column.lib_cf230269.a1d070fc937954196eb1.js.map